/*! For license information please see merchant.js.LICENSE.txt */
"use strict";(self.webpackChunksource=self.webpackChunksource||[]).push([[377],{4531:(t,e,r)=>{r.d(e,{A:()=>a});var i=r(94042),s=r(38734),o=r(13809);const a={methods:{clickHtml(t){const e=t=>t===this.$el?null:"A"===t.tagName&&t.hasAttribute("data-href")?t:e(t.parentNode);this.clickNode(e(t.target))},clickLink(t){this.clickNode(t.currentTarget)},clickClose(t){t.currentTarget&&t.currentTarget.classList.contains("overlay-close")&&this.$emit("close")},clickNode(t){if(!t)return;const e=t.getAttribute("data-href");if(e){let t=(0,i.V)(e);-1===t.indexOf("visit_id=")&&(t=(0,s.Gu)(t,{visit_id:self.EBATES.settings.visitId})),this.$emit("track","Visit Page",{url:t}),setTimeout((()=>{(0,o.o)(t)}),100),this.$emit("clickLink")}}}}},51564:(t,e,r)=>{async function i(t){try{await navigator.clipboard.writeText(t)}catch{const e=document.createElement("input");e.style.position="fixed",e.style.top="-1000px",document.body.appendChild(e),e.value=t,e.select(),document.execCommand("Copy"),document.body.removeChild(e)}}r.d(e,{l:()=>i})},94682:(t,e,r)=>{r.d(e,{n:()=>s});var i=r(77770);function s(t){const e=t.storeContent?.averageReportingHours||0;if(t.storeContent?.consumptionBased){const r=e/24;return 2609===t.storeId?i.R.get("reportingMessage.45days"):0===r?i.R.get("reportingMessage.afterTravel"):r<=3?i.R.get("reportingMessage.fewDays"):r<=7?i.R.get("reportingMessage.week"):r<=14?i.R.get("reportingMessage.coupleOfWeeks"):r<=31?i.R.get("reportingMessage.month"):r<=45?i.R.get("reportingMessage.sixWeeks"):r<=90?i.R.get("reportingMessage.3Months"):i.R.get("reportingMessage.6Months")}{const t=(new Date).getHours();return e<5&&t<16?i.R.get("reportingMessage.today"):e<24?i.R.get("reportingMessage.tomorrow"):e<48?i.R.get("reportingMessage.inAFewDays"):e<168?i.R.get("reportingMessage.oneWeek"):e<720||e<=1440?i.R.get("reportingMessage.fewWeeks"):i.R.get("reportingMessage.fewMonths")}}},92197:(t,e,r)=>{r.d(e,{w:()=>s});var i=r(93423);function s(t){const e=[];return t?.forEach((t=>{if(t.reward&&"None"!==t.reward.display&&0!==t.reward.amount){const r=(0,i.a)(t.reward),s=e.find((t=>t.rewardAmount===r));s?s.names.push(t.name):e.push({rewardAmount:r,reward:t.reward,names:[t.name],id:t.id})}else t.cashBack&&"0% Cash Back"!==t.cashBack&&e.push({cashBack:t.cashBack,description:t.description,id:t.id})})),e.forEach((t=>{t.names&&(t.names=t.names.sort().join(", "))})),e.sort(((t,e)=>t.cashBack||e.cashBack?0:"Percentage"===t.reward.display&&"Fixed"===e.reward.display?-1:"Fixed"===t.reward.display&&"Percentage"===e.reward.display?1:t.reward.amount>e.reward.amount?-1:t.reward.amount<e.reward.amount?1:0))}},18138:(t,e,r)=>{r.d(e,{N:()=>s});var i=r(184);function s({id:t,title:e,listPrice:r,salePrice:s,discount:o,category_id:a,imageUrl:n,productUrl:c,abandonedTimestamp:l,eligibleForCashBack:d,merchant:u}){return{id:t,title:e,discount:o,category_id:a,list_price:r,sale_price:s,image_url:n,product_url:c,abandoned_timestamp:l,eligible_for_cashback:d,store_name:u.storeName,store_id:u.storeId,...(0,i.D)(u.reward)}}},95754:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("div",{style:{height:`${t.size}px`,width:`${t.size}px`,borderRadius:"50%",backgroundColor:t.backgroundColor,display:"flex",justifyContent:"center",alignItems:"center"}},[e(t.icon,{tag:"component",attrs:{color:t.color,size:t.iconSize,rotate:t.rotate}})],1)};i._withStripped=!0;const s={name:"RIconInverse",props:{icon:{type:Object,required:!0},color:{type:String,default:"#ffffff"},backgroundColor:{type:String,default:"#8529cd"},size:{type:[Number,String],default:24},iconSize:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},96037:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 2C4.7 2 2 4.7 2 8C2 11.31 4.7 14 8 14C11.32 14 14 11.31 14 8C14 4.7 11.32 2 8 2ZM1.53 10.75C-0.369995 5.83 3.12 1.17 7.75 1C11.59 0.86 14.94 4.03 15 7.87C15.06 11.71 11.91 15 8 15H8C5.17 15 2.54 13.36 1.53 10.74V10.75ZM8 9.53C7.5 9.53 7.08 9.12 7.08 8.61001V4.76001C7.08 4.25 7.5 3.84 8 3.84C8.51 3.84 8.92 4.25 8.92 4.76001V8.62C8.92 9.13 8.51 9.54001 8 9.54001V9.53ZM8.92 11.34C8.92 11.85 8.51 12.26 8 12.26C7.5 12.26 7.08 11.85 7.08 11.34C7.08 10.83 7.5 10.42 8 10.42C8.51 10.42 8.92 10.83 8.92 11.34Z"}})])};i._withStripped=!0;const s={components:{SvgIcon:r(150).A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},39335:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{"fill-rule":"evenodd",d:"M8.003 1.75A6.251 6.251 0 0 0 1.75 8c0 3.445 2.799 6.244 6.248 6.25A6.251 6.251 0 0 0 14.25 8a6.246 6.246 0 0 0-6.247-6.25ZM.25 8C.25 3.72 3.721.25 8.003.25A7.746 7.746 0 0 1 15.75 8c0 4.28-3.471 7.75-7.753 7.75h-.001C3.72 15.743.25 12.275.25 8ZM8 3.25a.75.75 0 0 1 .75.75v.314c.658.137 1.247.488 1.617 1.01a.75.75 0 0 1-1.224.867.995.995 0 0 0-.393-.309v1.52c.386.126.777.29 1.107.519.475.328.893.841.893 1.579 0 1.163-.94 1.956-2 2.183V12a.75.75 0 0 1-1.5 0v-.375a4.886 4.886 0 0 1-1.717-.85.75.75 0 1 1 .934-1.173c.223.177.503.33.783.444V8.505a4.017 4.017 0 0 1-.868-.435c-.479-.33-.88-.839-.88-1.57 0-1.07.796-1.827 1.748-2.118V4A.75.75 0 0 1 8 3.25Zm-.75 2.792c-.17.151-.249.33-.249.458 0 .096.027.193.232.335l.017.011v-.804Zm1.5 2.968v1.112c.344-.162.5-.442.5-.622 0-.09-.029-.195-.245-.345a1.88 1.88 0 0 0-.255-.145Z","clip-rule":"evenodd"}})])};i._withStripped=!0;const s={components:{SvgIcon:r(150).A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},96986:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M12.95 3.174H3.217c-.67 0-1.21.547-1.21 1.216L2 11.69c0 .67.547 1.217 1.217 1.217h9.733a1.22 1.22 0 0 0 1.217-1.216v-7.3a1.22 1.22 0 0 0-1.217-1.217Zm0 2.433L8.083 8.65 3.217 5.607V4.39l4.866 3.042L12.95 4.39v1.217Z"}})])};i._withStripped=!0;const s={components:{SvgIcon:r(150).A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},88732:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M8.97536 14.9977V8.62306H11.1259L11.4456 6.12719H8.97536V4.53743C8.97536 3.81722 9.17602 3.32411 10.2097 3.32411H11.5194V1.09891C10.8822 1.03061 10.2416 0.997637 9.60068 1.00013C7.69981 1.00013 6.39471 2.16057 6.39471 4.29088V6.12253H4.25818V8.61839H6.39938V14.9977H8.97536Z"}})])};i._withStripped=!0;const s={components:{SvgIcon:r(150).A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},91440:(t,e,r)=>{r.d(e,{A:()=>o});var i=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M15 3.52a5.815 5.815 0 0 1-1.435 1.484 8.222 8.222 0 0 1-1.353 4.888 8.725 8.725 0 0 1-1.644 1.87c-.636.544-1.401.977-2.294 1.3a8.378 8.378 0 0 1-2.871.484A7.994 7.994 0 0 1 1 12.256a6.2 6.2 0 0 0 .685.04 5.63 5.63 0 0 0 3.567-1.23 2.785 2.785 0 0 1-1.667-.574A2.823 2.823 0 0 1 2.57 9.07a2.886 2.886 0 0 0 1.297-.048 2.797 2.797 0 0 1-1.649-.99 2.779 2.779 0 0 1-.655-1.825v-.036c.407.226.84.345 1.301.36a2.856 2.856 0 0 1-.933-1.024 2.803 2.803 0 0 1-.345-1.366c0-.516.13-.997.388-1.443a8.176 8.176 0 0 0 2.62 2.12 7.981 7.981 0 0 0 3.3.881 2.797 2.797 0 0 1-.076-.653c0-.793.28-1.47.842-2.03a2.767 2.767 0 0 1 2.03-.842c.83 0 1.53.302 2.097.906a5.72 5.72 0 0 0 1.824-.697 2.777 2.777 0 0 1-1.262 1.59A5.744 5.744 0 0 0 15 3.52Z"}})])};i._withStripped=!0;const s={components:{SvgIcon:r(150).A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const o=(0,r(19468).A)(s,i,[],!1,null,null,null).exports},45132:(t,e,r)=>{r.r(e),r.d(e,{default:()=>Qs});var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{attrs:{"data-r-plus":t.isRakPlus}},[t.recommendedStoresPromo?t._e():e("coupons-magic",{on:{showedCBCTA:function(e){t.CAAshowedResultsCBCTA=!0}}}),t.components.takeover&&!t.merchant.activated?e("takeover-prevention-view"):t.components.cartReminder?e("cart-reminder-view",{attrs:{merchant:t.merchant,cartTotal:t.cart?.cart_total/100}}):t.renderNotification?[t.recommendedStoresPromo?e("recommended-stores-view",{attrs:{promo:t.recommendedStoresPromo},on:{"recommended-rendered":function(e){return t.$emit("recommended-rendered")}}}):t.isRABVisible?e("action-button-view",{on:{onClose:t.onRabClose}}):t.components.notification?e("notification-view",{on:{onClose:t.onNotificationClose}}):t._e()]:t._e(),e("post-purchase")],2)};i._withStripped=!0;var s=r(45091),o=r(72538),a=r.n(o),n=r(57591),c=r(96450),l=r(83442),d=r(64785),u=r.n(d),h=r(77684),p=r.n(h),m=r(85619),v=r.n(m),f=r(71292),g=r(261),_=r(80326),C=r(17318),b=r(74651),y=r(14064);class k extends(u()){productPageScraperTimeout=null;isProductScraperInitiated=!1;isCartScraperInitiated=!1;constructor({merchant:t,settings:e}){super(),this.merchant=t,this.settings=e}isStoreEligible(t){const e=l.o.get("cartScraperStoreList"),r=l.o.get("cartScraperBlockList");return e&&Array.isArray(e.storeIds)?e.storeIds.includes(t.storeId):!r||!Array.isArray(r.storeIds)||!r.storeIds.includes(t.storeId)}isNpCouponMerchant(t){return t.isCaaWithoutActivation&&!t.offers_cb}shouldSkipCartScraper(){return this.settings.loggingDisabled||this.isCartScraperInitiated||!l.o.get("fillr",!0)||!l.o.get("cartScraper")||"X"===this.merchant.incrementalityTest}async initCartScraper(){if(this.shouldSkipCartScraper())return;this.isCartScraperInitiated=!0;document.addEventListener("fillr:cart:detected",(async({detail:t})=>{if(this.emit("cart:detected",t),(this.merchant?.activated||this.isNpCouponMerchant(this.merchant))&&this.isStoreEligible(this.merchant)){const e=await(0,f.r)("getStoreContent",{storeId:this.merchant.storeId}),r=e?.freeShipping?.minimumSubtotal,i={store_name:this.merchant.storeName,store_id:this.merchant.storeId,tracking_ticket:this.merchant.shoppingTrip.ttn,product_list:t.product_list,cart_total:t.cart_total,cart_total_qty:t.cart_total_qty,currency:t.currency,timestamp:t.timestamp,page_url:t.page_url,free_shipping:r?t.cart_total/100>=r:null};g.m.track("Cart Details",i);const s=Array.isArray(t?.product_list)?t.product_list.map((e=>({quantity:e.quantity,total:{amount:e.line_total??0,precision:2,currency:t.currency},product:{name:e.name,price:{amount:e.item_price??0,precision:2,currency:t.currency},url:e.url,image_urls:e.imageUrls??(e.image_url?[e.image_url]:[])}}))):[];(0,y.l)(C.s.CartDetailsCaptured,{data:{tracking_ticket:this.merchant.shoppingTrip.ttn??null,store:{id:this.merchant.storeId,name:this.merchant.storeName},total:{amount:t.cart_total,precision:2,currency:t.currency},total_qty:t.cart_total_qty,subtotal:{amount:t.cart_subtotal??0,precision:2,currency:t.currency},items:s,cart_scraper_version:t.version}})}})),p().setDevKey(_.$.get("FILLR_DEVKEY")),p().start()}async initProductPageScraper(){let t=location.pathname;if(this.settings.loggingDisabled||this.isProductScraperInitiated||!l.o.get("fillr",!0)||!l.o.get("productScraper")||!this.merchant||!this.isStoreEligible(this.merchant)||"X"===this.merchant.incrementalityTest)return;this.isProductScraperInitiated=!0;new MutationObserver((0,s.debounce)((()=>{t!==location.pathname&&(t=location.pathname,v().scrape())}),1e3)).observe(document.body,{attributes:!1,childList:!0,subtree:!0,characterData:!1});let e={};const r=t=>{if(this.merchant?.activated){const e={store_name:this.merchant.storeName,store_id:this.merchant.storeId,tracking_ticket:this.merchant.shoppingTrip.ttn,...t};g.m.track("Product Details",e),async function(t,e){let r="";try{const t=new URL(e.shoppingTrip.startURL??"");r=t.host+t.pathname}catch{}const i=location.host+location.pathname,s="Price Magic"===e.shoppingTrip.source,o=e.needsPriceCheck;if(l.o.get("pmPriceCheck")&&o&&s&&i===r){const r=e.shoppingTrip.product?.salePrice,s=parseFloat(t?.price?.[0]?.amount),o=e.shoppingTrip.product;if(o&&r&&s>=0&&r!==s){const a=(t,o)=>({price_magic_product:{store_id:t.storeId,store_name:t.store,brand:t.brand,title:t.title,url:t.productUrl,price:r,mpn:t.mpns?.toString(),sku:t.skus?.toString(),upc:t.upcs?.toString(),listing_id:t.listing_id,category_name:t.categoryName,category_id:t.categoryId},scraped_product:{store_id:e.storeId,store_name:e.storeName,brand:o.brand?.map((t=>t.brand)).toString(),title:o.name?.map((t=>t.brand)).toString(),url:i,price:s,mpn:o.mpn?.toString(),sku:o.sku?.toString(),upc:o.upc?.toString(),category:o.category?.map((t=>t.category)).toString()},price_difference:Math.abs(r-s)});(0,y.l)(C.s.PriceMagicMismatch,{data:a(o,t)})}}(0,b.a)(e.storeId,{needsPriceCheck:!1})}(t,this.merchant)}};document.addEventListener("fillr:product:data:scraped",(({detail:t})=>{try{const i=JSON.parse(t).product;(0,s.isEqual)(i,e)||(e=i,r(i),this.emit("product:data:scraped",i))}catch(t){}})),v().start()}}var x=r(84383),A=r(4337),w=r(77115),S=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.orderConfirmation?e("order-confirmation"):t._e()};S._withStripped=!0;var T=r(79602),$=r.n(T),M=r(5763),L=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("transition",{attrs:{name:"rr-slide-fade"}},[t.components.orderConfirmation?e("order-confirmation-form",{attrs:{merchant:t.merchant,entityName:t.entity_name,abandonedProducts:t.abandonedProducts,memberPayableNowAmount:t.memberPayableNowAmount,bonusAmount:t.bonusAmount,redeemThresholdAmount:t.tafSettings?.redeemThresholdAmount,qrCodeUrl:t.qrCodeUrl,paymentMethodTestA:t.paymentMethodTestA},on:{askPermission:t.askPermission,updateAddress:t.updateAddress,choosePayment:t.choosePayment,clickClose:t.clickClose,openReferralTermsPage:t.openReferralTermsPage,track:t.track,navigate:t.navigate}}):t._e()],1)};L._withStripped=!0;var P=r(10399),I=r(38734),B=r(94042),E=r(184),R=r(26790),N=r(18138),O=r(13809),H=r(47004),D=r(5741),V=function(){var t=this,e=t._self._c;return e("r-form",{staticClass:"rr-order-confirmation",attrs:{"data-tid":"order-confirmation",headerLogo:"none",width:"auto",padding:"",rakPlus:t.rakPlus},on:{close:function(e){return t.$emit("clickClose")}},scopedSlots:t._u([t.isMobileExtension?null:{key:"banner",fn:function(){return[t.isFeedEnabled?e("radiant-feed",{attrs:{slugName:`store/${t.merchant.siteUrl}/button/post-purchase`,storeId:t.merchant.storeId,moduleType:`${t.module_type}_Ad`}}):t._e()]},proxy:!0}],null,!0)},[t.isMobileExtension?e("order-confirmation-mobile",{attrs:{qrCodeUrl:t.qrCodeUrl}}):t.isAbandonment?e("order-confirmation-abandonment",{attrs:{abandonedProducts:t.abandonedProducts,rakPlus:t.rakPlus},on:{track:function(e){return t.$emit("track")},navigate:function(e){return t.$emit("navigate")}}}):t.paymentMethodTestA?e("order-confirmation-payment-method",{attrs:{memberPayableNowAmount:t.memberPayableNowAmount,rakPlus:t.rakPlus},on:{choosePayment:function(e){return t.$emit("choosePayment")}}}):t.isAddress?e("order-confirmation-address",{attrs:{rakPlus:t.rakPlus},on:{updateAddress:function(e){return t.$emit("updateAddress")}}}):t.isRAF?e("order-confirmation-raf",{attrs:{merchant:t.merchant,bonusAmount:t.bonusAmount,redeemThresholdAmount:t.redeemThresholdAmount,module_type:t.module_type,rakPlus:t.rakPlus},on:{openReferralTermsPage:function(e){return t.$emit("openReferralTermsPage")}}}):e("order-confirmation-desktop",{attrs:{rakPlus:t.rakPlus},on:{askPermission:function(e){return t.$emit("askPermission")}}})],1)};V._withStripped=!0;var F=r(69582),W=r(72551),z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-pa-32",staticStyle:{width:"420px"}},[e("div",{staticClass:"rr-flex rr-flex-col"},[e("r-heading-logo",{attrs:{size:"small"}}),e("div",{staticClass:"rr-text-primary rr-t-h2 rr-mt-16 rr-mb-8"},[t._v(" "+t._s(t.$t("orderConfirmation.mobileExtension.title"))+" ")]),e("div",{staticClass:"rr-t-descriptor-s rr-fw-book rr-mb-24 rr-mr-24"},[t._v(" "+t._s(t.$t("orderConfirmation.mobileExtension.description"))+" ")])],1),e("div",{staticClass:"rr-flex rr-flex-row"},[e("div",{staticClass:"rr-mr-24 rr-flex-shrink-0 rr-shadow-default rr-bg-default rr-box-border rr-pa-12 rr-order-confirmation__qr-code",staticStyle:{width:"120px",height:"120px"}},[e("qrcode-vue",{attrs:{value:t.qrCodeUrl,size:96,renderAs:"svg"}})],1),e("div",[e("div",{staticClass:"rr-t-h3 rr-mr-24"},[t._v(" "+t._s(t.$t("orderConfirmation.mobileExtension.qrCode.title"))+" ")]),e("div",{staticClass:"rr-t-body rr-mt-16"},[t._v(" "+t._s(t.$t("orderConfirmation.mobileExtension.qrCode.description"))+" ")])])])])};z._withStripped=!0;var j=r(78711),q=r(41365);const U={components:{RHeadingLogo:q.A,QrcodeVue:j.A},props:{qrCodeUrl:{type:String,default:""}}};var Y=r(19468);const Z=(0,Y.A)(U,z,[],!1,null,null,null).exports;var G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-pa-32 rr-box-border rr-flex rr-flex-col rr-items-center rr-text-center rr-overflow-hidden",staticStyle:{width:"304px"}},[e("div",{staticClass:"rr-order-confirmation__confetti"}),e("r-heading-logo",{staticStyle:{"padding-top":"68px"},attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-primary rr-mt-24 rr-mb-16 rr-t-h2"},[t._v(" "+t._s(t.$t("orderConfirmation.desktopNotification.title"))+" ")]),e("div",{staticClass:"rr-t-subheader-s"},[t._v(" "+t._s(t.$t("orderConfirmation.desktopNotification.description"))+" ")]),e("r-button",{staticClass:"rr-mt-24 rr-w-full",attrs:{block:""},on:{click:function(e){return t.$emit("askPermission")}}},[t._v(" "+t._s(t.$t("orderConfirmation.desktopNotification.cta"))+" ")])],1)};G._withStripped=!0;var X=r(35337);const Q={components:{RButton:X.A,RHeadingLogo:q.A},props:{rakPlus:{type:Boolean,default:!1}}};const K=(0,Y.A)(Q,G,[],!1,null,null,null).exports;var J=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"rr-pa-32 rr-box-border rr-flex rr-flex-col rr-items-center rr-text-center rr-overflow-hidden",staticStyle:{width:"304px"}},[e("div",{staticClass:"rr-order-confirmation__confetti"}),e("r-heading-logo",{staticStyle:{"padding-top":"68px"},attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-primary rr-mt-24 rr-mb-16 rr-t-h1"},[t.rakPlus?[e("i18n",{attrs:{path:"orderConfirmation.raf.titleRakPlus",tag:"div"},scopedSlots:t._u([{key:"storeName",fn:function(){return[t._v(" "+t._s(t.merchant.storeName)+" ")]},proxy:!0},{key:"bonus",fn:function(){return[e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.bonusAmount))])]},proxy:!0}],null,!1,3548163859)})]:t.isMerchantRAF?[e("i18n",{attrs:{path:"orderConfirmation.raf.title",tag:"div"},scopedSlots:t._u([{key:"amount",fn:function(){return[t._v(" "+t._s(t.cashBackAmount)+" ")]},proxy:!0},{key:"storeName",fn:function(){return[t._v(" "+t._s(t.merchant.storeName)+" ")]},proxy:!0},{key:"bonus",fn:function(){return[e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.bonusAmount))])]},proxy:!0}])})]:[t._v(" "+t._s(t.$t("orderConfirmation.raf.titleNonMerchant",{bonus:t.bonusAmount.replace("+","")}))+" ")]],2),e("div",{staticClass:"rr-t-descriptor-s"},[t._v(" "+t._s(t.description)+" ")]),e("div",{staticClass:"rr-t-tag-small rr-mb-16 rr-mt-24"},[t._v(" "+t._s(t.$t("orderConfirmation.referText"))+" ")]),e("r-share-buttons",{attrs:{source:t.module_type,merchant:t.merchant}}),e("div",{staticClass:"rr-t-descriptor-xs rr-text-tertiary rr-mt-8 rr-mb-4"},[t._v(" *"),e("r-link",{staticClass:"rr-text-tertiary rr-order-confirmation__link",on:{click:function(e){return t.$emit("openReferralTermsPage")}}},[t._v(" "+t._s(t.$t("orderConfirmation.termsApply"))+" ")])],1)],1)};J._withStripped=!0;var tt=r(93423),et=r(29123),rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-justify-center"},[e("r-icon-button",{staticClass:"rr-ma-8",attrs:{isInverse:"",flat:"",rounded:"",size:"40px",title:t.$t("shareButtons.sendEmail")},on:{click:t.shareEmail}},[e("email-icon",{attrs:{size:"24"}})],1),e("r-icon-button",{staticClass:"rr-ma-8",attrs:{isInverse:"",flat:"",rounded:"",size:"40px",title:t.$t("shareButtons.copyReferralLink")},on:{click:t.shareLink}},[t.shareLinkActive?e("check-icon",{attrs:{size:"24"}}):e("link-icon",{attrs:{size:"24"}})],1),e("r-icon-button",{staticClass:"rr-ma-8",attrs:{isInverse:"",flat:"",rounded:"",size:"40px",title:t.$t("shareButtons.shareOnFacebook")},on:{click:t.shareFacebook}},[e("facebook-icon",{attrs:{size:"24"}})],1),e("r-icon-button",{staticClass:"rr-ma-8",attrs:{isInverse:"",flat:"",rounded:"",size:"40px",title:t.$t("shareButtons.shareOnTwitter")},on:{click:t.shareTwitter}},[e("twitter-icon",{attrs:{size:"24"}})],1)],1)};rt._withStripped=!0;var it=r(51564),st=r(17925),ot=r(96986),at=r(88732),nt=r(91440),ct=r(41800),lt=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 24 24"}},"svg-icon",t.$props,!1),[e("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20.558 10.0956C23.5801 7.12494 21.5437 2.06793 17.3068 1.99854C16.0787 2.0032 14.9006 2.48506 14.0217 3.34215C13.218 4.13801 12.4178 4.93806 11.6177 5.73798C11.2541 6.10154 10.8905 6.46506 10.5267 6.82816C10.4612 6.88357 10.4153 6.9586 10.3959 7.04212C10.3764 7.12563 10.3845 7.21319 10.4188 7.29178C10.4494 7.37188 10.5054 7.43977 10.5782 7.4851C10.6511 7.53042 10.7368 7.55068 10.8222 7.54278C11.5678 7.52986 12.3083 7.66799 12.999 7.94882C13.0882 7.98529 13.1871 7.99055 13.2797 7.96375C13.3723 7.93694 13.453 7.87964 13.5089 7.80117C13.7965 7.51429 14.0836 7.22703 14.3707 6.9398C14.8874 6.42284 15.404 5.90596 15.9236 5.39153C16.1623 5.1415 16.4661 4.96301 16.8008 4.87614C17.1355 4.78928 17.4879 4.79749 17.8182 4.89985C18.1371 4.99486 18.4257 5.17152 18.6552 5.4123C18.8847 5.65309 19.0473 5.94964 19.1268 6.27255C19.2062 6.59547 19.1998 6.93352 19.1082 7.2532C19.0165 7.57287 18.8429 7.86306 18.6044 8.09499L16.4379 10.2566C16.2236 10.4702 16.0096 10.6843 15.7955 10.8985C15.3247 11.3694 14.8537 11.8405 14.3793 12.3074C14.0244 12.6472 13.5519 12.8369 13.0604 12.8369C12.5688 12.8369 12.0963 12.6472 11.7414 12.3074C10.3345 11.045 8.47251 12.8892 9.77741 14.2815C10.1967 14.6966 10.6919 15.0275 11.236 15.256C12.9458 15.9883 15.0857 15.5867 16.3921 14.2579C17.0874 13.5654 17.7813 12.871 18.4751 12.1767C19.1689 11.4824 19.8627 10.7881 20.558 10.0956ZM2.42532 19.2352C3.27359 20.9937 4.69228 21.8796 6.43018 22.0007C6.9766 22.0192 7.52256 21.9525 8.04838 21.8028C8.77971 21.5886 9.44641 21.1964 9.98874 20.6615C10.8912 19.7608 11.7931 18.8601 12.6946 17.9595L13.4852 17.1696C13.5364 17.1238 13.575 17.0658 13.5974 17.0009C13.6197 16.9361 13.6251 16.8666 13.6129 16.7991C13.6008 16.7316 13.5715 16.6683 13.528 16.6153C13.4844 16.5623 13.428 16.5213 13.364 16.4963C13.2859 16.471 13.2037 16.4605 13.1217 16.4653C12.3947 16.471 11.6737 16.3341 10.9996 16.0622C10.9214 16.0266 10.8338 16.0171 10.7498 16.0349C10.6657 16.0527 10.5896 16.0969 10.5326 16.1611C10.2856 16.4083 10.0391 16.6558 9.79257 16.9034C9.2173 17.481 8.64202 18.0587 8.06168 18.6313C7.80688 18.9031 7.47533 19.0911 7.11107 19.1702C6.74681 19.2494 6.36707 19.2159 6.02231 19.0742C5.72543 18.9611 5.46149 18.7758 5.25443 18.535C5.04736 18.2942 4.90371 18.0056 4.83649 17.6954C4.76928 17.3851 4.78062 17.063 4.8695 16.7582C4.95838 16.4534 5.12198 16.1756 5.34547 15.95L6.81293 14.4838L9.59121 11.7095C9.8756 11.421 10.2488 11.2364 10.6508 11.1853C10.9471 11.1427 11.2492 11.1694 11.5334 11.2635C11.8176 11.3575 12.076 11.5163 12.2882 11.7272C12.5511 11.9714 12.8984 12.1044 13.2573 12.0982C13.6163 12.092 13.9588 11.947 14.213 11.6938C14.4672 11.4406 14.6133 11.0988 14.6206 10.7402C14.6279 10.3816 14.4959 10.0342 14.2522 9.77082C13.5539 9.05905 12.6433 8.59277 11.6572 8.44197C11.0816 8.34733 10.4931 8.36387 9.92371 8.4907C9.1435 8.65047 8.4195 9.01368 7.82523 9.54344C7.52081 9.81841 7.23177 10.1104 6.94317 10.402C6.85209 10.494 6.76105 10.586 6.66958 10.6774C6.31301 11.0337 5.95692 11.3906 5.60078 11.7475C4.8883 12.4617 4.17561 13.1761 3.45831 13.8858C2.58922 14.7155 2.071 15.8461 2.01006 17.0455C1.95663 17.799 2.09971 18.5535 2.42532 19.2352Z"}})])};lt._withStripped=!0;var dt=r(150);const ut={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const ht={components:{LinkIcon:(0,Y.A)(ut,lt,[],!1,null,null,null).exports,CheckIcon:ct.A,RIconButton:st.A,EmailIcon:ot.A,FacebookIcon:at.A,TwitterIcon:nt.A},props:{source:{type:String,required:!0},merchant:{type:Object,default:null}},data:()=>({shareLinkActive:!1}),watch:{shareLinkActive(t){t&&setTimeout((()=>this.shareLinkActive=!1),1e3)}},methods:{async shareEmail(){this.share("Email"),this.$emit("click","Email")},async shareLink(){if(this.shareLinkActive)return;this.shareLinkActive=!0;const t=await this.share("Copy");(0,it.l)(t),this.$emit("click","Copy")},async shareFacebook(){this.share("Facebook"),this.$emit("click","Facebook")},async shareTwitter(){this.share("Twitter"),this.$emit("click","Twitter")},share(t){const{availHeight:e,availWidth:r}=screen;return(0,f.r)("share",{source:this.source,merchant:this.merchant,method:t,screen:{availHeight:e,availWidth:r}})}}};const pt=(0,Y.A)(ht,rt,[],!1,null,null,null).exports,mt=a().extend({components:{RShareButtons:pt,RLink:et.A,RHeadingLogo:q.A},props:{merchant:{type:Object,required:!0},bonusAmount:{type:String,default:""},redeemThresholdAmount:{type:String,default:""},memberReferralAmount:{type:Number,default:null},rakPlus:{type:Boolean,default:!1}},data:()=>({module_type:D.df}),computed:{...(0,n.L8)(["currency"]),isMerchantRAF:()=>l.o.get("ppMerchantRAF",!0),description(){const t=this.bonusAmount,e=this.redeemThresholdAmount;return this.isMerchantRAF?this.$t("orderConfirmation.raf.description",{bonus:t,threshold:e}):this.$t("orderConfirmation.raf.descriptionNonMerchant",{bonus:t})},cashBackAmount(){return(0,tt.a)(this.merchant.shoppingTrip.reward).toLowerCase()}}});const vt=(0,Y.A)(mt,J,[],!1,null,null,null).exports;var ft=function(){var t=this,e=t._self._c;return e("perfect-scrollbar",{staticClass:"rr-box-border rr-flex rr-flex-col rr-items-center rr-text-center rr-overflow-hidden",staticStyle:{width:"380px","max-height":"820px"}},[e("div",{staticClass:"rr-order-confirmation__confetti"}),e("r-heading-logo",{staticStyle:{"padding-top":"68px"},attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-primary rr-mt-24 rr-mb-16 rr-t-hero-small rr-mb-8 rr-px-40"},[t._v(" "+t._s(t.$t("orderConfirmation.cartAbandonment.title"))+" ")]),e("div",{staticClass:"rr-t-subheader-s"},[t._v(" "+t._s(t.$t("orderConfirmation.cartAbandonment.subtitle"))+" ")]),e("div",{staticClass:"rr-t-tag-small rr-mt-32"},[t._v(" "+t._s(t.$t("orderConfirmation.cartAbandonment.stillGotYourEye"))+" ")]),e("div",{staticClass:"rr-t-tag-small rr-mb-32"},[t._v(" "+t._s(t.$t("orderConfirmation.cartAbandonment.headToTheStore"))+" ")]),e("div",{staticClass:"rr-px-24 rr-pt-8 rr-mb-32",class:t.abandonedProducts.length>1?"rr-grid-cols-2 rr-grid rr-gap-x-16 rr-gap-y-24":"rr-flex rr-justify-center"},t._l(t.abandonedProducts,(function(r,i){return e("product-tile",{key:i,attrs:{product:r},on:{click:function(e){return t.itemClick(r)}}})})),1)],1)};ft._withStripped=!0;var gt=r(31170),_t=r.n(gt),Ct=r(28413),bt=r(14663);a().use(_t());const yt="Cart Abandonment PPC",kt={components:{ProductTile:Ct.A,RHeadingLogo:q.A},props:{abandonedProducts:{type:Array,default:()=>[]},rakPlus:{type:Boolean,default:!1}},methods:{async itemClick(t){this.$emit("track","Click Module",{module_type:D.df,entity_name:yt,domain:t.productUrl,cta_type:"product_item",cta_item:(0,N.N)(t)});const e=t.merchant;e.affiliatizerEnabled&&(e.offers_cb||"Coupons"===e.reward.display)?await(0,bt.Y)(e.storeId,{store_url:t.productUrl,product_url:t.productUrl,tabId:P.A.browser.NEWTAB,sessionAttributes:{source:`${D.df} ${yt}`,event_attributes:{previous_ca_tracking_ticket:t.previous_ca_tracking_ticket}}}):this.$emit("navigate",t.productUrl)}}},xt=kt;const At=(0,Y.A)(xt,ft,[],!1,null,null,null).exports;var wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-pa-32 rr-box-border rr-flex rr-flex-col rr-items-center rr-text-center rr-overflow-hidden",staticStyle:{width:"304px"}},[e("div",{staticClass:"rr-order-confirmation__confetti"}),e("r-heading-logo",{staticStyle:{"padding-top":"68px"},attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-primary rr-mt-24 rr-mb-16 rr-t-h2"},[t._v(" "+t._s(t.$t("orderConfirmation.address.title"))+" ")]),e("div",{staticClass:"rr-t-subheader-s"},[t._v(" "+t._s(t.$t("orderConfirmation.address.description"))+" ")]),e("r-button",{staticClass:"rr-mt-24 rr-w-full",attrs:{block:""},on:{click:function(e){return t.$emit("updateAddress")}}},[t._v(" "+t._s(t.$t("orderConfirmation.address.cta"))+" ")])],1)};wt._withStripped=!0;const St={components:{RButton:X.A,RHeadingLogo:q.A},props:{rakPlus:{type:Boolean,default:!1}}};const Tt=(0,Y.A)(St,wt,[],!1,null,null,null).exports;var $t=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"rr-pa-32 rr-box-border rr-flex rr-flex-col rr-items-center rr-text-center rr-overflow-hidden",staticStyle:{width:"360px"}},[e("div",{staticClass:"rr-w-full rr-absolute r-confirmation-payment-method"}),e("r-heading-logo",{attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-primary rr-my-24 rr-t-h1"},[t._v(" "+t._s(t.$t("orderConfirmation.paymentMethod.title"))+" ")]),e("img",{staticClass:"rr-mb-24 rr-w-full",attrs:{src:t.paymentMethodImageSrc,alt:t.$t("orderConfirmation.paymentMethod.imageAlt")}}),t.memberPayableNowAmount?e("div",{staticClass:"rr-mb-16 rr-flex rr-items-center rr-justify-center rr-py-12 rr-border-icon-container rr-w-full rr-rounded-ui rr-t-descriptor-s"},[e("dollar-icon",{staticClass:"rr-text-action rr-mr-4"}),e("span",[t._v(t._s(t.$t("orderConfirmation.paymentMethod.balance",{amount:t.formattedMemberPayableNowAmount})))])],1):t._e(),e("div",{staticClass:"rr-t-body"},[t._v(" "+t._s(t.memberPayableNowAmount?t.$t("orderConfirmation.paymentMethod.description"):t.$t("orderConfirmation.paymentMethod.descriptionNoBalance"))+" ")]),e("r-button",{staticClass:"rr-mt-24 rr-w-full",attrs:{block:""},on:{click:function(e){return t.$emit("choosePayment")}}},[t._v(" "+t._s(t.$t("orderConfirmation.paymentMethod.cta"))+" ")])],1)};$t._withStripped=!0;var Mt=r(70879),Lt=r(53687),Pt=r(39335);const It=a().extend({components:{DollarIcon:Pt.A,RButton:X.A,RHeadingLogo:q.A},props:{memberPayableNowAmount:{type:Number,default:null},rakPlus:{type:Boolean,default:!1}},computed:{...(0,n.L8)(["currency"]),formattedMemberPayableNowAmount(){return(0,Mt.u)(this.memberPayableNowAmount,this.currency)},paymentMethodImageSrc:()=>(0,Lt.s)("img/payment-methods.png")}});const Bt={components:{OrderConfirmationPaymentMethod:(0,Y.A)(It,$t,[],!1,null,null,null).exports,OrderConfirmationAddress:Tt,OrderConfirmationAbandonment:At,OrderConfirmationRaf:vt,OrderConfirmationDesktop:K,OrderConfirmationMobile:Z,RForm:F.A,RadiantFeed:W.A},props:{merchant:{type:Object,required:!0},entityName:{type:String,required:!0},abandonedProducts:{type:Array,default:()=>[]},memberPayableNowAmount:{type:Number,default:null},bonusAmount:{type:String,default:""},redeemThresholdAmount:{type:String,default:""},tafSettings:{type:Object,default:()=>({})},qrCodeUrl:{type:String,default:""},paymentMethodTestA:{type:Boolean,default:!1}},data:()=>({category:"PostPurchase",module_type:D.df}),computed:{isMobileExtension(){return"Mobile Extension"===this.entityName},isAddress(){return"Address"===this.entityName},isDesktopNotification(){return"Desktop Notification"===this.entityName},isRAF(){return"RAF"===this.entityName},isAbandonment(){return"Cart Abandonment PPC"===this.entityName},isFeedEnabled(){return l.o.get("feed",!0)&&!this.isAbandonment},rakPlus(){return this.merchant.reward.rakplusTargeted}}};const Et=(0,Y.A)(Bt,V,[],!1,null,null,null).exports,Rt="Address",Nt="Desktop Notification",Ot="RAF",Ht="Mobile Extension",Dt="Cart Abandonment PPC",Vt=a().extend({components:{OrderConfirmationForm:Et},data:()=>({category:"PostPurchase",module_type:D.df,entity_name:"",visible:!1,qrCodeUrl:"",abandonedProducts:[],tafSettings:null,paymentMethodTest:"",aymentMethodTestA:!1}),computed:{...(0,n.aH)(["merchant","settings","member","components"]),memberPayableNowAmount(){const t=this.member?.balance,e=t?.display_values.confirmed;return e>5.01?e:null},bonusAmount(){return this.tafSettings?.referBonusAmount},paymentMethodTestA(){return"A"===this.paymentMethodTest}},async mounted(){if(this.entity_name=await this.calcEntityName(),this.entity_name){if(this.entity_name===Ht){const t=await(0,f.r)("getSessionID"),e=encodeURIComponent(t);this.qrCodeUrl=(0,I.Gu)((0,B.V)(H.A.WEB_MOBILE_EXTENSION),{desktop_session_id:e})}else this.entity_name===Ot&&(this.tafSettings=await(0,f.r)("getTafSettings",{force:!0}),await this.fetchMember());this.show()}},methods:{async fetchMember(){return await this.$store.dispatch("fetchMember"),this.member},async calcEntityName(t=[Dt,Ht,Rt,Nt,Ot]){const e=(await P.A.extension.getItem("postPurchaseCounter")||0)%t.length;for(let r=e;r<e+t.length;++r){const e=r%t.length,i=t[e];if(P.A.extension.setItem("postPurchaseCounter",e+1),i===Dt&&await this.checkAndSetAbandonedProducts())return Dt;if(i===Rt&&await this.isAddressEligible())return this.paymentMethodTest=l.o.get("ppAddressChoose")?await c.r.activate("BTN206",{storeId:this.merchant.storeId}):"",Rt;if(i===Nt&&this.isDesktopNotificationEligible())return Nt;if(i===Ht&&await this.isUserElegibleToInstallSafariButton())return Ht;if(l.o.get("ppRAF",!0)&&i===Ot)return Ot}return l.o.get("ppRAF",!0)?Ot:""},async checkAndSetAbandonedProducts(){if(!l.o.get("ppAbandonment",!0))return!1;const t=await(0,f.r)("getProductsPostPurchase");return this.abandonedProducts=t?.filter((t=>t.merchant.storeId!==this.merchant.storeId)).slice(0,6),0!==this.abandonedProducts?.length},async isAddressEligible(){return l.o.get("ppAddress",!0)&&await this.fetchMember()&&this.member&&"PayPal"!==this.member.paymentMethod&&!this.member.hasPaymentAddress?.postal&&!this.member.isAmexUser},isDesktopNotificationEligible(){return l.o.get("ppDesktopNotifications",!0)&&l.o.get("desktopNotifications",!0)&&P.A.browser.isWebkit&&"granted"!==this.settings.notificationsEnabled},track(t,e={}){return this.entity_name===Ot&&(e.type=(this.member?.hasReferral?"has":"never")+" referred"),this.paymentMethodTest&&(e.cash_back_balance=this.member?.balance?.display_values?.confirmed),g.m.track(t,{module_type:this.module_type,entity_name:this.entity_name,store_name:this.merchant.storeName,store_id:this.merchant.storeId,...e})},askPermission(){this.track("Click Module",{cta_type:"Enable Desktop Notifications"}),(0,f.r)("getBrowserNotificationPermission","Post Purchase")},updateAddress(){this.navigate((0,B.V)(H.A.WEB_ADD_ADDRESS))},choosePayment(){this.navigate((0,B.V)(H.A.WEB_CHOOSE_PAYMENT))},getCashBackDetails(){return{store_name:this.merchant.storeName,store_id:this.merchant.storeId,...(0,E.D)(this.merchant.shoppingTrip.reward)}},show(){if(this.$store.dispatch("updateComponents",{orderConfirmation:!0}),this.$store.dispatch("updateMerchant",{notificationConfirmation:!1}),this.module_type&&this.entity_name)if(this.entity_name===Dt){const t={domain:(0,R.F)(document.location.href),displayed_item_count:this.abandonedProducts.length,product_list:this.abandonedProducts.map((t=>(0,N.N)(t)))};this.track("View Module",t)}else{const t=(0,E.D)(this.merchant.shoppingTrip.reward);this.track("View Module",t)}this.entity_name===Ot&&(this.track("Visit Refer A Friend",{referral_token:this.member?.shortURLToken,source:D.df,...this.getCashBackDetails()}),(0,f.r)("holistic.track",{event:C.s.ReferAFriendViewed,data:{attribution_source:D.df}})),this.$forceUpdate()},clickClose(){this.hide(),this.module_type&&this.entity_name&&this.track("Click Module",{cta_type:"close"})},hide(){this.$store.dispatch("updateComponents",{orderConfirmation:!1}),this.$store.dispatch("updateMerchant",{notificationConfirmation:!1}),setTimeout((()=>this.$destroy()),200)},openReferralTermsPage(){this.navigate((0,B.V)(H.A.WEB_TC))},navigate(t){this.track("Visit Page",{preceding_screen_name:this.module_type,url:t}),setTimeout((()=>{(0,O.o)(t)}),100)},async isUserElegibleToInstallSafariButton(){if(l.o.get("ppMobile",!0)&&l.o.get("confirmationiOSExtension")){const t=await(0,f.r)("account-eds");return!!t?.targetSet?.find((({name:t,id:e})=>"Safari_Mobile_Extension_Nov2021"===t&&"2515"===e))}return!1}}});const Ft=(0,Y.A)(Vt,L,[],!1,null,null,null).exports,Wt=[],zt=Date.now(),jt=a().extend({name:"PostPurchaseView",components:{OrderConfirmation:Ft},data:()=>({isOrderConfirmation:!1,getShowOrderConfirmation:!1}),computed:{...(0,n.aH)(["merchant","settings","member"]),flag(){return this.merchant.orderConfirmationURLRegex||l.o.get("confirmation")},orderConfirmation(){return this.member&&this.isOrderConfirmation}},watch:{isOrderConfirmation(){this.$store.dispatch("getMember")}},created(){$()(window).on("error.ebConfirmation",(t=>{const e=t.originalEvent;Wt.push({code:"javascript",description:e.message,source:`${e.filename}:${e.lineno}`,timestamp:Date.now()})})),this.handlePage()},methods:{async handlePage(){const t=this.merchant,e=this.settings;try{const r=await function(t,e){return new Promise(((r,i)=>{if(!document.body)return void i("No document.body found");const o=(0,s.throttle)((()=>{const i=location.href;if(t.orderConfirmationURLRegex){if(new RegExp(t.orderConfirmationURLRegex).test(i)){const e=function(t){const{orderConfirmationDOMRegex:e}=t;let r=document.documentElement.innerHTML;if(10226===t.storeId)try{const t=document.getElementById("orderconfirmpixel");r=t.contentWindow?.document.documentElement.innerHTML??""}catch(t){}if(r&&(!e||new RegExp(e).test(r)))return r;return""}(t);e&&(a.disconnect(),r(e))}}else{const t=document.body?.innerText,s=document.documentElement.innerHTML,o=e.orderConfirmationConfig,{score:n}=(0,M.isOrderConfirmation)({url:i,html:s,text:t,config:o});n>=1&&(a.disconnect(),r(s))}}),1e3),a=new MutationObserver((t=>{t.some((t=>(t.addedNodes?.length??0)-(t.removedNodes?.length??0)>0))&&o()}));a.observe(document.body,{attributes:!1,childList:!0,subtree:!0}),window.setTimeout((()=>{a.disconnect(),i("No matches found")}),18e5),o()}))}(t,e);l.o.get("commerceCapture",!0)&&t.orderConfirmationURLRegex&&(0,f.r)("CaptureOrderPage",{content:r,load_time:Date.now()-zt,javascript_error:!!Wt.length,merchant:t});const i=await this.getOrderConfirmationEligibility(t,e,r);this.isOrderConfirmation=await this.showOrderConfirmation(t,i),$()(window).off("error.ebConfirmation")}catch(t){}$()(window).off("error.ebConfirmation")},async showOrderConfirmation(t,e=!1){return!!e&&(this.trackViewOrderConfirmation(t),t.isCaaWithoutActivation||!t.offers_cb?(this.$store.dispatch("updateMerchant",{notificationConfirmation:!1}),!1):"X"!==t.incrementalityTest)},trackViewOrderConfirmation(t){const e=document.body?.innerText,r=(0,M.getOrderConfirmationNumber)(e);g.m.track("View Order Confirmation",{store_id:t.storeId,location_flag:"merchant",url:location.host+location.pathname,on_ebates:t.storeId?"Y":"N",offers_cb:t.offers_cb?"Y":"N",ebates_trip:t.activated?"Y":"N",tracking_ticket:t.shoppingTrip.ttn||"None",order_confirmation_number:r,icb:t.icbEnabled,caa_without_activation:t.isCaaWithoutActivation?"Y":"N"}),(0,y.l)(C.s.OrderPlaced,{data:{tracking_ticket:t.shoppingTrip.ttn||"",store:{id:t.storeId,name:t.storeName},order:{id:0,store_order_number:r}}})},async getOrderConfirmationEligibility(t,e,r){const i=await this.isEligibleForNonPartner(t);return(r||l.o.get("confirmation"))&&e.postPurchaseMessage&&t.activated&&t.offers_cb&&t.notificationConfirmation||i},async isEligibleForNonPartner(t){const{isCaaWithoutActivation:e,notificationConfirmation:r,offers_cb:i,activated:s}=t;if(!i&&s)return!0;if(i||!e&&r)return!1;const o=await(0,f.r)("getCouponOffers",{storeId:this.merchant.storeId});return o?.length>0}}});const qt=jt;const Ut=(0,Y.A)(qt,S,[],!1,null,null,null).exports;var Yt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("transition",{attrs:{appear:"",name:"rr-slide-fade",css:t.transition}},[t.visible?e("aside",{staticClass:"ebates-notification",staticStyle:{"z-index":"2147483647 !important",width:"340px"},attrs:{"aria-label":t.$t("notification.ariaLabels.dialog"),role:"dialog"},on:{click:t.clickNotification}},[t.educationPopperVisible?e("education-popover",{attrs:{storeId:t.merchant.storeId,storeName:t.merchant.storeName,type:t.educationPopoverType,tierMessage:t.educationTierMessage}}):t._e(),e("div",{ref:"container",staticClass:"rr-rounded-ui",class:{"notification-container":t.backgroundActivation,"notification-container_activated":t.backgroundActivation&&t.merchant.activated},style:{height:t.containerHeight?`${t.containerHeight}px`:"auto"}},[e("div",{ref:"notification",staticClass:"rr-notification",attrs:{tabindex:"-1","aria-label":t.merchant.activated?t.$t("notification.ariaLabels.activated"):t.$t("notification.ariaLabels.reminder"),"aria-live":"polite","aria-describedby":t.isDescribedBlockVisible?t.notificationDescribedbyId:""}},[e("transition",{attrs:{name:"rr-fade",mode:"out-in",duration:250}},[t.merchant.activated?e("notification-activated",{key:"activated",attrs:{merchant:t.merchant,activatedWithDeal:t.activatedWithDeal,hasCaaConfig:!!t.hasCaaConfig,couponsAvailable:t.couponsAvailable,deals:t.deals,isCaaWithActivation:t.isCaaWithActivation,backgroundActivation:t.backgroundActivation},on:{clickClose:t.hide,clickCTA:t.hide,openStorePage:t.openStorePage},nativeOn:{mouseout:function(e){return t.onMouseOut.apply(null,arguments)},mousemove:function(e){return t.onMouseMove.apply(null,arguments)}}}):[t.optOutMode?e("notification-optout-undo",{attrs:{merchant:t.merchant},on:{clickClose:t.hide,toggleOptOut:t.toggleOptOut},nativeOn:{mouseout:function(e){return t.onMouseOut.apply(null,arguments)},mousemove:function(e){return t.onMouseMove.apply(null,arguments)}}}):e("notification-activate",{key:"activate",attrs:{merchant:t.merchant,cashbackAmount:t.cashbackAmount,close:!t.isCartReminder,disabled:t.optOutMode,coupons:t.coupons,boost:t.isBoostExperiment?t.boost:void 0,expiringCoupons:t.expiringCoupons,isRabEligible:t.isRabEligible,progressiveEducation:t.settings?.progressiveEducation,backgroundActivation:t.backgroundActivation},on:{clickCTA:function(e){t.merchant.loggedIn?t.clickActivateButton():t.clickLoginButton()},clickClose:t.hide,clickLater:t.hide}})]],2),2==t.merchant.activationCode?e("notification-recommended",{attrs:{storeName:t.merchant.storeName}}):t._e(),e("transition",{attrs:{name:"rr-fade",duration:250}},[t.merchantCanOptout&&!t.optOutMode?e("notification-optout",{attrs:{domainName:t.merchant.domainName,optoutText:t.optoutText,optOutMode:t.optOutMode},on:{toggleOptOut:t.toggleOptOut,clickClose:t.hide}}):t._e()],1),2!==t.merchant.activationCode?[t.isNotificationMessageVisible?e("notification-message",{attrs:{id:t.notificationDescribedbyId,hoverMessage:t.merchant.hoverMessage,hoverMessageIcon:t.merchant.hoverMessageIcon},on:{track:t.track}}):t.merchant.exclusions?e("notification-warning",{attrs:{id:t.notificationDescribedbyId,storeName:t.merchant.storeName,storeLandingUrl:t.merchant.storeLandingURL,exclusionCategories:t.merchant.exclusionCategories}}):t.exclusionList?e("notification-exclusion",{attrs:{id:t.notificationDescribedbyId,exclusionList:t.exclusionList},on:{show:t.removePopover,track:t.track}}):t._e(),t.isFeedEnabled?e("radiant-feed",{attrs:{slugName:`store/${t.merchant.siteUrl}/button/hover`,storeId:t.merchant.storeId,timelineSlugName:t.SLUG_GENERIC_HOVER,moduleType:"Hover_Ad"}}):t._e()]:t._e()],2)])],1):t._e()])};Yt._withStripped=!0;var Zt=r(7059),Gt=r.n(Zt);function Xt(t){if(!t)return{};let e="None",r=0,i="none";return t.amount&&(e=t.display,r=t.amount,i=t.range?"tiered":"fixed"),{cash_back_type:e,cash_back:r,cash_back_structure:i}}var Qt=r(14694),Kt=r(62815),Jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-items-center rr-flex-col rr-pa-32 rr-box-border"},[t.close?e("r-close-button",{attrs:{label:t.merchant.activated?t.$t("notification.activate.closeButtonLabelActivated"):t.$t("notification.activate.closeButtonLabel"),size:"48px",title:t.$t("notification.activate.closeDialog")},on:{click:function(e){return t.$emit("clickClose")}}}):t._e(),e("r-heading-logo",{staticClass:"rr-mb-24",attrs:{variant:t.merchant.reward.rakplusTargeted?"plus":"solid"}}),t.backgroundActivation&&t.progressiveEducation.BackgroundActivation?e("bg-activation-description"):t._e(),2==t.merchant.activationCode?e("r-button",{attrs:{block:""},on:{click:function(e){return t.$emit("clickCTA")}}},[t._v(t._s(t.$t("notification.activate.showStoresWithCashback")))]):[e("bg-activation-button",{attrs:{merchant:t.merchant,cashbackAmount:t.cashbackAmount,backgroundActivation:t.backgroundActivation},on:{clickCTA:function(e){return t.$emit("clickCTA")}}}),t.merchant.reward.previous&&!t.boost?e("span",{staticClass:"rr-t-body rr-leading-5 rr-text-secondary rr-mt-12"},[t._v(" "+t._s(t.merchant.reward.previous)+" ")]):t._e(),t.close?t._e():e("r-button",{staticClass:"rr-mt-16",staticStyle:{"margin-bottom":"-8px"},attrs:{variant:"tertiary",disabled:t.merchant.backgroundActivated,title:t.$t("notification.activate.dismissesCashbackMessage")},on:{click:function(e){return t.$emit("clickLater")}}},[t._v(" "+t._s(t.hideText)+" ")]),t.boost||t.isNotificationCoupons?e("div",{staticClass:"rr-mt-12 rr-w-fill-available"},[t.boost?e("notification-boost",{staticClass:"rr-mt-12",attrs:{boost:t.boost}}):t._e(),t.isNotificationCoupons?e("notification-coupons",{staticClass:"rr-mt-12",attrs:{coupons:t.coupons,expiringCoupons:t.expiringCoupons}}):t._e()],1):t._e()]],2)};Jt._withStripped=!0;var te=r(9484),ee=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("r-button",{ref:"button",staticClass:"rr-w-full",attrs:{block:"",isLoading:t.backgroundActivated},on:{click:function(e){return t.clickCTA()}}},[t._v(t._s(t.text))])};ee._withStripped=!0;const re=a().extend({components:{RButton:X.A},props:{cashbackAmount:{type:String,default:""},backgroundActivation:{type:String,default:""},ctaText:{type:String,default:""},merchant:{type:Object,required:!0}},computed:{...(0,n.aH)(["settings"]),text(){return this.ctaText||(this.backgroundActivated?this.$t("notification.bgActivation.activatingCta",{amount:this.cashbackAmount}):this.$t("notification.activate.cta",{amount:this.cashbackAmount}))},backgroundActivated(){return this.merchant?.backgroundActivated}},methods:{clickCTA(){this.$emit("clickCTA"),this.backgroundActivation&&this.settings?.progressiveEducation.BackgroundActivation&&(0,f.r)("updateProgressiveEducation",{BackgroundActivation:!1})}}});const ie=(0,Y.A)(re,ee,[],!1,null,null,null).exports;var se=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-bg-orange-15 rr-text-green-400 rr-mb-16 rr-pa-8 rr-rounded-ui rr-flex rr-items-start",staticStyle:{border:"1px solid #FFCF45"}},[e("start-illustration",{staticClass:"rr-flex-shrink-0 rr-bg-purple-15 rr-rounded-full",attrs:{size:"32",color:"#9B50D6"}}),e("div",{staticClass:"rr-pl-8 rr-flex rr-flex-col rr-items-start"},[e("div",{staticClass:"rr-t-descriptor-xs"},[t._v(" "+t._s(t.$t("notification.bgActivation.title"))+" ")]),e("div",{staticClass:"rr-t-subnav"},[t._v(" "+t._s(t.$t("notification.bgActivation.text"))+" ")])])],1)};se._withStripped=!0;var oe=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 32 32"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M19.7023 20.3294L21 19.1023L20.3157 17.3814L18.7885 16.9548L17.1365 16.3485L15.8621 15.9453L17.4506 15.0567L19.1195 14.1168L20.0438 12.3379L19.5369 11.597L19.565 11.5418L18.5688 11.4804L18.27 11.4659L16.8351 12.2692L14.0484 13.6104L13.9879 13.1387L13.7024 11.2404L13.7113 9.72593L13.4406 9L12.4919 9.00241L11.7182 9.55188L11.3928 11.0869L11.3819 14.5413L10.385 14.2725L6.94355 13.3321L6.67186 13.3048L5.73499 12.8854L4.59012 13.5722L6.78421 15.7504L8.67515 16.6526L7.37554 17.4071L4.46057 19.5082L4 20.0342L4.26104 20.7198L5.29815 21.0386L6.09894 20.874L7.84894 20.2179L11.0685 18.5546L11.2148 18.3878L11.178 21.5639L11.7381 25.3558L12.0781 25.7948L12.6595 26L13.5019 25.3118L13.4917 24.2158L14.1005 18.9256L16.1955 19.6605L17.8 20.1L19.7023 20.3294Z"}}),e("path",{attrs:{d:"M21.5457 5.18498L21.6001 5.61909L21.8446 5.97071L22.2552 6.44457L23.0419 7.43108L23.2362 7.6096L21.928 7.6735L21.5454 7.65993L21.2522 7.62765L20.9175 7.73346L20.8378 7.65695L20.7528 7.68001L20.7385 7.71976L20.7328 7.68829L20.5312 7.67608L20 7.94346L20.3288 8.43672L23.3354 8.75348L22.8978 10.5648L22.8338 12.6561L23.2078 13L23.6327 12.75L23.7655 12.5058L23.8754 12.2535L24.608 9.26695L24.7183 9.29733L26.3031 11.0088L27.4527 11.154L27.6013 10.419L27.2707 9.82627L26.4521 8.6208L26.6933 8.64984L26.8024 8.64359L26.7842 8.66462L26.8435 8.61375L27.1526 8.72974L29 8.01821L28.7211 7.35212H25.6554L25.5715 7.34548L25.1412 7.30085L25.3569 6.23511L25.7164 5.06967L25.9229 4.59771L25.7812 4L25.3785 4.02713L25.0287 4.32124L24.6797 5.0888L24.0894 6.5029L23.4625 5.91062L22.1107 4.85804L21.5457 5.18498ZM27.8802 8.10286L27.8924 8.06216L27.8804 8.08929L27.8802 8.10286ZM23.1459 11.2746L23.1864 11.2789L23.1459 11.2746ZM22.364 5.33163L22.4038 5.32145L22.4047 5.28564L22.364 5.33163Z"}}),e("path",{attrs:{d:"M25.6465 27.6855L25.9134 27.727L26.2285 27.7062L26.2802 27.6878L26.354 27.695L26.3606 27.7118L26.3667 27.725L26.545 27.7378L27 27.4684L26.7438 27.0045L24.0523 26.7383L24.471 25.1528L24.4306 23.3067L24.1552 23L23.7471 23.1888L23.6981 23.454L23.5149 23.6341L22.8639 26.2883L22.8368 26.2448L21.3809 24.7593L20.3471 24.6099L20.2019 25.2844L20.5055 25.8128L21.2563 26.8719L21.0376 26.8436H20.9416L20.9575 26.8212L20.9068 26.8493L20.6256 26.7801L19 27.4246L19.2316 27.9722L21.9681 28.0111L22.0512 27.991L22.4404 28.0443L22.1621 28.976L21.9285 30.0354L21.7516 30.4628L21.8667 30.9571L22.2256 31L22.5786 30.7138L22.7798 29.9857L23.3641 28.7498L23.93 29.2816L25.1421 30.2055L25.6101 29.9212L25.6212 29.5309L25.363 29.2397L25.0161 28.8011L24.3001 27.935L24.1165 27.7083L25.3007 27.6822L25.6465 27.6855ZM19.969 27.3671L19.9642 27.3482L19.9674 27.3844L19.969 27.3671ZM24.1785 24.5087L24.1958 24.5128L24.1785 24.5087ZM24.8783 29.8033L24.8962 29.7999L24.892 29.8042L24.8783 29.8033Z"}})])};oe._withStripped=!0;const ae={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const ne=(0,Y.A)(ae,oe,[],!1,null,null,null).exports,ce={components:{StartIllustration:ne}};const le=(0,Y.A)(ce,se,[],!1,null,null,null).exports;var de=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-notification-coupons rr-flex rr-flex-row rr-items-start rr-justify-left rr-rounded-ui rr-pa-16",class:{"rr-notification-coupons_expire":t.expiringCoupons.test}},[e("div",{staticClass:"rr-flex rr-mr-12 rr-rounded-full rr-notification-coupons__icon"},[e("coupon-icon",{attrs:{size:"21",color:"#ffffff"}})],1),e("div",[e("div",{staticClass:"rr-t-descriptor-s rr-mb-4",class:t.getClass},[e("strong",[t._v(t._s(t.$tc("notification.coupons.couponsFound",t.coupons.length,{amount:t.coupons.length})))])]),t.expiringCoupons.text?e("div",{staticClass:"rr-flex rr-items-center rr-mb-4"},[e("clock-icon",{staticClass:"rr-mr-4 rr-text-red-400",attrs:{size:"16"}}),e("div",{staticClass:"rr-t-descriptor-xxs rr-text-red-400"},[t._v(" "+t._s(t.expiringCoupons.text)+" ")])],1):t._e(),e("div",{staticClass:"rr-t-body rr-leading-5",class:t.getClass},[t._v(" "+t._s(t.$t("notification.coupons.body"))+" ")])])])};de._withStripped=!0;var ue=r(94766),he=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M8 15C4.14 15 1 11.86 1 8C1 4.14 4.14 1 8 1C11.86 1 15 4.14 15 8C15 11.86 11.86 15 8 15ZM8 2.5C4.97 2.5 2.5 4.97 2.5 8C2.5 11.03 4.97 13.5 8 13.5C11.03 13.5 13.5 11.03 13.5 8C13.5 4.97 11.03 2.5 8 2.5ZM11.01 9.82L8.35 8.04V3.88H6.85V8.85L10.18 11.07L11.01 9.82Z"}})])};he._withStripped=!0;const pe={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const me={components:{ClockIcon:(0,Y.A)(pe,he,[],!1,null,null,null).exports,CouponIcon:ue.A},props:{coupons:{type:Array,default:()=>[]},expiringCoupons:{type:Object,default:()=>({test:!1,text:""})}},computed:{getClass(){let t="rr-text-action";return this.expiringCoupons.test&&(t="rr-text-primary"),t}}};const ve=(0,Y.A)(me,de,[],!1,null,null,null).exports;var fe=function(){var t=this,e=t._self._c;return t.show?e("div",{staticClass:"rr-flex rr-flex-row rr-items-start rr-justify-left rr-rounded-ui rr-pa-16 rr-border-divider"},[e("r-icon-inverse",{staticClass:"rr-mr-12",attrs:{size:"21",iconSize:"21",backgroundColor:"#75b260",icon:t.LightningIcon}}),e("div",[e("div",{staticClass:"rr-t-descriptor-s rr-mb-4 rr-text-primary"},[e("strong",[t._v(t._s(t.$t("notification.boost.title",{reward:t.boost.reward})))])]),e("div",{staticClass:"rr-t-body rr-leading-5 rr-text-primary rr-mb-4"},[t._v(" "+t._s(t.$t("notification.boost.expiration"))+" "),e("strong",[e("r-countdown",{staticClass:"rr-text-red-300",attrs:{finish:t.boost.expires},on:{hide:t.hide}})],1)]),e("div",{staticClass:"rr-t-fine-print rr-underline rr-text-primary rr-cursor-pointer",on:{click:t.handleClick}},[t._v(" "+t._s(t.$t("notification.boost.terms"))+" ")])])],1):t._e()};fe._withStripped=!0;var ge=r(82966),_e=r(44944),Ce=r(95754);const be={components:{RCountdown:_e.A,RIconInverse:Ce.A},props:{boost:{type:Object,required:!0}},data:()=>({LightningIcon:ge.A,show:!0}),methods:{handleClick(){(0,O.o)((0,B.V)(this.boost.termsLink))},hide(){this.show=!1}}};const ye=(0,Y.A)(be,fe,[],!1,null,null,null).exports,ke={components:{RButton:X.A,RHeadingLogo:q.A,RCloseButton:te.A,NotificationCoupons:ve,NotificationBoost:ye,BgActivationButton:ie,BgActivationDescription:le},props:{close:{type:Boolean,default:!0},merchant:{type:Object,required:!0},cashbackAmount:{type:String,default:""},disabled:{type:Boolean,default:!1},coupons:{type:Array,default:()=>[]},expiringCoupons:{type:Object,default:()=>({test:!1,text:""})},isRabEligible:{type:Boolean,default:!1},progressiveEducation:{type:Object,default:()=>({})},backgroundActivation:{type:String,default:""},boost:{type:Object,default:null}},emits:["clickClose","clickCTA","clickLater"],computed:{ctaText(){return this.$t("notification.activate.cta",{amount:this.cashbackAmount})},hideText(){return this.isRabEligible?this.$t("notification.activate.hideForNow"):this.$t("notification.activate.remindMeLater")},isNotificationCoupons(){return this.coupons.length>0}}};const xe=(0,Y.A)(ke,Jt,[],!1,null,null,null).exports;var Ae=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ebates-notification--activated rr-flex rr-items-center rr-flex-col rr-pa-32",class:{"ebates-notification--activated-caa-bg":t.couponsAvailable||t.isCaaWithActivation||t.backgroundActivation}},[e("r-close-button",{attrs:{title:"Close Rakuten dialog",color:"#fff"},on:{click:function(e){return t.$emit("clickClose")}}}),e("r-heading-logo",{staticClass:"rr-mb-24",attrs:{variant:t.rakPlus?"plus-white":"white"}}),t.backgroundActivation?e("div",{staticClass:"rr-flex rr-items-center rr-flex-col rr-box-border"},[e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-inverse"},[e("div",{staticClass:"rr-t-h2 rr-text-center rr-mx-16"},[t._v(" "+t._s(t.$t("notification.bgActivation.activated",{amount:t.cashbackAmount}))+" ")]),e("div",{staticClass:"rr-t-link rr-mt-32 rr-mb-8 rr-cursor-pointer",on:{click:function(e){return t.$emit("openStorePage")}}},[t._v(" "+t._s(t.$t("notification.bgActivation.terms"))+" ")])])]):t.isCaaWithActivation?e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-inverse rr-t-h2 rr-text-center rr-my-8 rr-mx-16"},[t._v(" "+t._s(t.$t("notification.activated.cashbackActivated",{amount:t.cashbackAmount}))+"! ")]):t.activatedWithDeal?e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-inverse rr-mt-8"},[e("div",{staticClass:"rr-t-h2 rr-tracking-wide rr-mb-16"},[t._v(" "+t._s(t.activatedCaption)+" ")]),e("div",{staticClass:"rr-t-subheader-s rr-text-center rr-px-16"},[t._v(" "+t._s(t.$t("notification.activated.cashbackActivated",{amount:t.cashbackAmount}))+". ")]),e("div",{staticClass:"rr-t-subheader-s rr-text-center rr-mb-16 rr-px-16"},[t._v(" "+t._s(t.activatedDealText)+" ")]),e("r-button",{attrs:{variant:"secondary"},on:{click:function(e){return t.$emit("clickCTA")}}},[t._v(" "+t._s(t.$t("notification.common.gotIt"))+" ")])],1):t.couponsAvailable?e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-inverse rr-text-center rr-mt-8"},[e("div",{staticClass:"rr-t-h2 rr-tracking-wide rr-mb-16"},[t._v(" "+t._s(t.$t("notification.activated.cashbackActivated",{amount:t.cashbackAmount}))+"! ")]),e("div",{staticClass:"rr-t-subheader-s rr-mt-28 rr-px-32"},[t._v(" "+t._s(t.$t("notification.activated.applyCouponsAtCheckout"))+" ")])]):e("div",{staticClass:"rr-t-descriptor-s rr-mb-8 rr-text-inverse rr-flex rr-items-center"},[e("check-icon",{staticClass:"rr-mr-8",attrs:{size:"20"}}),t._v(t._s(t.$t("notification.activated.cashbackActivated",{amount:t.cashbackAmount}))+" ")],1)],1)};Ae._withStripped=!0;const we={components:{RButton:X.A,RHeadingLogo:q.A,RCloseButton:te.A,CheckIcon:ct.A},props:{merchant:{type:Object,required:!0},deals:{type:Array,default:null},activatedWithDeal:{type:Boolean,default:!1},hasCaaConfig:{type:Boolean,default:!1},couponsAvailable:{type:Boolean,default:!1},isCaaWithActivation:{type:Boolean,default:!1},backgroundActivation:{type:String,default:""}},computed:{reward(){return this.merchant.shoppingTrip.reward},cashbackAmount(){return(0,tt.a)(this.reward)},activatedDealText(){if(!this.activatedWithDeal)return"";const t=this.merchant.shoppingTrip?.deal?.code;if(this.hasCaaConfig){const e=[...new Map(this.deals?.filter((t=>t.code)).map((t=>[t.code,t]))).values()];return e.length>2?this.$t("notification.activated.caaManyCoupons",{code:t,amount:e.length-1}):e.length>1?this.$t("notification.activated.caaTwoCoupons",{code:t}):this.$t("notification.activated.caaOneCoupon",{code:t})}return this.$t("notification.activated.dontForgetToApply",{code:t})},activatedCaption(){return this.hasCaaConfig?this.$t("notification.activated.dealActivated"):this.$t("notification.activated.codeCopied")},tieredPrefix(){return this.reward?.range?`${this.$t("common.upTo")} `:""},rakPlus(){return this.merchant.reward.rakplusTargeted}}};const Se=(0,Y.A)(we,Ae,[],!1,null,null,null).exports;var Te=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-items-center rr-flex-col rr-pa-32 rr-box-border rr-w-hover"},[e("r-close-button",{on:{click:function(e){return t.$emit("clickClose")}}}),e("r-heading-logo",{staticClass:"rr-mb-24",attrs:{variant:t.rakPlus?"plus":"solid"}}),e("div",{staticClass:"rr-text-center rr-flex rr-flex-col rr-items-center"},[e("div",{staticClass:"rr-t-descriptor-xs rr-mb-16 rr-text-primary"},[t._v(" "+t._s(t.$t("notification.optoutUndo.remindersAreOff"))+" ")]),e("div",{staticClass:"rr-notification__browser-icon-image rr-mb-16"}),e("r-button",{attrs:{variant:"tertiary"},on:{click:function(e){return t.$emit("toggleOptOut",!1)}}},[t._v(" "+t._s(t.$t("notification.optoutUndo.undo"))+" ")])],1)],1)};Te._withStripped=!0;const $e={components:{RCloseButton:te.A,RButton:X.A,RHeadingLogo:q.A},props:{merchant:{type:Object,required:!0}},computed:{rakPlus(){return this.merchant.reward.rakplusTargeted}}};const Me=(0,Y.A)($e,Te,[],!1,null,null,null).exports;var Le=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-items-center rr-bg-pref rr-py-24 rr-px-32"},[e("r-checkbox",{attrs:{id:"optout-checkbox"},on:{change:t.toggleOptOut}},[e("div",{staticClass:"rr-ml-8 rr-t-descriptor-xs rr-text-primary",attrs:{for:"optout-checkbox"},domProps:{innerHTML:t._s(t.optoutSanitizedHTML)}})])],1)};Le._withStripped=!0;var Pe=r(46378);const Ie={components:{RCheckbox:r(41629).A},props:{optoutText:{type:String,default:""},domainName:{type:String,default:""},optOutMode:{type:Boolean,default:!0}},data(){return{optOut:this.optOutMode}},computed:{optoutSanitizedHTML(){return(0,Pe.p)(this.optoutText)},optOutModeModel:{get(){return!this.optOut},set(t){this.$emit("toggleOptOut",!t),this.optOut=!this.optOut}}},methods:{toggleOptOut(t){this.$emit("toggleOptOut",t)}}};const Be=(0,Y.A)(Ie,Le,[],!1,null,null,null).exports;var Ee=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-overflow-hidden"},[e("div",{staticClass:"ebates-notification-notice rr-items-start"},[t.hoverMessageIcon?e("div",{staticClass:"rr-mr-16 rr-text-blue-400",staticStyle:{"font-size":"20px"}},[e("bell-icon",{attrs:{size:"23px"}})],1):t._e(),e("div",{staticClass:"rr-t-descriptor-xs rr-fw-book rr-text-primary",domProps:{innerHTML:t._s(t.hoverMessageSanitized)},on:{click:t.clickHtml,keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")&&t._k(e.keyCode,"space",32,e.key,[" ","Spacebar"])?null:t.clickHtml.apply(null,arguments)}}})])])};Ee._withStripped=!0;var Re=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 448 512"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416h384c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3c-31.2-35.2-48.5-80.5-48.5-127.6V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7z"}})])};Re._withStripped=!0;const Ne={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const Oe=(0,Y.A)(Ne,Re,[],!1,null,null,null).exports;var He=r(4531);const De={components:{BellIcon:Oe},mixins:[He.A],props:{hoverMessageIcon:{type:String,default:""},hoverMessage:{type:String,default:""}},computed:{hoverMessageSanitized(){return(0,Pe.p)(this.hoverMessage)}}};const Ve=(0,Y.A)(De,Ee,[],!1,null,null,null).exports;var Fe=function(){var t=this;return(0,t._self._c)("r-exclusion-message",t._b({staticClass:"rr-bg-pref rr-pa-32"},"r-exclusion-message",t.$props,!1))};Fe._withStripped=!0;var We=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-overflow-hidden"},[e("div",{staticClass:"rr-flex rr-items-start rr-box-border"},[e("div",{staticClass:"rr-mr-16 rr-text-blue-400",staticStyle:{"font-size":"20px"}},[e("bell-icon",{attrs:{size:"23px"}})],1),e("i18n",{staticClass:"rr-t-descriptor-xs rr-fw-book rr-text-primary",attrs:{tag:"div",path:"components.exclusionMessage.text"},scopedSlots:t._u([{key:"notAvailable",fn:function(){return[e("span",{staticClass:"rr-font-semibold rr-text-error"},[t._v(t._s(t.$t("components.exclusionMessage.notAvailable")))])]},proxy:!0},{key:"storeName",fn:function(){return[t._v(" "+t._s(t.storeName)+" ")]},proxy:!0},{key:"exclusionCategories",fn:function(){return[e("span",{staticClass:"rr-font-semibold"},[t._v(t._s(t.exclusionCategories))])]},proxy:!0},{key:"andMore",fn:function(){return[t.storeLandingUrl?e("span",[t._v(" "+t._s(t.$t("components.exclusionMessage.and"))+" "),e("r-link",{staticClass:"rr-font-semibold",on:{click:t.clickLink,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"space",32,e.key,[" ","Spacebar"])&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.clickLink.apply(null,arguments)}}},[t._v(" "+t._s(t.$t("components.exclusionMessage.more"))+" ")])],1):t._e()]},proxy:!0}])})],1)])};We._withStripped=!0;const ze={components:{RLink:et.A,BellIcon:Oe},props:{storeName:{type:String,default:""},storeLandingUrl:{type:String,default:""},exclusionCategories:{type:String,default:""}},methods:{clickLink(){(0,O.o)((0,B.V)(this.storeLandingUrl))}}};const je={components:{RExclusionMessage:(0,Y.A)(ze,We,[],!1,null,null,null).exports},mixins:[He.A],props:{storeName:{type:String,default:""},storeLandingUrl:{type:String,default:""},exclusionCategories:{type:String,default:""}}};const qe=(0,Y.A)(je,Fe,[],!1,null,null,null).exports;var Ue=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ebates-notification-notice"},[e("alert-icon",{staticClass:"rr-mr-16 rr-text-action rr-flex-none",attrs:{size:"24"}}),e("div",{staticClass:"rr-flex rr-items-center"},[e("span",{ref:"description",staticClass:"rr-t-descriptor-xs rr-text-primary"},[t._v(" "+t._s(t.$t("notification.recommended.description",{store:t.storeName}))+" ")])])],1)};Ue._withStripped=!0;const Ye={components:{AlertIcon:r(96037).A},props:{storeName:{type:String,default:""}}};const Ze=(0,Y.A)(Ye,Ue,[],!1,null,null,null).exports;var Ge=function(){var t=this,e=t._self._c;return e("r-popover",{staticClass:"rr-text-center rr-bg-dark",attrs:{backgroundColor:"#292A6B"},on:{show:t.onShow}},["ReminderHover"===t.type?[e("div",{staticClass:"rr-t-descriptor-l rr-mb-16 rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.reminder.title"))+" ")]),e("div",{staticClass:"rr-t-descriptor-s rr-mx-16 rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.reminder.body"))+" ")])]:"ConfirmHover"===t.type?[e("div",{staticClass:"rr-t-descriptor-l rr-mb-16 rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.confirm.title"))+" "),e("span",{attrs:{"aria-hidden":"true"}},[t._v("\u{1f389}")])]),e("div",{staticClass:"rr-t-descriptor-s rr-mb-16 rr-text-inverse rr-mx-16"},[t._v(" "+t._s(t.$t("notification.popover.confirm.subtitle"))+" ")]),e("div",{staticClass:"rr-t-descriptor-s rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.confirm.body"))+" ")])]:[e("div",{staticClass:"rr-t-descriptor-l rr-mb-16 rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.tier.title",{tierMessage:t.tierMessage}))+" ")]),e("div",{staticClass:"rr-t-descriptor-s rr-mb-16 rr-text-inverse"},[t._v(" "+t._s(t.$t("notification.popover.tier.body"))+" ")]),e("div",{staticClass:"rr-notification__browser-icon-image"})]],2)};Ge._withStripped=!0;var Xe=r(79986),Qe=r(44107);const Ke={components:{RPopover:Xe.A},mixins:[Qe.A],props:{storeId:{type:Number,default:null},storeName:{type:String,default:""},tierMessage:{type:String,default:"Up to 2.5%"},type:{type:String,default:"ReminderHover"}},data:()=>({entityName:"Hover",moduleType:"tooltip"})};const Je=(0,Y.A)(Ke,Ge,[],!1,null,null,null).exports;var tr=function(){var t=this,e=t._self._c;return e("div",{ref:"content",staticClass:"rr-pt-24 rr-px-32 rr-pb-32 rr-bg-pref rr-box-border"},[t.exclusionList?[e("div",{staticClass:"rr-text-center rr-t-descriptor-xs"},[t._v(" "+t._s(t.$t("notification.exclusion.cashbackNotEligibleOn"))+" ")]),e("ul",{staticStyle:{"padding-inline-start":"20px"}},t._l(t.exclusionListFiltered,(function(r,i){return e("li",{key:i,ref:"exclusionItem",refInFor:!0,staticClass:"rr-t-body",attrs:{tabindex:-1}},[t._v(" "+t._s(r)+" ")])})),0)]:t._e(),e("div",{staticClass:"rr-text-center"},[e("r-button",{attrs:{variant:"tertiary"},on:{click:t.expand}},[e("span",{staticClass:"rr-inline-flex rr-items-center"},[e("span",{class:t.exclusionList?"rr-t-descriptor-s":"rr-t-descriptor-xs"},[t._v(" "+t._s(t.buttonText)+" ")]),e("chevron-down",{staticClass:"rr-ml-8 rr-flex-shrink-0",attrs:{size:"14px",rotate:t.expanded?180:0}})],1)])],1)],2)};tr._withStripped=!0;var er=r(12257);const rr={components:{ChevronDown:er.A,RButton:X.A},props:{exclusionList:{type:Array,default:()=>[]}},data:()=>({expanded:!1}),computed:{buttonText(){return this.exclusionList?this.expanded?this.$t("notification.common.seeLess"):this.$t("notification.common.seeMore"):this.$t("notification.exclusion.whatsExcluded")},exclusionListFiltered(){return this.expanded?this.exclusionList:this.exclusionList.filter(((t,e)=>e<3))}},methods:{sanitize:t=>(0,Pe.p)(t),expand(){this.expanded=!this.expanded,this.expanded&&(this.$emit("show"),this.$refs.content.style.width=`${this.$refs.content.clientWidth}px`,this.$refs.exclusionItem.length>=3&&this.focusOnExculsion()),this.$emit("track","Click Hover",{cta_type:this.expanded?"View Exclusions":"Close Exclusions"})},focusOnExculsion(){this.$nextTick((()=>{this.$refs.exclusionItem[3].focus()}))}}};const ir=(0,Y.A)(rr,tr,[],!1,null,null,null).exports;var sr=function(t){return t.ViewHover="View Hover",t.CloseHover="Close Hover",t.ClickHover="Click Hover",t.VisitPage="Visit Page",t.ViewConfirmationHover="View Confirmation Hover",t}(sr||{});const or="BTN202",ar=Kt.A.extend({name:"NotificationView",components:{NotificationOptout:Be,NotificationMessage:Ve,NotificationWarning:qe,NotificationRecommended:Ze,NotificationExclusion:ir,NotificationOptoutUndo:Me,NotificationActivate:xe,NotificationActivated:Se,EducationPopover:Je,RadiantFeed:W.A},data:()=>({visible:!1,category:"Hover",confirmationTimeoutSettings:{default:5e3,background:3e3,deal:1e4,threshold:500},confirmationTimeout:5e3,optOutTimeout:3e3,checkIconVisible:!1,notificationBodyOpacity:1,optOutMode:!1,features:[],deals:null,products:null,isCartReminder:!1,activatedWithDeal:!1,optoutCampaign:null,educationPopperVisible:!1,educationPopoverType:"",educationTierMessage:"",instantActivation:!1,version:"X to close",exclusionHtml:"",exclusionList:null,exclusionType:"",notificationDescribedbyId:"rr-notification-describedby",couponsAvailable:!1,module_type:"Hover",hasCaaConfig:null,coupons:[],hideTimer:null,transition:!0,isInactiveRabEnabled:!1,backgroundActivation:"",containerHeight:null,expiringCoupons:{test:!1,text:"",amount:0},SLUG_GENERIC_HOVER:D.t7.GENERIC_HOVER,isBoostExperiment:!1}),computed:{...(0,n.aH)(["merchant","settings","boost"]),merchantCanOptout(){return!!this.optoutCampaign},optoutText(){return this.optoutCampaign?.label.replace("{storeName}",this.merchant.storeName)},cashbackAmount(){return this.merchant.rewardsExpired?"":(0,tt.a)(this.merchant.reward).toLowerCase()},formattedFeatures(){return this.features.concat(this.exclusionType).concat(this.isBoostExperiment?`CB boost ${this.boost.incentive_id}`:"").filter((t=>t)).toString()},isNotificationMessageVisible(){return!this.merchant.exclusionList&&!this.merchant.exclusions&&!(!this.merchant.hoverMessage||this.merchant.activated)},isDescribedBlockVisible(){return!!(this.isNotificationMessageVisible||this.merchant.exclusions||this.exclusionHtml||this.exclusionList)},isFeedEnabled(){return l.o.get("feed",!0)&&(!this.boost?.expires||this.boost?.expires<Date.now())},isCaaWithActivation(){const t=this.merchant.shoppingTrip.source;return[D.rx,D.if].includes(t)},isRabEligible(){return this.isInactiveRabEnabled},backgroundActivated(){return this.merchant.backgroundActivated}},watch:{async backgroundActivated(t){t&&(this.removePopover(),this.confirmationTimeout=this.confirmationTimeoutSettings.background,this.$store.dispatch("updateMerchant",{rabActivated:!0}))},merchant(t,e){!e.activated&&t.activated&&(this.handleConfirmation(),this.trackView())}},async mounted(){const{storeId:t}=this.merchant;if(await this.handleCoupons(),2===this.merchant.activationCode&&this.resetNotificationFlag(),this.merchant.activated)this.handleConfirmation();else{this.merchant.exclusionList&&(this.exclusionList=this.merchant.exclusionList);const e=this.settings.promos.find((({id:t})=>"merchants-optout"===t)),r=e?.campaigns?.map((({id:t})=>(0,f.r)("getCampaignStores",{id:t})));if(e&&r){const i=await Promise.all(r),s=e.campaigns?.map(((t,e)=>({...t,stores:i[e]})));this.optoutCampaign=s.find((({stores:e})=>e?.find((e=>e.storeId===t))))}this.merchantCanOptout&&this.features.push("Hide");const i=this.merchant.affiliatizerEnabled||l.o.get("checkoutReminderForBgActivation")&&await(0,f.r)("isEligibleForBackgroundActivation",{storeId:t});if(this.isCartReminder=i&&l.o.get("cartReminder"),this.isCartReminder&&(this.version="Remind me later"),this.backgroundActivation=await(0,f.r)("isEligibleForBackgroundActivationV2",{storeId:t,activateTest:!0}),this.backgroundActivation&&this.settings.progressiveEducation.BackgroundActivation&&this.features.push("Background activation note"),this.coupons.length>0){const e=l.o.get("expiringCoupons",{expirationLimit:-1})?.expirationLimit;if((0,s.isNumber)(e)&&e>-1){this.expiringCoupons.test=!!await c.r.get(or);const{text:r,amount:i}=this.getExpiringCoupons(e);r&&"A"===await c.r.activate(or,{storeId:t})&&(this.features.push("Expiring Coupon"),this.expiringCoupons.text=r,this.expiringCoupons.amount=i)}}if(this.boost){(l.o.variation("signupButtonMilestones",{ids:[]}).ids??[]).includes(this.boost.incentive_id)?this.isBoostExperiment="A"===await c.r.activate(D.mp.NOTIFICATION_BOOST,{storeId:this.merchant.storeId,placement:this.module_type}):this.isBoostExperiment=!0}}if(this.trackView(),this.renderPopover(),this.visible=!0,this.backgroundActivation){await this.$nextTick();const t=this.$refs.notification;this.resizeObserver=new ResizeObserver((async()=>{await this.$nextTick(),this.containerHeight=t?.offsetHeight})),this.resizeObserver.observe(t)}},async created(){if(this.confirmationTimeoutSettings={...this.confirmationTimeoutSettings,...this.settings.confirmationTimeout},this.confirmationTimeout=this.confirmationTimeoutSettings.default,this.merchant.loggedIn||this.features.push("Login"),(this.merchant.exclusions||this.merchant.hoverMessage)&&this.features.push("Exclusions"),2===this.merchant.activationCode&&this.features.push("Recommended Stores"),this.merchant.affiliatizerEnabled&&3===this.merchant.activationCode&&!this.merchant.activated&&this.merchant.loggedIn&&l.o.get("hoverRAB")&&l.o.get("rabInactive")){const t=(this.merchant.hoverShownCount??0)+1;this.$store.dispatch("updateMerchant",{hoverShownCount:t}),this.isInactiveRabEnabled=!0}document.addEventListener("visibilitychange",(()=>{document.hidden&&(this.transition=!1)})),this.$store.dispatch("getActiveBoost",{storeId:this.merchant.storeId})},beforeDestroy(){this.resizeObserver?.disconnect()},methods:{async handleConfirmation(){window.setTimeout((()=>{(0,b.a)(this.merchant.storeId,{notificationHover:!1})}),this.confirmationTimeoutSettings.threshold),this.merchant.shoppingTrip.deal&&(this.confirmationTimeout=this.confirmationTimeoutSettings.deal,await this.getCouponsConfig(),this.activatedWithDeal=!0),this.confirmationTimeout&&(this.hideTimer=window.setTimeout((()=>{this.hide()}),this.confirmationTimeout))},trackView(){window.setTimeout((()=>{this.track(this.merchant.activated?sr.ViewConfirmationHover:sr.ViewHover,{version:this.version,tracking_ticket:this.merchant.shoppingTrip.ttn,...this.couponsAvailable&&{coupons_number:this.coupons.length},...this.merchant.reward.previous&&{was_cashback:this.merchant.reward.previous},...(0,E.D)(this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.reward),...this.merchant.rewardsExpired&&{rewardsExpired:!0},oc_coupons:this.coupons.filter((t=>"OC"===t.source)).length,acs_coupons:this.coupons.filter((t=>"ACS"===t.source)).length,...this.expiringCoupons.amount&&{expiring_coupon_number:this.expiringCoupons.amount}})}),this.merchant.activated?this.confirmationTimeoutSettings.threshold:0)},async handleCoupons(){await this.getDeals();let t=this.deals??[];if(t.length>0&&l.o.get("hoverCoupons")&&(!this.merchant.activated||this.merchant.shoppingTrip.couponsAvailable)){if(!await this.getCouponsConfig())return;if(t.some((t=>t.source?.includes("ACS")))){await c.r.activate("acs-for-on-platform-extension",{storeId:this.merchant.storeId,placement:this.module_type})||(t=t.filter((t=>"ACS"!==t.source)))}this.features.push("Coupons Found"),this.couponsAvailable=!0,this.coupons=t}},async getCouponsConfig(){return this.hasCaaConfig??=await(0,f.r)("coupons.hasConfigs",{storeId:this.merchant.storeId}),this.hasCaaConfig},getHolisticEventParams(t){return{displayed_cash_back:Xt(this.merchant.reward),was_cash_back:this.merchant.reward.previous,store_id:this.merchant.storeId,store_name:this.merchant.storeName,preceding_screen_name:this.merchant.preceding_screen_name,type:this.formattedFeatures,experience:this.version,...t===C.s.ConfirmationHoverViewed&&{tracking_ticket:this.merchant.shoppingTrip.ttn,num_coupons:this.couponsAvailable?this.coupons.length:0}}},getHolisticEvent:t=>({[sr.ViewHover]:C.s.HoverViewed,[sr.CloseHover]:C.s.HoverDismissed,[sr.ViewConfirmationHover]:C.s.ConfirmationHoverViewed}[t]),track(t,e={}){e={store_name:this.merchant.storeName,domain:this.merchant.domainName,store_id:this.merchant.storeId,type:this.formattedFeatures,preceding_screen_name:t===sr.VisitPage?"Hover":this.merchant.preceding_screen_name,...this.merchant.serpClickDetails,...e},g.m.track(t,e);const r=this.getHolisticEvent(t);if(r){const t=this.getHolisticEventParams(r);(0,y.l)(r,{data:t})}},clickNotification(){this.merchant.activated&&this.hide()},clickActivateButton(){const t={...this.merchant.serpClickDetails};this.couponsAvailable&&(t.coupons_number=this.coupons.length),(0,bt.Y)(this.merchant.storeId,{store_url:document.location.href,type:this.formattedFeatures,backgroundActivation:this.backgroundActivation,sessionAttributes:{source:"Hover",...this.couponsAvailable&&{couponsAvailable:!0,instantStartCAA:!0},event_attributes:t}})},clickLoginButton(){(0,f.r)("login",{merchant:this.merchant,type:this.formattedFeatures,source:"Hover"}),this.hide()},hide(){this.removePopover(),this.visible=!1,this.hideTimer&&window.clearTimeout(this.hideTimer),this.merchant.activated&&this.$store.dispatch("updateComponents",{notification:!1}),this.merchant.activated||this.track(sr.CloseHover,{version:this.version}),this.resetNotificationFlag(),this.$emit("onClose")},resetNotificationFlag(){this.$store.dispatch("updateMerchant",{notificationHover:!1})},async toggleOptOut(t){t?(this.visible=!1,await(0,Qt.cb)(100),this.optOutMode=!0,this.visible=!0,this.removePopover(),this.optOutTimeout&&(this.hideTimer=window.setTimeout((()=>{this.hide()}),this.optOutTimeout))):(this.visible=!1,await(0,Qt.cb)(100),this.optOutMode=!1,this.visible=!0),this.optoutCampaign&&g.m.track(sr.ClickHover,{cta_type:t?"Opt Out Activation Slider":"Undo Opt Out Activation Slider",url:location.host+location.pathname,store_id:this.merchant.storeId}),(0,f.r)("blacklist-update",{storeId:this.merchant.storeId,property:"notificationExcludedStores",exclude:t})},async getDeals(){this.deals||(this.deals=await(0,f.r)("getCouponOffers",{storeId:this.merchant.storeId}))},onMouseOut(){this.hideTimer=window.setTimeout((()=>{this.hide()}),this.confirmationTimeout)},onMouseMove(){this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null)},removePopover(){this.educationPopperVisible=!1},async renderPopover(){if(!this.settings.progressiveEducation)return;const t=this.merchant.activated?"ConfirmHover":"ReminderHover";if(this.settings.progressiveEducation[t]){if(await(0,Qt.cb)(1e3),!this.visible)return;this.educationPopoverType=t,this.educationPopperVisible=!0}else if(this.settings.progressiveEducation.UpToCB&&this.merchant.reward.tiered&&this.merchant.reward.range){if(await(0,Qt.cb)(1e3),!this.visible)return;this.educationPopoverType="UpToCB",this.educationTierMessage=this.cashbackAmount,this.educationPopperVisible=!0}},remove(){this.visible=!1},openStorePage(){const t=(0,B.V)(`/${this.merchant.siteUrl}`);(0,O.o)(t)},getExpiringCoupons(t){let e=0;const r=this.coupons.filter((r=>{if(!r.expires)return!1;const i=Gt()(r.expires),s=Gt()(),o=i.diff(s),a=o<t;return a&&o>e&&(e=o),a}));if(!e)return{text:"",amount:0};const i=r.length;const s=function(t){const e=t/1e3/60/60;return Math.ceil(e)}(e);return{text:e<=36e5?this.$tc("notification.coupons.ExpireOneHour",i,{amount:i}):this.$tc("notification.coupons.ExpireHours",i,{amount:i,hours:s}),amount:i}}}}),nr=ar;const cr=(0,Y.A)(nr,Yt,[],!1,null,null,null).exports;var lr=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.visible?e("div",[t.renderModal?e("recommended-modal",{attrs:{storeName:t.merchant.storeName,recommendedStores:t.recommendedStores,promo:t.promo},on:{track:t.track,close:t.close}}):t.renderInterrupt?e("recommended-interrupt",{attrs:{recommendedStore:t.recommendedStore,promo:t.promo},on:{track:t.track,close:t.close}}):t.renderBanner?e("recommended-banner",{attrs:{recommendedStore:t.recommendedStore,promo:t.promo},on:{track:t.track,close:t.close}}):t._e()],1):t._e()};lr._withStripped=!0;var dr=r(30647),ur=r(46598),hr=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"rr-slide"}},[t.recommendedStore&&t.visible?e("aside",{staticClass:"rr-recommended-banner rr-w-full rr-flex rr-items-center rr-justify-center",attrs:{role:"dialog",tabindex:"-1","aria-label":t.label,"aria-live":"polite","data-tid":"no-cash-back-header"}},[e("r-logo",{staticClass:"rr-mr-40"}),e("div",{staticClass:"rr-t-descriptor-s rr-mr-24"},[t.promo.recommendedStoreBanner?e("div",{domProps:{innerHTML:t._s(t.recommendedStoreBanner)}}):t.recommendedStore.reward.targetSet?e("div",[e("span",{staticClass:"rr-text-action"},[t._v("Boosted Offer")]),t._v(": You\u2019re invited to earn "),e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.cashbackValue)+" Cash Back")]),t._v(" at "),e("span",{staticClass:"ebates-text--medium"},[t._v(t._s(t.recommendedStore.storeName))]),t._v(". Ends soon! ")]):e("div",[t._v(" Heads up! You can earn "),e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.cashbackValue)+" Cash Back")]),t._v(" if you shop at "+t._s(t.recommendedStore.storeName)+" instead. Try it? ")])]),e("r-button",{staticClass:"rr-px-40",on:{click:t.activate}},[t._v(" "+t._s(t.recommendedStoreButton)+" ")]),e("r-close-button",{attrs:{size:"70px",label:`Dismiss ${t.label}`},on:{click:t.close}})],1):t._e()])};hr._withStripped=!0;var pr=r(16947);const mr={components:{RButton:X.A,RCloseButton:te.A,RLogo:pr.A},props:{recommendedStore:{type:Object,required:!0},promo:{type:Object,required:!0}},data:()=>({label:"Rakuten Store Recommendation",category:"No Cash Back",module_type:"No Cash Back",entity_name:"Header",eeid:41834,visible:!1}),computed:{recommendedStoreBanner(){return(t=>(0,Pe.p)(t.replace("%storeName",this.recommendedStore.storeName).replace("%cashBack",(0,tt.a)(this.recommendedStore.reward))))(this.promo.recommendedStoreBanner)},recommendedStoreButton(){return this.promo.recommendedStoreButton?(0,Pe.p)(this.promo.recommendedStoreButton):this.recommendedStore.reward.targetSet?"Get This Deal":"Shop Now"},cashbackValue(){return(0,tt.a)(this.recommendedStore.reward)}},mounted(){this.show()},methods:{show(){this.visible=!0,setTimeout((()=>{this.track("View Module",{...(0,E.D)(this.recommendedStore.reward)})}),100),setTimeout((()=>{this.$store.dispatch("updateMerchant",{notificationHover:!1})}),1e3)},close(){this.track("Click Module",{cta_type:"close"}),this.$emit("close")},track(t,e){this.$emit("track",t,{module_type:this.module_type,entity_name:this.entity_name,...e})},activate(){(0,bt.Y)(this.recommendedStore.storeId,{channel:this.promo.channel,xfasParams:this.promo.xfasParams,eeid:this.eeid,store_url:"",sessionAttributes:{source:`${this.entity_name} ${this.module_type}`}}),this.$emit("close")}}};const vr=(0,Y.A)(mr,hr,[],!1,null,null,null).exports;var fr=function(){var t=this,e=t._self._c;return e("r-modal-form",{staticClass:"rr-recommended-modal",attrs:{"data-tid":"recommended-form",headerLogo:"left",position:"center",width:"720"},on:{close:t.close}},[e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-center"},[e("span",{staticClass:"rr-t-h2 rr-mb-8"},[e("span",{staticClass:"rr-text-cashback"},[t._v("No Cash Back")]),t._v(" at "+t._s(t.storeName))]),e("span",{staticClass:"rr-mb-24 rr-t-subheader-s",staticStyle:{"max-width":"495px"}},[t._v(" Cash Back isn\u2019t available at "+t._s(t.storeName)+". Try these similar stores instead! ")]),e("div",{staticClass:"rr-flex rr-justify-center rr-mb-24"},t._l(t.recommendedStores,(function(r){return e("div",{key:r.storeId,staticClass:"rr-recommended-modal__store-card rr-flex rr-flex-col rr-items-center rr-mr-12 rr-cursor-pointer rr-py-32",on:{click:function(e){return e.stopPropagation(),t.activate(r.storeId)}}},[e("div",{staticClass:"rr-recommended-modal__store-logo rr-mb-16",style:{backgroundImage:`url(${r.images.largeLogo.url})`}}),e("r-cashback",{attrs:{reward:r.reward}})],1)})),0),t.promo.url?e("a",{staticClass:"rr-text-action rr-t-link rr-cursor-pointer",attrs:{role:"link"},on:{click:t.clickOther}},[t._v(" See Other Stores ")]):t._e()])])};fr._withStripped=!0;var gr=r(88147),_r=r(87469);const Cr={components:{RModalForm:gr.A,RCashback:_r.A},props:{storeName:{type:String,required:!0},recommendedStores:{type:Array,required:!0},promo:{type:Object,required:!0}},data:()=>({category:"No Cash Back",module_type:"No Cash Back",entity_name:"Modal",eeid:46845}),mounted(){this.show()},methods:{show(){setTimeout((()=>{this.track("View Module")}),100),setTimeout((()=>{this.$store.dispatch("updateMerchant",{notificationHover:!1})}),1e3)},close(){this.track("Click Module",{cta_type:"close"}),this.$emit("close")},track(t,e){this.$emit("track",t,{module_type:this.module_type,entity_name:this.entity_name,...e})},activate(t){(0,bt.Y)(t,{channel:this.promo.channel,xfasParams:this.promo.xfasParams,eeid:this.eeid,store_url:"",sessionAttributes:{source:`${this.entity_name} ${this.module_type}`}}),this.$emit("close")},clickOther(){const t=(0,B.V)(this.promo.url);this.$emit("track","Visit Page",{preceding_screen_name:`${this.module_type} ${this.entity_name}`,url:t}),this.$emit("navigate",{url:t}),this.$emit("close")}}};const br=(0,Y.A)(Cr,fr,[],!1,null,null,null).exports;var yr=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"rr-slide-fade"}},[t.recommendedStore||t.promo.url?e("aside",{staticStyle:{position:"fixed",top:"0",right:"0",left:"0",bottom:"0","z-index":"2147483647","background-color":"rgba(0,0,0,.5)"},attrs:{"data-tid":"no-cash-back-interrupt",role:"dialog"},on:{click:function(e){return e.target!==e.currentTarget?null:t.close("backdrop")}}},[e("div",{staticStyle:{position:"fixed",top:"10px",right:"10px",background:"transparent"}},[e("r-close-button",{on:{click:function(e){return t.close("close")}}}),e("img",{staticClass:"rr-cursor-pointer",attrs:{alt:"",src:t.interruptImage},on:{click:function(e){return e.stopPropagation(),t.activate.apply(null,arguments)}}})],1)]):t._e()])};yr._withStripped=!0;const kr={components:{RCloseButton:te.A},props:{recommendedStore:{type:Object,default:null},promo:{type:Object,required:!0}},data:()=>({category:"No Cash Back",module_type:"No Cash Back",entity_name:"Interrupt Message",eeid:46326}),computed:{interruptImage(){return this.promo.recommendedStoreInterruptImage}},mounted(){this.show()},methods:{show(){setTimeout((()=>{this.track("View Module")}),100),!0!==this.promo.persistent&&setTimeout((()=>{(0,f.r)("updatePromo",{id:this.promo.id,interruptShown:!0})}),1e3)},close(t){this.track("Click Module"),"close"===t&&this.$store.dispatch("updateMerchant",{notificationHover:!1}),this.$emit("close")},track(t,e={}){this.$emit("track",t,{module_type:this.module_type,entity_name:this.entity_name,...e})},activate(){this.recommendedStore?(0,bt.Y)(this.recommendedStore.storeId,{channel:this.promo.channel,xfasParams:this.promo.xfasParams,eeid:this.eeid,store_url:"",sessionAttributes:{source:`${this.entity_name} ${this.module_type}`}}):this.$emit("navigate",{url:(0,B.V)(this.promo.url)}),this.$emit("close")}}};const xr=(0,Y.A)(kr,yr,[],!1,null,null,null).exports,Ar=a().extend({name:"ConquestingBanner",components:{RecommendedBanner:vr,RecommendedModal:br,RecommendedInterrupt:xr},props:{promo:{type:Object,required:!0}},data:()=>({recommendedStore:null,recommendedStores:null,visible:!0}),computed:{...(0,n.aH)(["merchant"]),renderModal(){return this.promo.recommendedStoreIds&&this.recommendedStores},renderInterrupt(){return this.promo.recommendedStoreInterruptImage&&(this.promo.url||this.recommendedStore)},renderBanner(){return this.recommendedStore}},async created(){const t=this.promo.channel;if(!this.promo.flagId||!this.promo.flagValue||await c.r.activate(this.promo.flagId,{storeId:this.promo.recommendedStoreId,placement:"Conquesting_banner"})===this.promo.flagValue){if(this.promo.recommendedStoreId){await(0,f.r)("updateRewards",{channel:t,storeIds:[this.promo.recommendedStoreId]});const e=await(0,ur.D)([this.promo.recommendedStoreId],t);this.recommendedStore=e.find((t=>t.offers_cb))}else if(this.promo.recommendedStoreIds){await(0,f.r)("updateRewards",{channel:t,storeIds:this.promo.recommendedStoreIds});const e=(await(0,ur.D)(this.promo.recommendedStoreIds,t)).filter((t=>t.offers_cb)),r=e.map((async t=>{t.images.largeLogo.url=await(0,dr.a)(t.images.largeLogo.url)}));await Promise.all(r),this.recommendedStores=e}this.renderModal||this.renderInterrupt||this.renderBanner?this.$emit("recommended-rendered"):this.$store.dispatch("updateComponents",{recommended:!1})}},methods:{track(t,e={}){g.m.track(t,{store_id:this.recommendedStore?.storeId,store_name:this.recommendedStore?.storeName,domain:location.host,...e})},close(){this.visible=!1}}});const wr=(0,Y.A)(Ar,lr,[],!1,null,null,null).exports;var Sr=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.visible?e("takeover-form",{attrs:{merchant:t.merchant,conditions:t.conditions,orderTotal:t.orderTotal,featureFlag:t.takeoverCashbackFFlag},on:{clickClose:t.clickClose,clickCTA:t.clickCTA}}):t._e()};Sr._withStripped=!0;var Tr=r(57689),$r=r(97350),Mr=function(){var t=this,e=t._self._c;return e("r-modal-form",{attrs:{"data-tid":"takeover",width:"400",enableFocusTrap:"",closeOnEsc:"",rakPlus:t.merchant.reward.rakplusTargeted},on:{close:function(e){return t.$emit("clickClose")}}},[e("div",{staticClass:"rr-takeover rr-flex rr-flex-col rr-text-center rr-items-center"},[e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-mb-16 rr-mx-16"},[e("div",{staticClass:"rr-takeover__exclamation-mark rr-mb-24"}),t.cashBackEstimate?e("div",{staticClass:"rr-flex rr-flex-col"},[t.tieredCashback?e("i18n",{staticClass:"rr-t-h2 rr-text-primary rr-px-48",attrs:{tag:"div",path:"takeover.estimatedCashback.tieredCashbackTitle"},scopedSlots:t._u([{key:"cashBackEstimate",fn:function(){return[e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.cashBackEstimate))])]},proxy:!0}],null,!1,517851170)}):e("i18n",{staticClass:"rr-t-h2 rr-text-primary rr-px-48",attrs:{tag:"div",path:"takeover.estimatedCashback.cashbackTitle"},scopedSlots:t._u([{key:"cashBackEstimate",fn:function(){return[e("span",{staticClass:"rr-text-cashback"},[t._v(t._s(t.cashBackEstimate))])]},proxy:!0}],null,!1,517851170)}),t.tieredCashback?e("r-eligibility-popover",{staticClass:"rr-ma-8",attrs:{conditions:t.conditions}}):t._e(),e("div",{staticClass:"rr-t-subheader-s rr-my-8"},[t._v(" "+t._s(t.$t("takeover.estimatedCashback.body"))+" ")]),t.showCashbackCalculation?e("div",{staticClass:"rr-flex rr-flex-col rr-mt-8"},[e("r-divider",{staticClass:"rr-my-8",attrs:{color:"#EBEBEB"}}),e("div",{staticClass:"rr-flex rr-justify-between rr-t-descriptor-xs rr-text-primary"},[e("span",[t._v(t._s(t.$t("takeover.estimatedCashback.subtotal"))+":")]),e("span",[t._v("$"+t._s(t.orderTotal))])]),e("div",{staticClass:"rr-flex rr-justify-between rr-t-descriptor-xs rr-text-cashback"},[e("span",[t._v(t._s(t.$t("takeover.estimatedCashback.cashback"))+":")]),e("span",[t._v(t._s(t.cashBackEstimate))])]),e("r-divider",{staticClass:"rr-my-8",attrs:{color:"#EBEBEB"}}),e("r-eligibility-popover",{staticClass:"rr-my-8",attrs:{conditions:t.conditions}})],1):t._e()],1):e("div",[e("div",{staticClass:"rr-t-h2 rr-text-primary rr-mb-8"},[t._v(" "+t._s(t.$t("takeover.title"))+" ")]),e("div",{staticClass:"rr-t-subheader-s rr-mb-8 rr-text-secondary"},[t._v(" "+t._s(t.$t("takeover.body"))+" ")])])]),e("r-button",{staticClass:"rr-mb-8",attrs:{size:"large"},on:{click:function(e){return t.$emit("clickCTA")}}},[t._v(" "+t._s(t.$t("takeover.cta",{reward:t.rewardTotal}))+" ")])],1)])};Mr._withStripped=!0;var Lr=function(){var t=this,e=t._self._c;return t.visible?e("div",[e("div",{staticClass:"rr-text-secondary rr-cursor-default rr-flex rr-justify-center rr-items-center"},[e("span",{staticClass:"rr-t-descriptor-xs"},[t._v(t._s(t.message))]),e("span",{staticClass:"rr-ml-4 rr-flex rr-focus rr-focus--rounded",attrs:{tabindex:"0"}},[e("info-icon"),e("exclusions-popover",{attrs:{conditions:t.conditions,options:t.options,width:t.width}})],1)])]):t._e()};Lr._withStripped=!0;var Pr=function(){var t=this,e=t._self._c;return e("r-popover",{attrs:{trigger:"mouse",width:t.width,anchor:t.anchor,options:t.options,padding:"grande"},on:{show:function(e){return t.$emit("show")},hide:function(e){return t.$emit("hide")}}},[e("div",{staticClass:"rr-t-body rr-text-left"},[t.message?e("div",[t._v(" "+t._s(t.sanitizeHtml(t.message))+" ")]):[t.conditions.reward?e("div",[e("strong",[t._v("Exclusions:")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.sanitizeHtml(t.conditions.reward))}})]):t._e(),t.conditions.nonReward?e("div",{staticClass:"rr-mt-8"},[e("strong",[t._v("Special Terms:")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.sanitizeHtml(t.conditions.nonReward))}})]):t._e()]],2)])};Pr._withStripped=!0;const Ir={components:{RPopover:Xe.A},props:{conditions:{type:Object,default:()=>({})},message:{type:String,default:""},anchor:{type:Object,default:null},options:{type:Object,default:()=>({})},width:{type:String,default:"450px"}},methods:{sanitizeHtml:Pe.p}};const Br=(0,Y.A)(Ir,Pr,[],!1,null,null,null).exports;var Er=r(84175);const Rr={components:{ExclusionsPopover:Br,InfoIcon:Er.A},props:{conditions:{type:Object,required:!0},options:{type:Object,default:()=>({})},width:{type:String,default:"450px"},message:{type:String,default(){return this.$t("eligibilityPopover.defaultMessage")}}},computed:{visible(){return this.conditions&&(this.conditions.reward||this.conditions.nonReward)}}};const Nr=(0,Y.A)(Rr,Lr,[],!1,null,null,null).exports;var Or=r(48866);const Hr={components:{REligibilityPopover:Nr,RModalForm:gr.A,RButton:X.A,RDivider:Or.A},props:{merchant:{type:Object,required:!0},conditions:{type:Object,default:null},orderTotal:{type:Number,default:0},featureFlag:{type:Boolean,default:!1}},computed:{showCashbackCalculation(){return!!(!this.tieredCashback&&this.orderTotal&&this.amountSaved>=2)},tieredCashback(){const t=this.merchant.reward;return this.featureFlag&&this.merchant.affiliatizerEnabled&&t.tiered&&t.range},amountSaved(){let t=0;const e=this.merchant?.reward;return e&&this.featureFlag&&this.merchant.affiliatizerEnabled&&(e.tiered&&e.range?"Fixed"===e.display&&(t=(0,$r.j)(e,this.orderTotal)):t=(0,$r.j)(e,this.orderTotal)),t},cashBackEstimate(){if(!this.featureFlag||!this.merchant.affiliatizerEnabled)return"";const t=this.merchant.reward;return t.tiered&&t.range?"Fixed"===t.display?this.amountSaved>=2?`${this.$t("common.upTo")} ${(0,Mt.u)(this.amountSaved)}`:"":"Percentage"===t.display?`${this.$t("common.upTo")} ${t.amount}%`:"":"Fixed"===t.display||"Percentage"===t.display&&this.orderTotal&&this.amountSaved>=2?(0,Mt.u)(this.amountSaved):`${t.amount}%`},rewardTotal(){return(0,tt.a)(this.merchant.reward)}}};const Dr=(0,Y.A)(Hr,Mr,[],!1,null,null,null).exports,Vr=a().extend({name:"TakeoverView",components:{TakeoverForm:Dr},data:()=>({category:"Takeover Prevention",visible:!1,module_type:"modal",entity_name:"Takeover Prevention",orderTotal:0,conditions:null}),computed:{...(0,n.aH)(["merchant","settings"]),showCashbackCalculation(){return!!(!this.isTieredCashback&&this.orderTotal&&this.amountSaved>=2)},isTieredCashback(){const t=this.merchant.reward;return!!(this.takeoverCashbackFFlag&&this.merchant.affiliatizerEnabled&&t.tiered&&t.range)},amountSaved(){let t=0;const e=this.merchant?.reward;return e&&this.takeoverCashbackFFlag&&this.merchant.affiliatizerEnabled&&(e.tiered&&e.range?"Fixed"===e.display&&(t=(0,$r.j)(e,this.orderTotal)):t=(0,$r.j)(e,this.orderTotal)),t},takeoverCashbackFFlag:()=>l.o.get("takeoverCashback")},async mounted(){const t=()=>"visible"===document.visibilityState&&(this.track("View Module",(0,E.D)(this.merchant.reward)),document.removeEventListener("visibilitychange",t),!0);t()||document.addEventListener("visibilitychange",t);const e=await(0,f.r)("getStoreContent",{storeId:this.merchant.storeId});e?.conditions&&(this.conditions=e.conditions),this.show()},methods:{track(t,e={}){g.m.track(t,{module_type:this.module_type,entity_name:this.entity_name,store_id:this.merchant.storeId,store_name:this.merchant.storeName,cb_calc:this.showCashbackCalculation,...this.amountSaved&&{amount_saved:this.amountSaved},...e})},async getOrderTotal(){if(this.takeoverCashbackFFlag&&this.merchant.affiliatizerEnabled){const t=await(0,f.r)("coupons.getConfigs",{storeId:this.merchant.storeId,url:document.location.href});t?.length&&t.find((t=>(this.orderTotal=t.controls?.orderTotal&&(0,Tr.z7)((0,Tr.fE)(t.controls.orderTotal)),this.orderTotal)))}},clickCTA(){(0,bt.Y)(this.merchant.storeId,{store_url:document.location.href,eeid:D.P4.TAKEOVER_PREVENTION,sessionAttributes:{source:"Takeover Prevention modal"}}),this.hide()},clickClose(){this.track("Click Module",{cta_type:"close"}),this.hide()},show(){this.visible=!0},hide(){this.visible=!1}}}),Fr=Vr;const Wr=(0,Y.A)(Fr,Sr,[],!1,null,null,null).exports;var zr=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("transition",{attrs:{name:"rr-slide-fade"}},[t.visible?e("cart-reminder-form",{attrs:{merchant:t.merchant,superCAA:t.superCAA,coupons:t.coupons,storeContent:t.storeContent,cartTotal:t.cartTotal,amountSaved:t.amountSaved,currency:t.currency,backgroundActivation:t.backgroundActivation,progressiveEducation:t.settings?.progressiveEducation},on:{clickClose:t.close,clickCTA:function(e){t.merchant.loggedIn?t.activate():t.login()}}}):t._e()],1)};zr._withStripped=!0;var jr=function(){var t=this,e=t._self._c;return e("r-form",{attrs:{"data-tid":"cart-reminder",width:t.backgroundActivation?340:304,rakPlus:t.rakPlus},on:{close:function(e){return t.$emit("clickClose")}}},[e("div",{staticClass:"rr-notification rr-flex rr-flex-col rr-items-center rr-text-secondary"},[t.backgroundActivation&&t.progressiveEducation.BackgroundActivation?e("bg-activation-description",{staticClass:"rr-mt-16"}):e("img",{staticClass:"rr-my-12",attrs:{src:t.superCAA?t.couponAnimationImageSrc:t.dollarAnimationImageSrc,height:"77px",alt:""}}),e("div",{staticClass:"rr-t-h2 rr-mb-24 rr-text-primary rr-text-center"},[t._v(" "+t._s(t.cashbackTitle)+" ")]),t.showCalculation?e("div",{staticClass:"rr-mb-24 rr-flex rr-flex-col rr-w-full rr-t-descriptor-xs rr-text-primary"},[e("r-divider",{staticClass:"rr-mb-8"}),e("div",{staticClass:"rr-flex rr-items-center rr-justify-between"},[e("span",[t._v("Subtotal:")]),e("span",[t._v(t._s(t.formatMoney(t.cartTotal)))])]),e("div",{staticClass:"rr-text-cashback rr-flex rr-items-center rr-justify-between"},[e("span",[t.cashbackAmountFixed?t._e():[t._v(t._s(t.cashbackAmount)+" ")],t._v("Cash Back:")],2),t.amountSaved?e("span",[t._v(t._s(t.formatMoney(t.amountSaved)))]):e("span",[t._v(t._s(t.currency)+"??")])]),t.superCAA&&t.coupons.length?e("div",{staticClass:"rr-flex rr-items-center rr-justify-between rr-text-action"},[e("span",[t._v(t._s(t.coupons.length)+" Coupon"),t.coupons.length>1?[t._v("s")]:t._e(),t._v(" Found:")],2),e("span",[t._v("-"+t._s(t.currency)+"??")])]):t._e(),e("r-divider",{staticClass:"rr-mt-8"})],1):t._e(),t.storeContent.conditions?e("r-eligibility-popover",{staticClass:"rr-mb-24",attrs:{width:"300px",conditions:t.storeContent.conditions,options:{strategy:"fixed",placement:"left"}}}):t._e(),e("bg-activation-button",{attrs:{merchant:t.merchant,cashbackAmount:t.cashbackAmount,backgroundActivation:t.backgroundActivation,ctaText:t.ctaText},on:{clickCTA:function(e){return t.$emit("clickCTA")}}}),e("div",{staticClass:"rr-t-descriptor-xs rr-text-center rr-mt-24"},[t._v(" Cash Back will be added to your Rakuten account "+t._s(t.reportingMessage)+". ")])],1)])};jr._withStripped=!0;var qr=r(94682);const Ur={components:{BgActivationButton:ie,BgActivationDescription:le,RDivider:Or.A,RForm:F.A,REligibilityPopover:Nr},props:{merchant:{type:Object,required:!0},superCAA:{type:Boolean,default:!1},coupons:{type:Array,default:()=>[]},storeContent:{type:Object,default:()=>({})},cartTotal:{type:Number,default:0},amountSaved:{type:Number,default:0},currency:{type:String,default:"$"},backgroundActivation:{type:String,default:""},progressiveEducation:{type:Object,default:()=>({})}},computed:{showCalculation(){return!(!this.cartTotal||!(this.amountSaved||this.superCAA&&this.coupons.length))},cashbackTitle(){return this.superCAA?"Don\u2019t miss out on the best deal!":this.amountSaved?`Get ${(0,Mt.u)(this.amountSaved)} back!`:`Get ${this.cashbackAmount} Cash Back!`},cashbackAmount(){return this.merchant.rewardsExpired?"":(0,tt.a)(this.merchant.reward)},cashbackAmountFixed(){return"Fixed"===this.merchant.reward.display},ctaText(){return this.superCAA?"Get Me the Best Deal":this.amountSaved?"":this.merchant.backgroundActivated?"Activating Cash Back":"Activate Cash Back"},couponAnimationImageSrc(){const t=this.rakPlus?"img/coupon-animation-rak-plus.svg":"img/coupon-animation.svg";return(0,Lt.s)(t)},dollarAnimationImageSrc(){const t=this.rakPlus?"img/dollar-animation-rak-plus.svg":"img/dollar-animation.svg";return(0,Lt.s)(t)},reportingMessage(){return(0,qr.n)({...this.merchant,storeContent:this.storeContent})},rakPlus(){return this.merchant.reward.rakplusTargeted}},methods:{formatMoney:Mt.u}};const Yr=(0,Y.A)(Ur,jr,[],!1,null,null,null).exports,Zr=a().extend({components:{CartReminderForm:Yr},mixins:[Kt.A],props:{merchant:{type:Object,required:!0},cartTotal:{type:Number,default:null},superCAA:{type:Boolean,default:!1},coupons:{type:Array,default:null}},data:()=>({module_type:"Checkout Notification",entity_name:"Cart Reminder",visible:!1,storeContent:null,THRESHOLD_MAX:1e3,THRESHOLD_MIN:2,backgroundActivation:""}),computed:{...(0,n.aH)(["settings"]),...(0,n.L8)(["currency"]),showCalculation(){return!(!this.cartTotal||!(this.amountSaved||this.superCAA&&this.coupons.length))},amountSaved(){const t=this.merchant.reward;let e=0;return this.merchant.rewardsExpired||t.range&&!this.superCAA?null:(e=(0,$r.j)(t,this.cartTotal),e>=this.THRESHOLD_MIN&&e<this.THRESHOLD_MAX?e:null)}},async created(){this.superCAA&&(this.module_type="Coupon Magic",this.entity_name="Coupons Cash Back Notification"),this.backgroundActivation=await(0,f.r)("isEligibleForBackgroundActivationV2",{storeId:this.merchant.storeId,activateTest:!0})},async mounted(){this.storeContent=await(0,f.r)("getStoreContent",{storeId:this.merchant.storeId}),this.visible=!0,this.track("View Module",(0,E.D)(this.merchant.reward))},methods:{activate(){(0,bt.Y)(this.merchant.storeId,{store_url:document.location.href,forceBackgroundActivation:this.superCAA,backgroundActivation:this.backgroundActivation,sessionAttributes:{source:this.superCAA?"Super CAA":"Cart Reminder"}}),this.superCAA&&(this.track("Click Module"),this.hide(),this.$emit("onApply",{superCAA:!0,preceding_screen_name:this.entity_name}))},login(){(0,f.r)("login",{merchant:this.merchant,type:this.module_type,source:this.superCAA?"Super CAA":"Cart Reminder"}),this.hide()},close(){this.$store.dispatch("updateMerchant",{notificationReminder:!1,notificationHover:!1}),this.track("Click Module",{cta_type:"close"}),this.hide()},hide(){this.$store.dispatch("updateComponents",{cartReminder:!1})},track(t,e={}){g.m.track(t,{module_type:this.module_type,entity_name:this.entity_name,...this.merchant&&{store_name:this.merchant.storeName,store_id:this.merchant.storeId,cb_calc:this.showCalculation,...this.showCalculation&&{amount_saved:this.amountSaved},...this.superCAA&&{coupons_number:this.coupons.length}},...e})}}});const Gr=(0,Y.A)(Zr,zr,[],!1,null,null,null).exports;var Xr=function(){var t=this,e=t._self._c;t._self._setupProxy;return t.visible?e("div",[t.caaHoverVisible?e("coupons-button-view",{ref:"button",attrs:{merchant:t.merchant,settings:t.settings,coupons:t.coupons,config:t.config,acsCoupons:t.acs_coupons,\u0441aaWithActivation:t.\u0441aaWithActivation,caaWithoutActivation:t.caaWithoutActivation},on:{onApply:t.apply,close:t.formClose,clickActivateCTA:function(e){return t.activateMerchant({ctaActivateCBOnly:!0})},caaLog:t.caaLog}}):t._e(),t.caaFormVisible?e("coupons-form-view",{ref:"form",attrs:{merchant:t.merchant,coupons:t.coupons,config:t.config,acsCoupons:t.acs_coupons,\u0441aaWithActivation:t.\u0441aaWithActivation,preceding_screen_name:t.preceding_screen_name,timeout:t.stepDuration,index:t.index,progress:t.currentProgress,state:t.state,applyerObject:t.applyerObject},on:{updateProgress:t.updateProgress,done:t.formDone,apply:t.formApply,cancel:t.formCancel,close:t.formClose,caaLog:t.caaLog}}):t._e()],1):t._e()};Xr._withStripped=!0;var Qr=r(83198);const Kr={Processing:"processing",Error:"error",Success:"success"};var Jr=r(75521);var ti=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("transition",{attrs:{appear:"",name:"coupons-hover-fade"}},[e("div",[t.progressiveEducationPopover?e("education-popover",{attrs:{anchor:t.educationPopoverAnchor,storeId:t.merchant.storeId,storeName:t.merchant.storeName}}):t._e(),t.showConfirmation?e("coupons-confirmation",{on:{clickCloseConfirmation:t.clickCloseConfirmation,track:t.track}}):t._e(),t.visible?e("coupons-button-form",{ref:"anchor",attrs:{coupons:t.coupons,merchant:t.merchant,\u0441aaWithActivation:t.\u0441aaWithActivation,caaWithoutActivation:t.caaWithoutActivation},on:{clickClose:t.clickClose,clickCTA:t.clickCTA,clickActivateCTA:t.clickActivate}}):t._e()],1)])};ti._withStripped=!0;var ei=function(){var t=this,e=t._self._c;return e("r-form",{attrs:{"data-tid":"coupons-magic-notification","aria-label":"Rakuten Coupon Magic",disableCloseButton:t.caaWithoutActivation,rakPlus:t.rakPlus},on:{close:function(e){return t.$emit("clickClose")}}},[e("div",{staticClass:"rr-flex rr-flex-col rr-items-center"},[e("img",{staticClass:"rr-mt-16",attrs:{src:t.couponAnimationImageSrc,height:"77px",alt:""}}),e("div",{staticClass:"rr-t-h2 rr-mt-8"},[t._v(" "+t._s(t.flagMessage)+" ")]),t.\u0441aaWithActivation?e("r-cashback",{staticClass:"rr-mt-6",attrs:{reward:t.merchant.reward,previousRewardText:t.merchant.reward.previous}}):t._e(),e("r-button",{staticClass:"rr-mt-24",attrs:{block:"",disabled:t.buttonDisabled,size:"medium"},on:{click:t.clickCTA}},[t._v(" "+t._s(t.cta)+" ")]),t.\u0441aaWithActivation?e("r-button",{staticClass:"rr-mt-24",attrs:{variant:"tertiary",size:"medium"},on:{click:function(e){return t.$emit("clickActivateCTA")}}},[t._v(" Activate Cash Back Only ")]):t._e(),t.caaWithoutActivation?e("r-button",{staticClass:"rr-t-link rr-mt-16",attrs:{variant:"tertiary",title:"Dismisses Rakuten Apply Coupons at Checkout message"},on:{click:function(e){return t.$emit("clickClose")}}},[t._v(" Remind me later ")]):t._e()],1),t._t("default")],2)};ei._withStripped=!0;const ri={components:{RButton:X.A,RForm:F.A,RCashback:_r.A},props:{coupons:{type:Array,default:()=>[]},merchant:{type:Object,required:!0},\u0441aaWithActivation:{type:Boolean,default:!1},caaWithoutActivation:{type:Boolean,default:!1}},data:()=>({show:!1,buttonDisabled:!1}),computed:{flagMessage(){return this.coupons.length>1?`${this.coupons.length} Coupons Found`:"1 Coupon Found"},couponAnimationImageSrc(){const t=this.rakPlus?"img/coupon-animation-rak-plus.svg":"img/coupon-animation.svg";return(0,Lt.s)(t)},cta(){return this.caaWithoutActivation?"Apply Coupons at Checkout":this.\u0441aaWithActivation?"Apply and Activate":"Apply Coupons"},rakPlus(){return this.merchant.reward.rakplusTargeted}},methods:{clickCTA(){this.buttonDisabled=!0,this.$emit("clickCTA")}}};const ii=(0,Y.A)(ri,ei,[],!1,null,null,null).exports;var si=function(){var t=this,e=t._self._c;return e("r-popover",{staticClass:"rr-text-center rr-bg-dark",attrs:{backgroundColor:"#292A6B",width:"304",anchor:t.anchor},on:{show:t.onShow}},[e("div",{staticClass:"rr-t-descriptor-m rr-mb-16 rr-text-inverse whitespace-nowrap"},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("\u2728")]),t._v(" "+t._s(t.$t("coupons.popover.title"))+" "),e("span",{attrs:{"aria-hidden":"true"}},[t._v("\u2728")])]),e("div",{staticClass:"rr-t-descriptor-s rr-text-inverse"},[t._v(" "+t._s(t.$t("coupons.popover.body"))+" ")])])};si._withStripped=!0;const oi={components:{RPopover:Xe.A},mixins:[Qe.A],props:{storeId:{type:Number,default:null},storeName:{type:String,default:""},anchor:{type:Object,default:null}},data:()=>({type:"CouponMagic",entityName:"Coupon Magic",moduleType:"tooltip"})};const ai=(0,Y.A)(oi,si,[],!1,null,null,null).exports;var ni=function(){var t=this,e=t._self._c;return e("transition",{attrs:{appear:"",name:"rr-slide-fade",css:t.transition}},[e("r-form",{staticClass:"rr-coupons-confirmation rr-pa-24 rr-items-center",attrs:{width:"340px",backgroundColor:"#480081",flat:""}},[e("r-close-button",{attrs:{title:"Close Rakuten dialog",color:"#fff"},on:{click:function(e){return t.$emit("clickCloseConfirmation")}}}),e("r-heading-logo",{staticClass:"rr-mb-16 rr-text-center",attrs:{variant:"white"}}),e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-inverse"},[e("div",{staticClass:"rr-t-h2 rr-text-center"},[e("check-icon",{attrs:{size:"30"}})],1),e("div",{staticClass:"rr-t-subheader-s rr-text-center rr-mx-20 rr-mt-12 rr-mb-8"},[t._v(" We'll automatically apply all coupons at checkout. ")])])],1)],1)};ni._withStripped=!0;const ci={components:{RHeadingLogo:q.A,RCloseButton:te.A,CheckIcon:ct.A,RForm:F.A},mounted(){this.$emit("track","View Module",{entity_name:"Auto Apply Coupon Confirmation"})}};const li=(0,Y.A)(ci,ni,[],!1,null,null,null).exports,di=Kt.A.extend({components:{CouponsButtonForm:ii,EducationPopover:ai,CouponsConfirmation:li},props:{settings:{type:Object,default:()=>({})},coupons:{type:Array,required:!0},acsCoupons:{type:Array,required:!0},merchant:{type:Object,required:!0},config:{type:Object,required:!0},\u0441aaWithActivation:{type:Boolean,default:!1},caaWithoutActivation:{type:Boolean,default:!1}},data:()=>({module_type:"Coupon Magic",entity_name:"Coupons Available Notification",visible:!1,progressiveEducationPopover:!1,showConfirmation:!1}),computed:{educationPopoverAnchor(){return this.$refs.anchor?.$el}},mounted(){this.\u0441aaWithActivation?this.entity_name="Coupons and Cash Back Available Notification":this.caaWithoutActivation&&(this.entity_name="Apply Coupons at Checkout Notification"),this.visible=!0,this.track(g.m.VIEW_MODULE),this.renderPopover(),setTimeout((()=>{this.$emit("caaLog",{action:"show",coupon_auto_apply_status:"Show Flag"})}),1e3)},methods:{track(t,e={}){const r=l.o.get("caaAdaptiveSources");g.m.track(t,{module_type:this.module_type,entity_name:this.entity_name,store_id:this.merchant.storeId,store_name:this.merchant.storeName,coupons_number:this.coupons.length,tracking_ticket:this.merchant.shoppingTrip.ttn,...r&&{oc_coupons:this.coupons.filter((t=>"OC"===t.source)).length,acs_coupons:this.acsCoupons.length,coupons_number:this.coupons.length},...e})},renderPopover(){this.settings.progressiveEducation?.CouponMagic&&setTimeout((()=>{if(this.$el){this.$el.getBoundingClientRect()&&(this.progressiveEducationPopover=!0)}}),1e3)},clickCTA(){this.hide(),this.track(g.m.CLICK_MODULE,{cta_type:this.caaWithoutActivation?"apply_coupons_at_checkout":"apply_coupons"}),this.caaWithoutActivation?((0,b.a)(this.merchant.storeId,{instantStartCAA:!0}),this.showConfirmationHover()):this.$emit("onApply",{preceding_screen_name:this.entity_name})},clickClose(){this.track(g.m.CLICK_MODULE,{cta_type:"close"}),this.hide(),this.$emit("close")},clickActivate(){this.hide(),this.$emit("clickActivateCTA")},clickCloseConfirmation(){this.showConfirmation=!1,this.track(g.m.CLICK_MODULE,{cta_type:"close_autoapply_confirmation"})},hide(){this.progressiveEducationPopover=!1,this.visible=!1},showConfirmationHover(){this.showConfirmation=!0,window.setTimeout((()=>{this.showConfirmation=!1}),5e3)}}});const ui=(0,Y.A)(di,ti,[],!1,null,null,null).exports;var hi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("coupons-form-content",{attrs:{state:t.state,coupons:t.coupons,appliedCoupons:t.appliedCoupons,reviewed:t.reviewed,index:t.index,timeout:t.timeout,merchant:t.merchant,conditions:t.conditions,member:t.member,orderTotal:t.orderTotal,currency:t.currency,progress:t.progress,\u0441aaWithActivation:t.\u0441aaWithActivation,coupon:t.coupon,subTotal:t.subTotal,cashbackAmount:t.cashbackAmount},on:{track:t.track,clickActivate:t.clickActivate,clickClose:t.clickClose,clickReview:t.clickReview,clickContinueCheckout:t.clickContinueCheckout,caaLog:function(e){return t.$emit("caaLog",e)},updateProgress:function(e){return t.$emit("updateProgress",e)}}})};hi._withStripped=!0;var pi=function(){var t=this,e=t._self._c;return e("r-modal-form",{staticClass:"rr-caa",attrs:{"data-tid":"coupons-magic-progress","aria-modal":"true",width:t.isTestDisplayed?"760px":"440px",headerLogo:t.isTestDisplayed?"none":"left",backgroundStyle:t.isTestDisplayed?"linear-gradient(90deg, #f4f3fe 50%, white 50%)":"white",padding:t.isTestDisplayed?"none":"large",enableFocusTrap:t.focusTrapEnabled,closeOnEsc:"",rakPlus:t.merchant.reward.rakplusTargeted},on:{close:function(e){return t.$emit("clickClose")}}},[e("div",{staticClass:"rr-caa__form rr-flex rr-flex-col"},["processing"===t.state?e("form-progress",{ref:"form",attrs:{coupons:t.coupons,index:t.index,timeout:t.timeout,progress:t.progress,merchant:t.merchant,\u0441aaWithActivation:t.merchant.offers_cb&&t.\u0441aaWithActivation},on:{track:(e,r)=>t.$emit("track",e,r),updateProgress:function(e){return t.$emit("updateProgress",e)}}}):e("form-result",{ref:"form",attrs:{cashbackAmount:t.cashbackAmount,conditions:t.conditions,coupons:t.appliedCoupons,currency:t.currency,member:t.member,merchant:t.merchant,orderTotal:t.orderTotal,reviewed:t.reviewed,state:t.state,isTestDisplayed:t.isTestDisplayed,\u0441aaWithActivation:t.\u0441aaWithActivation,coupon:t.coupon,cashbackLimit:t.cashbackLimit},on:{clickReview:function(e){return t.$emit("clickReview")},clickContinueCheckout:function(e){return t.$emit("clickContinueCheckout")},clickActivate:function(e){return t.$emit("clickActivate")},track:(e,r)=>t.$emit("track",e,r),caaLog:function(e){return t.$emit("caaLog",e)}}})],1)])};pi._withStripped=!0;var mi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-flex-col rr-text-center"},[t.\u0441aaWithActivation?e("div",{staticClass:"rr-progress-cb-activated rr-flex rr-flex-col rr-justify-center rr-items-center rr-py-16 rr-mb-24"},[e("div",{staticClass:"rr-flex rr-items-center rr-justify-center"},[e("check-icon",{attrs:{size:"16"}}),e("span",{staticClass:"rr-t-descriptor-s rr-ml-8"},[t._v(t._s(t.cashbackAmount)+" Cash Back activated")])],1),e("r-link",{staticClass:"rr-t-cashback-large rr-mt-8",on:{click:t.openStorePage}},[t._v(" See all Terms & Exclusions ")])],1):t._e(),e("div",{staticClass:"rr-t-h2 rr-mb-32"},[t._v(" "+t._s(t.titleText)+" ")]),e("div",{staticClass:"rr-t-descriptor-m rr-text-secondary"},[t._v(" CODE: "),e("strong",[t._v(t._s(t.code))])]),e("div",{staticClass:"rr-coupon-loader-bg rr-ma-24",attrs:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",title:"testing coupon in progress...","aria-valuetext":`Checking the code ${t.code}`,"aria-valuenow":`${Math.round(t.currentProgress)}%`}},[e("div",{staticClass:"rr-coupon-loader",style:{width:`${t.currentProgress}%`}})]),e("div",{staticClass:"rr-t-tag-large rr-text-secondary"},[t._v(" "+t._s(t.index+1)+"/"+t._s(t.coupons.length)+" ")])])};mi._withStripped=!0;const vi={components:{CheckIcon:ct.A,RLink:et.A},props:{coupons:{type:Array,required:!0},index:{type:Number,default:0},timeout:{type:Number,required:!0},progress:{type:Number,default:0},merchant:{type:Object,required:!0},\u0441aaWithActivation:{type:Boolean,default:!1}},data:()=>({currentProgress:0}),computed:{code(){return this.coupons[this.index]?this.coupons[this.index].code:""},titleText(){return this.\u0441aaWithActivation?"Working our coupon magic...":1===this.coupons.length?"Testing 1 coupon":`Testing ${this.coupons.length} coupons`},cashbackAmount(){return(0,tt.a)(this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.reward)}},watch:{currentProgress(t){this.$emit("updateProgress",t)},index(){this.animate()}},created(){this.currentProgress=this.progress,this.$root.$on("done",(()=>{this.$animation&&this.$animation.stop()}))},mounted(){this.animate()},methods:{animate(){this.$animation=$()({progress:this.currentProgress}).stop().animate({progress:100*(this.index+1)/this.coupons.length},{duration:this.timeout,step:t=>{this.currentProgress=t}})},openStorePage(){const t=(0,B.V)(`/${this.merchant.siteUrl}`);(0,O.o)(t),this.$emit("track","Visit Page",{preceding_screen_name:"Coupon Application Progress Screen with CB Confirmation",url:t})}}};const fi=(0,Y.A)(vi,mi,[],!1,null,null,null).exports;var gi=function(){var t=this,e=t._self._c;return t.isTestDisplayed?e("form-result-large",{attrs:{coupon:t.coupon,orderTotal:t.orderTotal,merchant:t.merchant,conditions:t.conditions,currency:t.currency,state:t.state,\u0441aaWithActivation:t.\u0441aaWithActivation,totalSavings:t.totalSavings,cashbackAmount:t.cashbackAmount,reward:t.reward,displayConditions:t.displayConditions,cashbackLimit:t.cashbackLimit},on:{clickReview:function(e){return t.$emit("clickReview")},clickContinueCheckout:function(e){return t.$emit("clickContinueCheckout")},clickActivate:function(e){return t.$emit("clickActivate")},exclusionsClick:t.linkToStore}}):e("form-result-small",{attrs:{coupon:t.coupon,orderTotal:t.orderTotal,merchant:t.merchant,conditions:t.conditions,member:t.member,currency:t.currency,state:t.state,totalSavings:t.totalSavings,couponDiscount:t.couponDiscount,cashbackAmount:t.cashbackAmount,reward:t.reward,displayConditions:t.displayConditions,reviewed:t.reviewed,cashbackLimit:t.cashbackLimit},on:{clickReview:function(e){return t.$emit("clickReview")},clickContinueCheckout:function(e){return t.$emit("clickContinueCheckout")},clickActivate:function(e){return t.$emit("clickActivate")},exclusionsClick:t.linkToStore}})};gi._withStripped=!0;var _i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"rr-flex rr-flex-col rr-text-center rr-text-primary",class:{"rr-mt-24":"success"===t.state}},["success"===t.state?[e("div",{staticClass:"rr-caa--success"}),t.totalSavings>t.cashbackLimit?e("div",{staticClass:"rr-t-h2 rr-mb-40"},[t._v(" Great! We applied the best coupon code to this order"),t.offersCashBack?e("span",[t._v(", and you are getting "),e("span",[t._v(t._s(t.formatCashBack(t.reward))+" Cash Back")])]):t._e()]):t.couponDiscount>0?[e("div",{staticClass:"rr-t-h2"},[e("div",[t._v("Woohoo!")]),e("div",[t._v("You saved "+t._s(t.tieredPrefix)+t._s(t._f("format")(t.totalSavings,t.currency)))])]),t.offersCashBack?e("div",{staticClass:"rr-ma-32 rr-flex rr-flex-col rr-t-descriptor-xs rr-text-primary"},[e("div",{staticClass:"rr-caa__form__hr"}),e("div",{staticClass:"rr-flex rr-justify-between rr-mt-8"},[e("span",{staticClass:"rr-caa__form--text-trunc"},[e("span",[t._v("Coupon Code: ")]),e("r-coupon-static",{attrs:{code:t.coupon.code}})],1),e("span",[e("span",[t._v(t._s(t._f("format")(t.couponDiscount,t.currency)))])])]),e("div",{staticClass:"rr-flex rr-justify-between rr-text-cashback rr-mb-8"},[e("span",[t.rewardAmount?e("span",[t._v(t._s(t.rewardAmount)+"% ")]):t._e(),e("span",[t._v("Cash Back:")])]),e("span",[e("span",[t._v(t._s(t.tieredPrefix))]),e("span",[t._v(t._s(t._f("format")(t.cashbackAmount,t.currency)))])])]),e("div",{staticClass:"rr-caa__form__hr"}),t.displayConditions?e("r-eligibility-popover",{staticClass:"rr-mt-16",attrs:{conditions:t.conditions}}):t._e()],1):e("div",{staticClass:"rr-t-descriptor-s rr-my-24"},[t._v(" Coupon Code: "),e("r-coupon-static",{attrs:{code:t.coupon.code}})],1)]:[t.offersCashBack?[e("div",{staticClass:"rr-t-h2"},[t._v(" Woohoo! ")]),e("div",{staticClass:"rr-t-h2"},[t._v(" You saved "+t._s(t.tieredPrefix)+t._s(t._f("format")(t.cashbackAmount,t.currency))+" Cash Back ")]),e("div",{staticClass:"rr-ma-32 rr-flex rr-flex-col rr-t-descriptor-xs rr-text-primary"},[e("div",{staticClass:"rr-caa__form__hr"}),e("div",{staticClass:"rr-flex rr-justify-between rr-mt-8"},[e("span",{staticClass:"rr-caa__form--text-trunc"},[e("span",[t._v("Coupon Code: ")]),e("r-coupon-static",{attrs:{code:t.coupon.code}})],1),e("div",{staticClass:"rr-flex rr-justify-center rr-items-center"},[e("span",[t._v("See Details")]),e("span",{staticClass:"rr-ml-4 rr-flex rr-focus rr-focus--rounded",attrs:{tabindex:"0"}},[e("info-icon"),e("exclusions-popover",{attrs:{message:t.coupon.description}})],1)])]),e("div",{staticClass:"rr-flex rr-justify-between rr-text-cashback rr-mb-8"},[e("span",[t.rewardAmount?e("span",[t._v(t._s(t.rewardAmount)+"% ")]):t._e(),e("span",[t._v("Cash Back:")])]),e("span",[e("span",[t._v(t._s(t._f("format")(t.cashbackAmount,t.currency)))])])]),e("div",{staticClass:"rr-caa__form__hr"}),t.displayConditions?e("r-eligibility-popover",{staticClass:"rr-mt-16",attrs:{conditions:t.conditions}}):t._e()],1)]:[e("div",{staticClass:"rr-t-h2"},[t._v(" Awesome! ")]),e("div",{staticClass:"rr-t-h2 rr-mb-16"},[t._v(" You got a little something extra ")]),t.coupon.code?e("div",{staticClass:"rr-t-descriptor-s"},[t._v(" with code "),e("r-coupon",{attrs:{variant:"static",code:t.coupon.code}})],1):t._e(),e("div",{staticClass:"rr-t-descriptor-s rr-mb-24 rr-flex rr-justify-center rr-items-center"},[e("span",[t._v("See Details")]),e("span",{staticClass:"rr-ml-4 rr-flex rr-focus rr-focus--rounded",attrs:{tabindex:"0"}},[e("info-icon"),e("exclusions-popover",{attrs:{message:t.coupon.description}})],1)])]]]:e("div",{staticClass:"rr-text-center rr-mb-40"},[t.offersCashBack?[e("div",{staticClass:"rr-t-h2 rr-text-primary"},[t._v(" You found a great price and you\u2019re earning "),t.cashbackAmount>t.cashbackLimit?[t._v(" "+t._s(t.formatCashBack(t.reward))+" ")]:[t._v(" "+t._s(t.tieredPrefix)+t._s(t._f("format")(t.cashbackAmount,t.currency))+" ")],t._v(" Cash Back! ")],2)]:[e("div",{staticClass:"rr-t-h2 rr-mb-32"},[t._v(" You already have a great price ")]),t._m(0)],t.displayConditions?e("r-eligibility-popover",{staticClass:"rr-mt-16",attrs:{conditions:t.conditions}}):t._e()],2),e("r-button",{staticClass:"rr-mx-32 rr-mb-16",attrs:{size:"large"},on:{click:function(e){return t.$emit("clickContinueCheckout")}}},[t._v(" Return to Checkout ")])],2),e("div",[t.reviewed>1?e("share-section",{ref:"footer",attrs:{member:t.member}}):t.showFooter?e("rate-section",{ref:"footer",on:{click:function(e){return t.$emit("clickReview")}}}):t._e()],1)])};_i._withStripped=!0;var Ci=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-text-center rr-t-descriptor-s"},[e("div",{staticClass:"rr-text-secondary"},[t._v(" Refer & Earn "+t._s(t.bonusAmount)+" ")]),e("r-share-buttons",{attrs:{source:t.source,member:t.member}})],1)};Ci._withStripped=!0;const bi={components:{RShareButtons:pt},props:{member:{type:Object,required:!0}},data:()=>({bonusAmount:"",source:"Coupon Magic"}),created(){(0,f.r)("getTafSettings",{force:!0},(t=>{this.bonusAmount=t.referBonusAmount}))},mounted(){g.m.track("Visit Refer A Friend",{referral_token:this.member.shortURLToken,source:this.source}),(0,f.r)("holistic.track",{event:C.s.ReferAFriendViewed,data:{attribution_source:this.source}})}};const yi=(0,Y.A)(bi,Ci,[],!1,null,null,null).exports;var ki=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-center"},[e("div",{staticClass:"rr-text-center rr-text-action rr-t-link"},[t._v(" How do you like Rakuten? ")]),e("r-link",{staticClass:"rr-rate-button-stars rr-flex rr-mt-16 rr-justify-center",attrs:{"aria-label":t.ratingsText},on:{click:function(e){return t.$emit("click")}}},[e("star-icon"),e("star-icon"),e("star-icon"),e("star-icon"),e("star-icon")],1)],1)};ki._withStripped=!0;var xi=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 576 512"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M287.9 0c9.2 0 17.6 5.25 21.6 13.52l68.6 141.28 153.3 22.7c9 1.3 16.4 7.6 19.3 16.2 2.8 8.7.5 18.2-5.9 24.5L433.6 328.4l26.3 155.5c1.5 9-2.2 18.2-9.7 23.5-7.4 5.3-18.1 6-25.3 1.7l-137-73.2-137.8 73.2c-7.2 4.3-17 3.6-24.5-1.7-7.4-5.3-11.1-14.5-10.5-23.5l27.1-155.5L31.11 218.2c-6.46-6.3-8.75-15.8-5.91-24.5 2.83-8.6 10.3-14.9 19.29-16.2l153.21-22.7 68.6-141.28C270.4 5.249 278.7 0 287.9 0zm0 78.95L235.4 187.2c-3.5 7.1-10.3 12.1-18.1 13.3L98.98 217.9 184.9 303c5.5 5.5 8 13.4 6.7 21.1l-20.2 119.6 105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2-20.2-119.6c-1.3-7.7 1.3-15.6 6.8-21.1l85.9-85.1-118.3-17.4c-7.9-1.2-14.7-6.2-18.1-13.3L287.9 78.95z"}})])};xi._withStripped=!0;const Ai={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const wi=(0,Y.A)(Ai,xi,[],!1,null,null,null).exports,Si={components:{RLink:et.A,StarIcon:wi},computed:{ratingsText(){const t="Rate us on ";return P.A.browser.isSafari?`${t}Safari App Store`:P.A.browser.isFirefox?`${t}Firefox add-ons store`:P.A.browser.isWebkitEdge?`${t}Microsoft Edge extension add-ons store`:`${t}Chrome web store`}}};const Ti=(0,Y.A)(Si,ki,[],!1,null,null,null).exports;var $i=function(){var t=this;return(0,t._self._c)("span",{staticClass:"r-coupon-static rr-t-tag-small rr-text-action",attrs:{"aria-label":`Coupon code ${t.code}`}},[t._v(" "+t._s(t.code)+" ")])};$i._withStripped=!0;const Mi={props:{code:{type:String,default:""}}};const Li=(0,Y.A)(Mi,$i,[],!1,null,null,null).exports,Pi={components:{ShareSection:yi,REligibilityPopover:Nr,RateSection:Ti,RButton:X.A,ExclusionsPopover:Br,InfoIcon:Er.A,RCouponStatic:Li},props:{coupon:{type:Object,required:!0},state:{type:String,default:"success"},merchant:{type:Object,required:!0},conditions:{type:[Object,null],default:null},orderTotal:{type:Number,required:!0,default:0},currency:{type:String,default:"$"},totalSavings:{type:Number,required:!0,default:0},couponDiscount:{type:Number,default:0},reward:{type:Object,required:!0},cashbackAmount:{type:Number,default:0},displayConditions:{type:Boolean,default:!1},member:{type:Object,default:()=>({})},reviewed:{type:Number,required:!0},cashbackLimit:{type:Number,required:!0}},computed:{showFooter(){return"success"===this.state||this.reviewed>1},offersCashBack(){return!this.merchant.rewardsExpired&&this.merchant.offers_cb&&!this.merchant.suppressed},rewardAmount(){return"Percentage"===this.reward.display?this.tieredPrefix+this.reward.amount:""},tieredPrefix(){return this.reward?.range?"Up to ":""}},methods:{formatCashBack:tt.a}};const Ii=(0,Y.A)(Pi,_i,[function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-t-descriptor-m rr-text-secondary"},[t._v(" We worked our magic and you already"),e("br"),t._v("have the best deal we can find. ")])}],!1,null,null,null).exports;var Bi=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"rr-coupons-form-result-large"}},[e("div",{staticClass:"rr-flex",staticStyle:{"min-height":"344px"}},[e("div",{staticClass:"rr-flex rr-flex-1 rr-items-center rr-text-center rr-flex-col rr-justify-center rr-px-24"},[t.isSuccess?e("div",{staticClass:"rr-confetti"}):t._e(),e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-mb-24"},[e("r-heading-logo",{attrs:{variant:t.rakPlus?"plus":"solid"}})],1),t.isSuccess?[e("div",{staticClass:"rr-t-h1 rr-mb-24"},[t.totalSavings>t.cashbackLimit?[t._v(" We have a winner! ")]:t.couponHasDiscount?[t._v(" We have a winner!"),e("br"),t._v(" You're saving "),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t.formatMoney(t.coupon.discount)))])]:[t._v(" Success! You get a little something extra. ")]],2),t.\u0441aaWithActivation&&t.coupon.code?[e("div",{staticClass:"rr-t-descriptor-s rr-mb-4"},[t._v(" With "+t._s(t.coupon.code)+" ")]),t.couponHasDiscount?e("div",{staticClass:"rr-t-descriptor-s"},[e("span",{staticClass:"rr-text-action"},[t._v(t._s(t.formatMoney(t.coupon.total)))]),t._v("\xa0 "),e("span",{staticClass:"rr-line-through"},[t._v(t._s(t.formatMoney(t.coupon.total+t.coupon.discount)))])]):t._e()]:t.coupon.code?e("div",{staticClass:"rr-coupon-applied rr-mb-24",attrs:{"aria-label":`Coupon code ${t.coupon.code}`}},[e("span",{staticClass:"rr-flex rr-items-center rr-t-tag-small"},[e("check-icon",{attrs:{size:"15"}}),e("span",{staticClass:"rr-ml-4"},[t._v(" "+t._s(t.coupon.code)+" ")])],1)]):t._e(),t.couponHasDiscount?t._e():e("div",{staticClass:"rr-coupon-desc rr-t-body rr-text-secondary rr-px-16"},[t._v(" "+t._s(t.coupon.description)+" ")])]:"error"===t.state?[e("div",{staticClass:"rr-t-h2 rr-mb-16"},[t._v(" The coupons didn't work ")]),e("div",{staticClass:"rr-t-subheader-s"},[t._v(" But there's still Cash Back! ")])]:t._e()],2),e("div",{staticClass:"rr-flex rr-flex-1 rr-items-center rr-text-center rr-flex-col rr-justify-center rr-px-24"},[t.\u0441aaWithActivation?[e("div",{staticClass:"rr-my-16 rr-t-h3"},[t.isSuccess?e("span",[t._v("And you'll earn ")]):e("span",[t._v("You'll earn ")]),e("span",{staticClass:"rr-whitespace-nowrap"},[t._v(t._s(t.tieredPrefix))]),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t._f("format")(t.cashbackAmount,t.currency)))]),e("span",[t._v(" Cash Back ")]),t.couponHasDiscount?e("span",[t._v("on top of coupon savings!")]):e("span",[t._v("on today\u2019s purchase!")]),t.displayConditions?e("span",[t._v("*")]):t._e()]),t.couponHasDiscount?e("div",{staticClass:"rr-mb-16 rr-t-subnav rr-text-tertiary rr-fw-bold"},[t._v(" Potential stacked savings "),e("span",{staticClass:"rr-whitespace-nowrap"},[t._v(t._s(t.tieredPrefix))]),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t.stackedSavings))]),t._v("! ")]):t._e(),e("r-button",{staticClass:"rr-my-32",attrs:{block:"",size:"large"},on:{click:function(e){return t.$emit("clickContinueCheckout")}}},[t._v(" Return to checkout ")]),t.displayConditions?e("r-link",{staticClass:"rr-t-fine-print rr-fw-book rr-mt-16",on:{click:function(e){return t.$emit("exclusionsClick")}}},[e("span",[t._v("*Exclusions apply")])]):t._e()]:[e("div",{staticClass:"rr-t-h2 rr-mt-20 rr-mb-16"},[t.isSuccess&&t.couponHasDiscount?[t._v(" Maximize your savings ")]:t.isSuccess?[t._v(" Activate Cash Back to maximize your deal ")]:[t._v(" Activate Cash Back to earn "),e("span",{staticClass:"rr-whitespace-nowrap"},[t._v(t._s(t.tieredPrefix))]),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t._f("format")(t.cashbackAmount,t.currency)))]),t._v(" on today's purchase!"),t.displayConditions?e("span",[t._v("*")]):t._e()]],2),t.isSuccess?e("div",{staticClass:"rr-mb-16 rr-t-body rr-px-16"},[t.totalSavings>t.cashbackLimit?[t._v(" Stack Cash Back on top of coupons ")]:t.couponHasDiscount?[t._v(" Stack Cash Back on top of coupons to save an estimated "),e("span",{staticClass:"rr-whitespace-nowrap"},[t._v(t._s(t.tieredPrefix))]),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t.stackedSavings))]),t._v("!"),t.displayConditions?e("span",[t._v("*")]):t._e()]:[t._v(" Add Cash Back to earn an estimated "),e("span",{staticClass:"rr-whitespace-nowrap"},[t._v(t._s(t.tieredPrefix))]),e("span",{staticClass:"rr-text-action"},[t._v(t._s(t.stackedSavings))]),t._v("!"),t.displayConditions?e("span",[t._v("*")]):t._e()]],2):t._e(),e("r-button",{staticClass:"rr-mb-16",attrs:{block:"",size:"large"},on:{click:function(e){return t.$emit("clickActivate")}}},[t._v(" Activate "+t._s(t.formatCashBack(t.reward))+" Cash Back ")]),e("r-button",{staticClass:"rr-t-link",attrs:{variant:"tertiary",title:"Dismisses Rakuten Cash Back message"},on:{click:function(e){return t.$emit("clickContinueCheckout")}}},[t._v("Return to checkout")]),t.displayConditions?e("r-link",{staticClass:"rr-t-fine-print rr-fw-book rr-mt-16",on:{click:function(e){return t.$emit("exclusionsClick")}}},[e("span",[t._v("*Exclusions apply")])]):t._e()]],2)])])};Bi._withStripped=!0;var Ei=r(38761),Ri=r.n(Ei);const Ni={components:{RLink:et.A,RButton:X.A,CheckIcon:ct.A,RHeadingLogo:q.A},props:{coupon:{type:Object,required:!0},state:{type:String,default:"success"},merchant:{type:Object,required:!0},conditions:{type:[Object,null],default:null},orderTotal:{type:Number,required:!0,default:0},currency:{type:String,default:"$"},\u0441aaWithActivation:{type:Boolean,default:!1},totalSavings:{type:Number,required:!0,default:0},cashbackAmount:{type:Number,default:0},reward:{type:Object,required:!0},displayConditions:{type:Boolean,default:!1},cashbackLimit:{type:Number,required:!0}},computed:{isSuccess(){return"success"===this.state},couponHasCB(){return this.coupon?.discount>0},stackedSavings(){return this.formatMoney(this.cashbackAmount+this.coupon.discount)},tieredPrefix(){return this.reward.range?"up to ":""},couponHasDiscount(){return this.coupon?.discount>0},rakPlus(){return this.merchant.reward.rakplusTargeted}},methods:{formatCashBack:tt.a,formatMoney:t=>Ri().formatMoney(t)}};const Oi={components:{FormResultSmall:Ii,FormResultLarge:(0,Y.A)(Ni,Bi,[],!1,null,null,null).exports},inject:["configId"],props:{coupons:{type:Array,required:!0},merchant:{type:Object,required:!0},member:{type:Object,default:()=>({})},conditions:{type:[Object,null],default:null},orderTotal:{type:Number,required:!0,default:0},state:{type:String,required:!0},currency:{type:String,default:"$"},reviewed:{type:Number,required:!0},isTestDisplayed:{type:Boolean,default:!1},cashbackAmount:{type:Number,required:!0,default:0},coupon:{type:Object,required:!0},cashbackLimit:{type:Number,required:!0},\u0441aaWithActivation:{type:Boolean,default:!1}},computed:{entity_name(){return this.isTestDisplayed?"Coupon Magic Results with CB CTA":"Coupon Magic Results"},totalSavings(){return this.merchant.suppressed?this.couponDiscount:this.cashbackAmount+this.couponDiscount},couponDiscount(){return this.coupon?this.coupon.discount:0},reward(){return this.merchant.activated?this.merchant.shoppingTrip?.reward:this.merchant.reward},displayConditions(){return this.conditions&&!this.merchant.suppressed}},mounted(){this.cashbackAmount>this.cashbackLimit&&this.$emit("caaLog",{action:"Calculation Error",coupon_auto_apply_status:"Cashback exceeds the limit",store_name:this.merchant.storeName,store_id:this.merchant.storeId,id:this.configId,estimated_cash_back:cashback})},methods:{linkToStore(){const t=(0,B.V)(`/${this.merchant.siteUrl}`),e=(0,I.Gu)(t,{eeid:60814});(0,O.o)(e),this.$emit("track","Visit Page",{preceding_screen_name:this.entity_name,url:e})}}};const Hi={components:{"form-progress":fi,"form-result":(0,Y.A)(Oi,gi,[],!1,null,null,null).exports,RModalForm:gr.A},props:{state:{type:String,default:"processing"},coupons:{type:Array,default:()=>[]},appliedCoupons:{type:Array,default:null},progress:{type:Number,default:0},index:{type:Number,default:0},merchant:{type:Object,default:()=>({})},conditions:{type:Object,default:null},member:{type:Object,default:()=>({})},orderTotal:{type:Number,required:!0,default:0},reviewed:{type:Number,required:!0},currency:{type:String,default:"$"},\u0441aaWithActivation:{type:Boolean,default:!1},subTotal:{type:Number,required:!0},coupon:{type:Object,default:null},cashbackAmount:{type:Number,required:!0},timeout:{type:Number,required:!0}},data:()=>({cashbackLimit:1e3}),computed:{focusTrapEnabled(){return"processing"!==this.state},isTestDisplayed(){return this.\u0441aaWithActivation&&"success"===this.state&&this.cashbackAmount<=this.cashbackLimit}}};const Di=(0,Y.A)(Hi,pi,[],!1,null,null,null).exports,Vi="Coupon Application Progress Screen",Fi=Kt.A.extend({components:{CouponsFormContent:Di},provide(){return{configId:this.config?.id}},props:{config:{type:Object,required:!0},coupons:{type:Array,required:!0},acsCoupons:{type:Array,required:!0},merchant:{type:Object,required:!0},\u0441aaWithActivation:{type:Boolean,default:!1},precedingScreenName:{type:String,default:null},index:{type:Number,default:0},timeout:{type:Number,default:1e3},state:{type:String,default:Kr.Processing},applyerObject:{type:Object,default:()=>({})}},data:()=>({entity_name:Vi,module_type:"Coupon Magic",appliedCoupons:[],reviewed:0,progress:0,orderTotal:0,conditions:null,exclusionsPopover:null,currency:"",member:null}),computed:{couponDiscount(){return this.coupon?this.coupon.discount:0},subTotal(){return this.coupon?this.coupon.orderTotal:this.orderTotal},total(){const t=this.config.controls?.total,e=t&&(0,Tr.z7)((0,Tr.fE)(t));return this.coupon?.total&&e?Math.min(this.coupon.total,e):e},coupon(){return this.appliedCoupons.length?(0,s.max)(this.appliedCoupons,(t=>t.discount)):void 0},oc_coupons(){return this.coupons.filter((t=>"OC"===t.source))},cashbackAmount(){let t=0;return this.subTotal&&(t=(0,$r.j)(this.merchant.reward,this.total?Math.min(this.subTotal,this.total):this.subTotal)),t}},watch:{reviewed(t){P.A.extension.setItem("CAA-reviewed",t)},state(t){[Kr.Success,Kr.Error].includes(t)&&this.renderResults(this.applyerObject)}},async created(){return this.progress||this.state!==Kr.Processing||(this.\u0441aaWithActivation&&(this.entity_name=`${Vi} with CB Confirmation`),this.track("View Module",{preceding_screen_name:this.precedingScreenName})),this.$el},methods:{track(t,e={}){let r={};if(l.o.get("caaAdaptiveSources")){const i=e.preceding_screen_name===Vi,o="View Module"===t&&!i||"close"===e.cta_type&&this.state===Kr.Processing;if(i){const t=this.coupon?.code?.toUpperCase();r={offer_source:t?this.coupons.find((e=>e.code.toUpperCase()===t))?.source:"",oc_coupons_tried:(0,s.pluck)(this.oc_coupons,"code").join(", "),acs_coupons_tried:(0,s.pluck)(this.coupons.filter((t=>"ACS"===t.source)),"code").join(", "),coupons_number:this.coupons.length}}else o&&(r={oc_coupons:this.oc_coupons.length,acs_coupons:this.acsCoupons.length,coupons_number:this.coupons.length})}g.m.track(t,{module_type:this.module_type,entity_name:this.entity_name,store_id:this.merchant.storeId,store_name:this.merchant.storeName,tracking_ticket:this.merchant.shoppingTrip.ttn,...r,...e})},clickClose(){switch(this.track("Click Module",{cta_type:"close"}),this.state){case Kr.Processing:this.cancel();break;case Kr.Success:this.apply();break;default:this.close()}},close(){this.$emit("done"),this.exclusionsPopover&&this.exclusionsPopover.remove(),this.$emit("close")},apply(){this.$emit("apply",[this.coupon]),this.close()},cancel(){l.o.get("caaApplyOnClose")||this.\u0441aaWithActivation||this.close(),this.track("Click Module",{cta_type:"close"}),this.$emit("cancel")},clickReview(){P.A.extension.setItem("CAA-reviewed",2),this.track("Click Module",{cta_type:"Rate App"}),P.A.browser.isChrome?P.A.browser.navigate(`${H.A.WEBSTORE_CHROME}?utm_source=caa`):P.A.browser.isFirefox?P.A.browser.navigate(H.A.WEBSTORE_FIREFOX):P.A.browser.isSafariApp?P.A.browser.navigate(H.A.WEBSTORE_SAFARI):P.A.browser.isWebkitEdge&&P.A.browser.navigate(`${H.A.WEBSTORE_EDGE}?cid=CAA#ratings-reviews`),this.apply()},async renderResults(t){this.$emit("done",{orderTotal:t.orderTotal}),this.orderTotal=t.orderTotal,this.currency=t.currency,this.appliedCoupons=(0,s.filter)(t.coupons,(t=>t.success)),this.appliedCoupons.forEach((t=>{this.coupons.find((({code:e,description:r})=>{e===t.code&&(t.description=r)}))})),this.entity_name="Coupon Magic Results";const[e,r,i]=await Promise.all([P.A.extension.getItem("CAA-reviewed"),(0,f.r)("account"),(0,f.r)("getStoreContent",this.merchant)]);this.member=r,this.reviewed=e||(P.A.browser.isLegacySafari?2:0),this.conditions=i?.conditions;const o=this.subTotal.toFixed(2),a=this.couponDiscount.toFixed(2),n=this.applyerObject.coupons.filter((t=>!!t.success&&t.code)).map((t=>t.code)),c=this.applyerObject.coupons.filter((t=>!t.success&&t.code)).map((t=>t.code)),l=this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.reward;this.state===Kr.Success?this.$emit("caaLog",{action:Kr.Success,coupon_auto_apply_status:"Coupon Success",successfully_applied_coupon:this.coupon.code,success_list:n,failure_list:c,amount_saved:a,subtotal:o,estimated_cash_back:this.cashbackAmount,...(0,E.D)(l)}):this.state===Kr.Error&&this.$emit("caaLog",{action:Kr.Error,coupon_auto_apply_status:"No Working Coupons",subtotal:o,estimated_cash_back:this.cashbackAmount,...(0,E.D)(l)});const d=this.getResultType();this.track("View Module",{preceding_screen_name:Vi,type:d,amount_saved:Math.round(this.couponDiscount),amount_total:o,offer_success:this.state===Kr.Success,offer_id:this.coupon?.code})},getResultType(){return this.state===Kr.Success?this.couponDiscount>0?"Coupon Applied Successfully":"Coupon Applied Successfully No Savings":this.merchant.offers_cb&&!this.merchant.suppressed?"Coupons not Applied with CB":"Coupons not Applied no CB"},clickContinueCheckout(){this.track("Click Module",{cta_type:"Continue Shopping"}),this.state===Kr.Error?this.close():this.apply()},clickActivate(){this.track("Click Module",{cta_type:"Start Shopping Trip"}),this.merchant.loggedIn?this.activate():this.login(),this.state===Kr.Error?this.close():this.apply()},activate(){const t=this.\u0441aaWithActivation?D.rx:"Coupon Magic Results Screen";(0,bt.Y)(this.merchant.storeId,{store_url:document.location.href,forceBackgroundActivation:!0,sessionAttributes:{source:t,coupon:this.coupon}})},login(){(0,f.r)("login",{merchant:this.merchant,type:this.module_type,source:this.\u0441aaWithActivation?D.rx:"Coupon Magic Results Screen"}),this.close()}}});const Wi=(0,Y.A)(Fi,hi,[],!1,null,null,null).exports,zi="eb-caa-cache";const ji=a().extend({name:"CouponsMagicView",components:{CouponsButtonView:ui,CouponsFormView:Wi},data:()=>({moduleTimeout:null,allow\u0421aaWithActivation:!1,caaHoverVisible:!1,caaFormVisible:!1,coupons:null,config:null,preceding_screen_name:"",stepDuration:1e3,index:0,currentProgress:0,applyerObject:{},acs_coupons:[],\u0441aaWithActivation:!1,caaWithoutActivation:!1,configs:null,module:null,hasAppliedCouponEvent:!1,state:Kr.Processing,ca:null}),computed:{...(0,n.aH)(["merchant","settings","components"]),visible(){return this.config&&this.coupons?.length&&(!this.merchant.suppressed||l.o.get("caaSuppressed"))&&null===this.components.orderConfirmation&&(!this.components.notification||this.merchant.rab)||this.caaWithoutActivation}},async created(){this.$store.dispatch("updateComponents",{couponMagic:!0});const t=sessionStorage.getItem(zi),e=t?JSON.parse(t):null;if(e&&this.validateCache(e)){await this.getConfig({storeId:e.merchant.storeId})&&(this.currentProgress=e.progress,this.initState(e),this.createForm(),this.createModule())}else try{this.isCartCheckoutPage()||this.hideFeatureUI(),await this.check(this.merchant,this.settings)}catch(t){this.hideFeatureUI()}window.addEventListener("addressbar.urlchange",(()=>{setTimeout((async()=>{this.configs=null,await this.getConfig({storeId:this.merchant.storeId});try{await this.check(this.merchant,this.settings)}catch(t){}}),1e3)}))},methods:{hideFeatureUI(){return this.$store.dispatch("updateComponents",{couponMagic:null})},async getConfig({storeId:t}){const e=location.href;return this.configs||=await(0,f.r)("coupons.getConfigs",{url:e,storeId:t})??[]},async isCartCheckoutPage(){const t=(await this.getConfig({storeId:this.merchant.storeId})).find((t=>t.cart||t.checkout)),e=new RegExp(t?.url);return t?.url&&e.test(location.href)},async check(t,e){const r=await this.getConfig(this.merchant),i=function(t,e){const r=qi(e),i=Ui(e),s=e.settings_caa&&!!t.checkoutNotifications.caa,o=e.activated||!e.offers_cb||l.o.get("superCAA")&&!e.activated&&e.offers_cb&&e.loggedIn||e.suppressed;return s&&o||r||i}(e,t);if(!i)throw new Error("Not eligible to display");if(this.coupons=this.coupons??await(0,f.r)("getCouponOffers",{storeId:t.storeId}),this.acs_coupons=this.coupons.filter((({source:t})=>"ACS"===t)),!this.coupons.length)throw new Error("No coupons");try{const e=r.find((t=>t.cart||t.checkout));if(e){const r=(s=e,s.controls?.orderTotal??s.controls?.total);if(r){await(0,Jr.fm)(r,2e3);const e=(0,Jr._D)({selector:r}),i=(0,Mt.t)(e);if(t.orderTotal&&t.orderTotal===i)throw new Error("Cart total is the same")}}}catch{}var s;const o=await this.isCartCheckoutPage(),a=this.isTestDomain();if(!t.suppressed||l.o.get("caaSuppressed")){const e=qi(t),r="A"===await c.r.get("BTN220"),i=function({merchant:t,isTestDomainNoExperiment:e,isCartPage:r,allow\u0421aaWithActivation:i,isUserBeingTested:s}){return t.activated||t.instantStartCAA||t.suppressed&&t.offers_cb||!t.offers_cb&&!t.suppressed&&!e&&r||i||r&&s}({merchant:t,isTestDomainNoExperiment:a&&!r,isCartPage:o,allow\u0421aaWithActivation:e,isUserBeingTested:r});if(i)return r&&a&&!this.merchant.instantStartCAA&&await c.r.activate("BTN220",{storeId:t.storeId}),this.initState({coupons:this.coupons,merchant:t,allow\u0421aaWithActivation:e,acs_coupons:this.acs_coupons}),this.createModule(),void this.clearCache()}if(await this.showHoverWithoutApply(t,o))return;const n="X"===await c.r.get("BTN220");throw a&&o&&n&&await c.r.activate("BTN220",{storeId:t.storeId}),new Error("Not eligible to display")},async showHoverWithoutApply(t,e){if(!await(0,f.r)("coupons.hasConfigs",{storeId:this.merchant.storeId}))return!1;return!(!Ui(t)||!t.notificationCaa||e||"A"!==await c.r.activate("BTN220",{storeId:t.storeId}))&&(this.caaWithoutActivation=!0,this.createButton(),!0)},isTestDomain(){return l.o.get("caaWithoutActivation",{includedDomains:[]}).includedDomains.includes(this.merchant.domainName)},clearCache(){sessionStorage.removeItem(zi)},validateCache:({coupons:t,config:e,merchant:r,timestamp:i}={})=>t?.length&&r&&e&&Date.now()-(i??0)<15e3,initState(t){const{coupons:e,merchant:r,config:i,allow\u0421aaWithActivation:s,acs_coupons:o,\u0441aaWithActivation:a}=t;this.coupons=e,this.config=i||this.config,this.acs_coupons=o,this.merchant=r,this.allow\u0421aaWithActivation=s,this.\u0441aaWithActivation=a},async createModule(){const t=async t=>{if(this.moduleTimeout&&clearTimeout(this.moduleTimeout),!t)return void this.hideFeatureUI();this.ca=t,this.config=t.config;let e=this.coupons;if(e.some((t=>t.source?.includes("ACS")))){const t=l.o.get("acsOnPlatformAllowed",[]),r=t?.storeIds?.includes(this.merchant.storeId);if(r){if(!await c.r.activate("acs-for-on-platform-extension",{storeId:this.merchant.storeId,placement:"Coupon Magic"})&&(e=e.filter((t=>"ACS"!==t.source)),this.coupons=e,this.ca.coupons=e,this.acs_coupons=[],0===this.coupons.length))return void this.hideFeatureUI()}}if(this.merchant.instantCAAStarted||!this.merchant.shoppingTrip.instantStartCAA&&!this.merchant.instantStartCAA)this.createButton();else{const t=Ui(this.merchant);if(this.merchant.shoppingTrip.couponsAvailable||t){const t=l.o.get("caaAdaptiveSources");g.m.track(g.m.VIEW_MODULE,{module_type:"Coupon Magic",entity_name:(this.merchant.instantStartCAA?"No Activation ":"")+"Auto-start Coupon Magic",store_id:this.merchant.storeId,store_name:this.merchant.storeName,coupons_number:e.length,tracking_ticket:this.merchant.shoppingTrip.ttn,...t&&{oc_coupons:e.filter((t=>"OC"===t.source)).length,acs_coupons:this.acs_coupons.length,coupons_number:e.length}})}this.apply(),this.merchant.instantCAAStarted=!0,(0,b.a)(this.merchant.storeId,{instantCAAStarted:!0})}this.clearCache()};if(this.module)return void(this.ca?(await this.module.initialize(JSON.parse(JSON.stringify(this.configs))),this.config&&!this.module.config&&(this.formClose(),this.ca=null)):(t(this.ca),!this.ca&&this.configs&&this.module.initialize(JSON.parse(JSON.stringify(this.configs)))));await async function(){return/comp|inter|loaded/.test(document.readyState)?Promise.resolve():new Promise((t=>document.addEventListener("DOMContentLoaded",t)))}();const e={init:t,hasAppliedCoupon:()=>this.hasAppliedCoupon(),noCoupons:()=>{},progress:(t,e)=>{"apply"===e&&this.progress(t)},success:t=>this.showResults(t),stop:(t,e)=>{this.close(),e&&this.createButton()}};this.moduleTimeout=setTimeout((()=>{this.hideFeatureUI()}),3e3),this.module=new Qr.A(Object.assign(e,{id:"rr-caa",coupons:this.coupons,rules:this.configs,resetOnStop:!this.settings?.featureFlags?.caaApplyOnClose})),this.module.on("log",console.log)},saveCache(t){const e=sessionStorage.getItem(zi)??"";let r={};try{r=JSON.parse(e)||{}}catch(t){}sessionStorage.setItem(zi,JSON.stringify({...r,...t,merchant:this.merchant,coupons:this.coupons,config:this.config,index:this.index,\u0441aaWithActivation:this.\u0441aaWithActivation,timestamp:Date.now()}))},async createForm(){this.caaFormVisible=!0},updateProgress(t){this.saveCache({progress:t})},formDone({orderTotal:t=0}={}){this.clearCache(),(0,b.a)(this.merchant.storeId,{caaProgress:!1,...t&&{orderTotal:t},instantStartCAA:!1}),this.merchant.isCaaWithoutActivation&&this.$store.dispatch("updateMerchant",{notificationCaa:!1})},caaLog(t){!function(t){const{action:e,...r}=t;r.url=location.origin+location.pathname;const i={action:e,event:r};(0,f.r)("log.caa",i)}({...t,store_name:this.merchant.storeName,store_id:this.merchant.storeId,id:this.config?.id,available_coupons:(0,s.pluck)(this.coupons,"code").join(", "),available_coupons_by_source:this.coupons.reduce(((t,e)=>("ACS"===e.source?t.acs.push(e.code):"OC"===e.source&&t.ocs.push(e.code),t)),{ocs:[],acs:[]})})},waitModule(){return this.module?Promise.resolve():new Promise((t=>{const e=window.setInterval((()=>{this.module&&(window.clearInterval(e),t())}),10)}))},async formCancel(){this.caaLog({action:"cancel",coupon_auto_apply_status:"Terminated"}),await this.waitModule(),this.module.stop()},async formApply(t){await this.waitModule(),this.module.finishing(t)},async formClose(){this.caaHoverVisible=!1,this.caaFormVisible=!1,this.$store.dispatch("updateComponents",{couponMagic:!1}),this.merchant.isCaaWithoutActivation&&this.$store.dispatch("updateMerchant",{notificationCaa:!1}),this.allow\u0421aaWithActivation&&this.$store.dispatch("updateMerchant",{notificationHover:!1})},async createButton(){this.clearCache(),this.\u0441aaWithActivation=this.allow\u0421aaWithActivation,this.caaHoverVisible=!0},hasAppliedCoupon(){this.moduleTimeout&&clearTimeout(this.moduleTimeout),this.hideFeatureUI(),this.hasAppliedCouponEvent||(this.hasAppliedCouponEvent=!0,this.caaLog({action:"Coupon already applied",coupon_auto_apply_status:"Coupon already applied"}))},close(){this.$store.dispatch("updateComponents",{couponMagic:!1}),this.caaFormVisible=!1},async apply({preceding_screen_name:t}={}){this.preceding_screen_name=t??"",this.createForm(),this.saveCache(),this.module.start(),this.caaLog({action:"start",coupon_auto_apply_status:"Apply Coupon"}),this.activateMerchant()},progress({stepDuration:t=1e3,index:e}){this.caaFormVisible&&(this.stepDuration=t,this.index=e,this.saveCache(),(0,b.a)(this.merchant.storeId,{caaProgress:!0}))},showResults(t){const e=t.coupons.filter((t=>t.success));this.state=e.length?Kr.Success:Kr.Error,this.applyerObject=t},activateMerchant({ctaActivateCBOnly:t}={}){if((!this.merchant.offers_cb||this.allow\u0421aaWithActivation)&&!this.merchant.activated){let e="CAA";t?(e=D.rx,this.formClose()):e=this.caaWithoutActivation?D.vy:D.OQ,(0,bt.Y)(this.merchant.storeId,{store_url:document.location.href,forceBackgroundActivation:!0,sessionAttributes:{source:e}})}}}});function qi(t){return l.o.get("caaWithActivation")&&t.settings_caa&&t.loggedIn&&!t.activated&&t.offers_cb&&t.affiliatizerEnabled&&(!t.notificationHover||t.rab)}function Ui(t){return t.isCaaWithoutActivation&&!t.offers_cb}const Yi=ji;const Zi=(0,Y.A)(Yi,Xr,[],!1,null,null,null).exports;var Gi=function(){var t=this,e=t._self._c;return e("div",{attrs:{"aria-label":"Rakuten Action Button"}},[t.educationPopperVisible?e("education-popover",{attrs:{type:t.merchant.activated?"RAB":"RABinactive",anchor:t.$refs.anchor.$el,content:t.educationPopoverContent},on:{clickClose:function(e){t.educationPopperVisible=!1}}}):t._e(),e("transition",{attrs:{name:"rab-slide"}},[t.loading||"quick-view"!==t.state?t._e():e("rab-quick-view",{key:"rab-quick-view",attrs:{merchant:t.merchant,product:t.product,couponsCount:t.couponsCount,cashbackAmount:t.cashbackAmount},on:{hideQuickView:function(e){t.state="rab"},timeoutSnooze:t.timeoutSnooze,sessionSnooze:t.sessionSnooze,hideRABUntil:t.hideRABUntil,hideRABForMerchant:t.hideRABForMerchant,openSettingsPage:t.openSettingsPage,toggleTiers:t.toggleTiers,toggleExclusions:t.toggleExclusions,track:t.track,activate:t.activate}})],1),e("transition",{attrs:{name:"rab-fade"}},[t.loading||"rab"===t.state?e("action-button-form",{ref:"anchor",attrs:{loading:t.loading,merchant:t.merchant,product:null!==t.coupons&&!t.oneClickActivation&&t.product?t.product:void 0,label:t.label},on:{onClick:t.onRabClick,onMouseEnter:t.onButtonMouseEnter,track:t.track}}):t._e()],1),"notification"===t.state?e("r-notification-card",{attrs:{title:"We'll always hide on this site",body:"You can update this anytime in Extension Settings. We'll still remind you to activate Cash Back when you first visit this site.",actions:[{title:"Undo",onClick:t.onUndoClick},{title:"See all settings",onClick:t.openSettingsPage}],icon:t.CheckIcon,customStatusColor:"var(--colors-text-cashback)"},on:{close:t.notificationClose}}):t._e()],1)};Gi._withStripped=!0;var Xi=function(){var t=this,e=t._self._c;return e("r-form",{staticClass:"rr-action",attrs:{"data-tid":"action-button",width:"auto",backgroundColor:t.setBgColor,flat:!0,position:t.position},nativeOn:{mouseenter:function(e){return t.onMouseEnter.apply(null,arguments)},mouseleave:function(e){return t.onMouseLeave.apply(null,arguments)},focusin:function(e){return t.onMouseEnter.apply(null,arguments)},focusout:function(e){return t.onMouseLeave.apply(null,arguments)},mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.onMouseDown.apply(null,arguments)},mouseup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.onMouseUp.apply(null,arguments)}}},[t.loading?e("div",{staticClass:"rr-action__loading"}):t._e(),e("div",{staticClass:"rr-flex rr-flex-row rr-justify-center rr-items-center rr-pa-8"},[e("r-logo",{staticClass:"rr-pa-8",attrs:{variant:t.rakPlus?"icon-plus-white":"icon-white",size:"small",alt:""}}),e("div",{staticClass:"rr-action__text-container rr-flex rr-items-center",class:{"rr-action__text-container--transition":t.transition,"rr-action__text-container--transition-slow":t.transitionSlow},style:{width:`${t.textContainerWidth}px`}},[e("transition",{attrs:{name:"rab-fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.expanded&&!t.loading,expression:"expanded && !loading"}],ref:"text",staticClass:"rr-text-inverse rr-select-none rr-pr-8",class:{"rr-action__text rr-t-button-l rr-whitespace-nowrap":!t.product,"rr-action__text-small":t.product}},[t._v(" "+t._s(t.label)+" ")])])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}]},[e("div",{staticClass:"rr-action__corner-status rr-shadow-default"},[t.active?e("lottie",{attrs:{options:t.animationOptions,height:20,width:20},on:{animationCreated:t.animationCreated}}):e("div",{staticClass:"rr-action__corner-status__inactive"})],1),e("div",{staticClass:"dot",staticStyle:{bottom:"12px",right:"6px"}}),e("div",{staticClass:"dot",staticStyle:{bottom:"6px",right:"6px"}}),e("div",{staticClass:"dot",staticStyle:{bottom:"6px",right:"12px"}})])],1)])};Xi._withStripped=!0;var Qi=function(){return(0,this._self._c)("div",{ref:"lavContainer",style:this.style})};Qi._withStripped=!0;var Ki=r(4062),Ji=r.n(Ki);const ts={props:{options:{type:Object,required:!0},height:{type:Number,default:0},width:{type:Number,default:0}},data(){return{animation:null,style:{width:this.width?`${this.width}px`:"100%",height:this.height?`${this.height}px`:"100%",overflow:"hidden",margin:"0 auto"}}},mounted(){const t=Ji().loadAnimation({container:this.$refs.lavContainer,renderer:"svg",loop:!1!==this.options.loop,autoplay:!1!==this.options.autoplay,animationData:this.options.animationData,rendererSettings:this.options.rendererSettings});this.$emit("animationCreated",t)}};const es=(0,Y.A)(ts,Qi,[],!1,null,null,null).exports,rs=JSON.parse('{"ddd":0,"h":200,"w":200,"meta":{"g":"LottieFiles Figma v44"},"layers":[{"ty":3,"sr":1,"st":0,"op":55,"ip":0,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[5.25,3.82]},"s":{"a":0,"k":[1000,1000]},"p":{"a":0,"k":[100,100]}},"ind":1},{"ty":4,"sr":1,"st":0,"op":55.3,"ip":0,"ddd":0,"bm":0,"hasMask":false,"td":1,"ao":0,"ks":{"a":{"a":0,"k":[5.25,3.82]},"p":{"a":0,"k":[5.25,3.82]}},"ef":[],"shapes":[{"ty":"sh","bm":0,"d":1,"ks":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[10.5,0.96],[3.82,7.64],[0,3.82],[0.96,2.86],[3.82,5.72],[9.54,0],[10.5,0.96]]}],"t":32.4},{"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[10.5,0.96],[3.82,7.64],[0,3.82],[0.96,2.86],[3.82,5.72],[9.54,0],[10.5,0.96]]}],"t":54.3}]}},{"ty":"fl","bm":0,"c":{"a":0,"k":[0.91,0.05,0.36]},"r":2,"o":{"a":0,"k":100}}],"ind":2,"parent":1},{"ty":4,"sr":1,"st":0,"op":55.3,"ip":0,"ddd":0,"bm":0,"tt":1,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[2.7,0.68]},"p":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[-1.5,1.22],"t":32.4},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[2.39,5.25],"t":39.87}]},"r":{"a":0,"k":45},"o":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[0],"t":32.4},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[100],"t":39.87}]}},"ef":[],"shapes":[{"ty":"sh","bm":0,"d":1,"ks":{"a":1,"k":[{"o":{"x":0,"y":0},"i":{"x":0.58,"y":1},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[0,0],[4.35,0],[4.35,2],[0,2]]}],"t":2.4},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[0,0],[5.4,0],[5.4,1.36],[0,1.36]]}],"t":39.87}]}},{"ty":"fl","bm":0,"c":{"a":0,"k":[1,1,1]},"r":1,"o":{"a":0,"k":100}}],"ind":3,"parent":1},{"ty":4,"sr":1,"st":0,"op":55.3,"ip":0,"ddd":0,"bm":0,"hasMask":false,"td":1,"ao":0,"ks":{"a":{"a":0,"k":[5.25,3.82]},"p":{"a":0,"k":[5.25,3.82]}},"ef":[],"shapes":[{"ty":"sh","bm":0,"d":1,"ks":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[10.5,0.96],[3.82,7.64],[0,3.82],[0.96,2.86],[3.82,5.72],[9.54,0],[10.5,0.96]]}],"t":42.27}]}},{"ty":"fl","bm":0,"c":{"a":0,"k":[0.91,0.05,0.36]},"r":2,"o":{"a":0,"k":100}}],"ind":4,"parent":1},{"ty":4,"sr":1,"st":0,"op":55.3,"ip":0,"ddd":0,"bm":0,"tt":1,"hasMask":false,"ao":0,"ks":{"a":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[4.5,1.15],"t":42.27},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[4.73,0.68],"t":51.27}]},"p":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[-0.75,10.97],"t":42.27},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[6.68,3.82],"t":51.27}]},"r":{"a":0,"k":-45},"o":{"a":0,"k":100}},"ef":[],"shapes":[{"ty":"sh","bm":0,"d":1,"ks":{"a":1,"k":[{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[0,0],[9,0],[9,2.31],[0,2.31]]}],"t":42.27},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[0,0],[9.45,0],[9.45,1.36],[0,1.36]]}],"t":54.27}]}},{"ty":"fl","bm":0,"c":{"a":0,"k":[1,1,1]},"r":1,"o":{"a":0,"k":100}}],"ind":5,"parent":1},{"nm":"Fill","ty":4,"sr":1,"st":0,"op":55,"ip":0,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":1,"k":[{"o":{"x":0,"y":0},"i":{"x":0.58,"y":1},"s":[1,1],"t":2},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[8,8],"t":32}]},"s":{"a":0,"k":[1000,1000]},"p":{"a":0,"k":[100,100]},"o":{"a":1,"k":[{"o":{"x":0,"y":0},"i":{"x":0.58,"y":1},"s":[0],"t":2},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[100],"t":32}]}},"ef":[],"shapes":[{"ty":"sh","bm":0,"d":1,"ks":{"a":1,"k":[{"o":{"x":0,"y":0},"i":{"x":0.58,"y":1},"s":[{"c":true,"i":[[-0.55,0],[0,-0.55],[0.55,0],[0,0.55]],"o":[[0.55,0],[0,0.55],[-0.55,0],[0,-0.55]],"v":[[1,0],[2,1],[1,2],[0,1]]}],"t":2},{"o":{"x":0.17,"y":0.17},"i":{"x":0.83,"y":0.83},"s":[{"c":true,"i":[[-4.42,0],[0,-4.42],[4.42,0],[0,4.42]],"o":[[4.42,0],[0,4.42],[-4.42,0],[0,-4.42]],"v":[[8,0],[16,8],[8,16],[0,8]]}],"t":32}]}},{"ty":"fl","nm":"Fill","bm":0,"c":{"a":0,"k":[0.24,0.78,0.39]},"r":1,"o":{"a":0,"k":100}}],"ind":6}],"v":"5.7.0","fr":30,"op":54.3,"ip":0,"assets":[]}');var is=r.t(rs,2);const ss={components:{RForm:F.A,RLogo:pr.A,Lottie:es},props:{merchant:{type:Object,required:!0},label:{type:String,default:""},product:{type:Object,default:null},loading:{type:Boolean,default:!1}},data:()=>({show:!1,expanded:!1,dragging:!1,top:128,right:10,startedPageY:0,dy:0,startedContentTop:0,moved:!1,textContainerWidth:0,transition:!0,transitionSlow:!1,checkIconAnimation:null,animationOptions:{loop:!1,autoplay:!1,animationData:is}}),computed:{active(){return this.merchant?.activated},position(){return{top:`${this.top}px`,right:`${this.right}px`}},entityName(){return this.product?`Savings found ${this.activeState} PDP`:`${this.activeState} RAB`},activeState(){return this.merchant.activated?"Active":"Inactive"},maxYOffset(){return window.innerHeight-this.$el.offsetHeight},reward(){return this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.rewardsExpired?null:this.merchant.reward},rakPlus(){return this.merchant.reward.rakplusTargeted},setBgColor(){return this.rakPlus?"#936816":"#8529CD"}},watch:{product(){this.product&&(this.transition=!0,this.$emit("track","View Module",{entity_name:this.entityName}),this.animateText())},merchant(){this.checkActivatedToDisplayPill()},loading(){this.checkActivatedToDisplayPill()}},mounted(){this.checkActivatedToDisplayPill(),this.product&&this.showText(),this.show=!0,this.trackViewModule();const t=localStorage.getItem("rr-rab-position-top");t?this.top=Math.min(parseInt(t,10),this.maxYOffset):localStorage.setItem("rr-rab-position-top",`${this.top}px`),document.addEventListener("mouseup",this.documentMouseUp),document.addEventListener("mousemove",this.documentMouseMove),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{animationCreated(t){this.checkIconAnimation=t,this.merchant.activated&&this.merchant.rabActivated&&this.checkIconAnimation.goToAndStop(this.checkIconAnimation.getDuration(!0),!0)},trackViewModule(){this.$emit("track","View Module",{entity_name:this.entityName,store_id:this.merchant.storeId,store_name:this.merchant.storeName,store_domain:this.merchant.domainName,source_of_activation:this.merchant.shoppingTrip.source,...(0,E.D)(this.reward)})},async checkActivatedToDisplayPill(){!this.merchant.activated||this.merchant.rabActivated||this.loading||(this.trackViewModule(),this.$store.dispatch("updateMerchant",{rabActivated:!0}),this.checkIconAnimation.play(),await this.animateText())},onMouseDown(t){t.preventDefault(),this.dragging=!0,this.moved=!1,this.startedPageY=t.pageY,this.startedContentTop=this.$el.offsetTop},onMouseUp(){this.dragging=!1,this.moved?this.trackMoveEvent():(this.$emit("onClick"),this.hideText())},documentMouseUp(){this.dragging&&this.$el&&(this.dragging=!1,this.trackMoveEvent())},documentMouseMove(t){if(this.dragging&&(t.preventDefault(),this.dy=t.pageY-this.startedPageY,Math.abs(this.dy)>8)){const t=this.startedContentTop+this.dy;this.top=Math.min(Math.max(t,0),this.maxYOffset),this.top+this.$el.offsetHeight>window.innerHeight&&(this.dragging=!1),localStorage.setItem("rr-rab-position-top",`${this.top}px`),this.moved=!0}},onMouseEnter(){this.right=10,this.$emit("onMouseEnter"),this.showText()},onMouseLeave(){this.product||this.hideText()},async setTextContainerWidth(){const t=this.$refs.text;await this.$nextTick(),this.textContainerWidth=t?.clientWidth??0},showText(){this.expanded=!0,this.setTextContainerWidth()},hideText(){this.expanded=!1,this.textContainerWidth=0},handleResize(){const t=this.$el.offsetHeight;this.top+t>window.innerHeight?this.top=window.innerHeight-t-10:this.top<0&&(this.top=10),localStorage.setItem("rr-rab-position-top",`${this.top}px`)},async animateText(){this.showText(),await(0,Qt.cb)(4e3),this.product||(this.transitionSlow=!0,this.hideText(),await(0,Qt.cb)(1e3)),this.transitionSlow=!1,this.transition=!0},trackMoveEvent(){this.$emit("track","View Module",{entity_name:"Moved RAB",original_position:this.startedContentTop,new_position:this.top})}}};const os=(0,Y.A)(ss,Xi,[],!1,null,null,null).exports;var as=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("rab-quick-view-form",{attrs:{merchant:t.merchant,product:t.product,couponsCount:t.couponsCount,cashbackAmount:t.cashbackAmount,tiers:t.tiers,storeContent:t.storeContent,boost:t.isBoostExperiment?t.boost:void 0},on:{close:function(e){return t.$emit("hideQuickView")},timeoutSnooze:function(e){return t.$emit("timeoutSnooze")},sessionSnooze:function(e){return t.$emit("sessionSnooze")},hideRABUntil:function(e){return t.$emit("hideRABUntil")},hideRABForMerchant:function(e){return t.$emit("hideRABForMerchant")},openSettingsPage:function(e){return t.$emit("openSettingsPage")},toggleTiers:function(e){return t.$emit("toggleTiers")},toggleExclusions:function(e){return t.$emit("toggleExclusions")},track:(e,r)=>t.$emit("track",e,r),activate:function(e){return t.$emit("activate")}}})};as._withStripped=!0;var ns=r(92197),cs=function(){var t=this,e=t._self._c;return e("r-form",{staticClass:"rab-quick-view rr-rounded-ui rr-overflow-hidden",attrs:{"data-tid":"rab-quick-view",width:"340",headerLogo:"left",flat:!0,position:t.position}},[e("div",{staticClass:"rab-quick-view__header rr-flex rr-justify-between",on:{click:t.formClick,mousedown:t.onMouseDown,mouseup:t.onMouseUp}},[e("r-heading-logo",{staticClass:"rr-ml-24 rr-flex rr-items-center",attrs:{variant:t.rakPlus?"plus-white":"white",size:"small"}}),e("transition",{attrs:{name:"rr-fade-fast"}},[t.expanded&&t.merchant.activated?e("div",{staticClass:"rr-t-cashback rr-text-inverse rr-flex rr-items-center rr-ml-8",staticStyle:{transition:"opacity .3s"}},[e("check-icon",{staticClass:"rr-mr-4",attrs:{size:"14",color:"#ffffff"}}),e("div",{staticClass:"rr-whitespace-nowrap rr-overflow-hidden",staticStyle:{"text-overflow":"ellipsis","max-width":"142px"}},[e("span",[t._v(t._s(t.cashbackAmount))]),t.merchant.activated&&t.cashbackAmount.length<12?e("span",[t._v(" Activated ")]):t._e()])],1):t._e()]),e("div",{staticClass:"rr-flex"},[e("r-icon-button",{attrs:{size:"48px",flat:"",rounded:!1},on:{click:function(e){return e.stopPropagation(),t.onMenuIconClick.apply(null,arguments)}}},[e("icon-settings",{attrs:{color:"white"}})],1),t.showMenu?e("div",{staticClass:"rab-quick-view__menu rr-rounded-ui rr-py-16 rr-absolute"},t._l(t.menuItemsByTest,(function(r){return e("div",{key:r.title,staticClass:"rab-quick-view__menu-item rr-t-body rr-flex rr-items-center rr-px-32 rr-text-secondary rr-cursor-pointer",on:{click:function(t){return t.stopPropagation(),r.action()}}},[t._v(" "+t._s(r.title)+" ")])})),0):t._e(),e("r-close-button",{attrs:{label:"Dismiss Rakuten Action Button",color:"#ffffff",size:"48px",position:"relative"},on:{click:function(e){return t.$emit("close")}}})],1),e("transition",{attrs:{name:"rr-fade-fast"}},[t.expanded||t.product?t._e():e("div",{staticClass:"rr-border-divider rr-box-border rr-rounded-tag rr-absolute rab-quick-view__merchant-logo",class:{"rr-pa-8":t.isSquareLogo},style:{backgroundImage:`url(${t.merchantLogoUrl}`,backgroundColor:t.merchantLogo.bgColor||"#ffffff"}})])],1),e("div",{ref:"scrollContainer",staticClass:"rr-px-20 rr-pt-20 rr-box-border",staticStyle:{"max-height":"472px"},on:{click:t.formClick}},[t.product?[e("rab-product-details",{staticClass:"rr-mb-24",attrs:{product:t.product,couponsCount:t.couponsCount,merchant:t.merchant}}),t.merchant.activated?t._e():e("r-button",{staticClass:"rr-mb-20",attrs:{block:""},on:{click:function(e){return t.$emit("activate")}}},[t._v(" "+t._s(t.ctaText)+" ")]),t.boost?e("notification-boost",{staticClass:"rr-w-fill-available",attrs:{boost:t.boost}}):t._e()]:e("div",{staticClass:"rr-flex rr-flex-col rr-items-center",staticStyle:{overflow:"hidden"}},[t.expanded?t._e():[e("div",{staticClass:"rr-t-descriptor-xs rr-my-12"},[t._v(" "+t._s(t.merchant.storeName)+" ")]),t.merchant.activated?e("div",{staticClass:"rr-t-cashback rr-mb-24 rr-text-cashback rr-flex rr-items-center rr-text-primary"},[e("check-icon",{staticClass:"rr-mr-4",attrs:{size:"14"}}),t._v(t._s(t.cashbackAmount)+" Cash Back Activated ")],1):e("r-cashback",{staticClass:"rr-mb-12",attrs:{reward:t.merchant.reward,previousRewardText:t.boost?"":t.merchant.reward.previous}})],t.merchant.activated?t._e():e("r-button",{staticClass:"rr-mb-24",attrs:{block:""},on:{click:function(e){return t.$emit("activate")}}},[t._v(" "+t._s(t.ctaText)+" ")]),t.boost?e("notification-boost",{staticClass:"rr-w-fill-available rr-mb-24",attrs:{boost:t.boost}}):t._e(),t.isLoading?e("r-loader",{staticClass:"rr-mb-24 rr-text-primary"}):[e("rab-categories",{attrs:{tiers:t.tiers,expanded:t.tiersExpanded},on:{toggleConditions:t.toggleTiers}}),t.storeContent?.conditions?e("rab-exclusions",{attrs:{conditions:t.storeContent.conditions,reportingMessage:t.reportingMessage,expanded:t.exclusionsExpanded},on:{toggleConditions:t.toggleExclusions}}):t._e()]],2)],2)])};cs._withStripped=!0;var ls=r(36123),ds=r(22337),us=r(7419),hs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-t-body rr-rab-product-details"},[t.merchant.activated?e("div",{staticClass:"rr-rab-product-details__alert rr-bg-green-05 rr-text-green-400 rr-mb-12 rr-pa-8 rr-rounded-ui rr-flex rr-items-start"},[e("start-illustration",{staticClass:"rr-flex-shrink-0 rr-bg-green-15 rr-text-green-200 rr-rounded-full",attrs:{size:"32"}}),e("div",{staticClass:"rr-pl-8"},[t._v(" "+t._s(t.alertText)+" ")])],1):t._e(),e("div",{staticClass:"rr-flex rr-flex-row"},[e("img",{staticClass:"rr-rab-product-details__logo rr-rounded-ui rr-mr-12",attrs:{alt:t.product.title,src:t.productImage,rel:"click"},on:{click:function(e){return t.$emit("onClick",{productData:t.product,source:"product image"})}}}),e("div",[e("div",{staticClass:"rr-t-medium-h3",staticStyle:{"line-height":"48px"}},[t._v(" "+t._s(t.totalSavings)+" ")]),t.saleSavings?e("div",[e("strong",[t._v("Store savings:")]),t._v(" "+t._s(t.formatMoney(t.saleSavings))+" ")]):t._e(),t.saleSavings&&t.cashBackAmount?e("div",{staticClass:"rr-mt-8"},[e("strong",{staticClass:"rr-text-cashback"},[t._v(t._s(t.rewardAmount)+" Cash Back:")]),t._v(" "+t._s(t.formatMoney(t.cashBackAmount))+" ")]):t._e(),0===t.product.shippingCost||t.couponsCountMessage?e("div",{staticClass:"rr-flex rr-flex-row rr-mt-12"},[t.couponsCountMessage?e("badge-coupon",{staticClass:"rr-mr-4"},[t._v(" "+t._s(t.couponsCountMessage)+" ")]):t._e(),0===t.product.shippingCost?e("badge-shipping",[t._v(" Free Shipping ")]):t._e()],1):t._e()])])])};hs._withStripped=!0;var ps=function(){var t=this;return(0,t._self._c)("r-badge",{staticClass:"rr-bg-blue-15 rr-text-brand-dark-indigo",attrs:{icon:t.TruckIcon}},[t._t("default")],2)};ps._withStripped=!0;var ms=r(12155),vs=function(){var t=this,e=t._self._c;return e("svg-icon",t._b({attrs:{viewBox:"0 0 16 16"}},"svg-icon",t.$props,!1),[e("path",{attrs:{d:"M13.3332 5.33317H11.3332V4.1665C11.3332 3.33808 10.6616 2.6665 9.83317 2.6665H1.99984C1.2665 2.6665 0.666504 3.2665 0.666504 3.99984V11.3332H1.99984C1.99984 12.4398 2.89317 13.3332 3.99984 13.3332C5.1065 13.3332 5.99984 12.4398 5.99984 11.3332H9.99984C9.99984 12.4398 10.8932 13.3332 11.9998 13.3332C13.1065 13.3332 13.9998 12.4398 13.9998 11.3332H15.3332V7.99984L13.3332 5.33317ZM12.9998 6.33317L14.3065 7.99984H11.3332V6.33317H12.9998ZM3.99984 11.9998C3.63317 11.9998 3.33317 11.6998 3.33317 11.3332C3.33317 10.9665 3.63317 10.6665 3.99984 10.6665C4.3665 10.6665 4.6665 10.9665 4.6665 11.3332C4.6665 11.6998 4.3665 11.9998 3.99984 11.9998ZM5.47984 9.99984C5.11317 9.59317 4.59317 9.33317 3.99984 9.33317C3.4065 9.33317 2.8865 9.59317 2.51984 9.99984H1.99984V3.99984H9.99984V9.99984H5.47984ZM11.9998 11.9998C11.6332 11.9998 11.3332 11.6998 11.3332 11.3332C11.3332 10.9665 11.6332 10.6665 11.9998 10.6665C12.3665 10.6665 12.6665 10.9665 12.6665 11.3332C12.6665 11.6998 12.3665 11.9998 11.9998 11.9998Z",fill:"#29296E"}})])};vs._withStripped=!0;const fs={components:{SvgIcon:dt.A},props:{color:{type:String,default:"currentColor"},size:{type:[Number,String],default:16},rotate:{type:Number,default:0}}};const gs=(0,Y.A)(fs,vs,[],!1,null,null,null).exports,_s={components:{RBadge:ms.A},data:()=>({TruckIcon:gs})};const Cs=(0,Y.A)(_s,ps,[],!1,null,null,null).exports;var bs=function(){var t=this;return(0,t._self._c)("r-badge",{staticClass:"rr-bg-orange-15 rr-text-secondary",attrs:{icon:t.CouponIcon}},[t._t("default")],2)};bs._withStripped=!0;const ys={components:{RBadge:ms.A},data:()=>({CouponIcon:ue.A})};const ks={components:{BadgeShipping:Cs,BadgeCoupon:(0,Y.A)(ys,bs,[],!1,null,null,null).exports,StartIllustration:ne},props:{product:{type:Object,required:!0},merchant:{type:Object,required:!0},couponsCount:{type:Number,default:0}},data:()=>({productImage:D.sx}),computed:{rewardAmount(){return this.product.eligible_for_cash_back&&(0,tt.a)(this.merchant.reward)},cashBackAmount(){return this.product.eligible_for_cash_back&&(0,$r.j)(this.merchant.reward,this.product.salePrice)},couponsCountMessage(){return this.couponsCount>0&&`${this.couponsCount} coupon${this.couponsCount>1?"s":""}`},saleSavings(){return this.product.listPrice-this.product.salePrice},totalSavings(){const t=(0,Mt.u)(this.saleSavings+this.cashBackAmount);return this.saleSavings?`Save ${t}`:`Get ${t} back`},alertText(){return this.couponsCount>1?`Shop now to lock in this deal! We\u2019ll remind you to try ${this.couponsCount} coupons at checkout.`:1===this.couponsCount?"Shop now to lock in this deal! We\u2019ll remind you to try 1 coupon at checkout.":this.saleSavings?"Way to stack! Check out now to lock in this price and Cash Back.":"Check out now to lock in this Cash Back deal!"}},watch:{product(t,e){e.imageUrl!==t.imageUrl&&this.updateProductImage()}},async mounted(){this.updateProductImage()},methods:{formatMoney:t=>(0,Mt.u)(t),async updateProductImage(){const t=await(0,dr.a)(this.product.imageUrl);t&&(this.productImage=t)}}};const xs=(0,Y.A)(ks,hs,[],!1,null,null,null).exports;var As=function(){var t=this,e=t._self._c;return e("conditions-dropdown",{attrs:{title:"Cash Back Terms & Exclusions"},on:{toggleConditions:function(e){return t.$emit("toggleConditions")}}},[e("div",{staticClass:"rr-t-fine-print"},[t.conditions.reward?e("div",{staticClass:"rr-mt-8"},[e("strong",[t._v("Exclusions:")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.sanitizedMessage(t.conditions.reward))}})]):t._e(),t.conditions.nonReward?e("div",{staticClass:"rr-mt-8"},[e("strong",[t._v("Special Terms:")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.sanitizedMessage(t.conditions.nonReward))}})]):t._e(),e("div",{staticClass:"rr-mt-8"},[e("strong",[t._v("Posting Time:")]),t._v(" Cash Back will be automatically added to your Rakuten account "+t._s(t.reportingMessage)+". ")])])])};As._withStripped=!0;var ws=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rr-w-full rr-box-border rr-px-12 rr-py-20 rr-cursor-pointer",staticStyle:{"border-top":"1px solid var(--colors-border-divider)"},on:{click:t.onClick}},[e("div",{staticClass:"rr-flex rr-items-center rr-justify-between"},[e("div",{staticClass:"rr-t-descriptor-xs rr-text-primary",staticStyle:{"line-height":"18px"}},[t._v(" "+t._s(t.title)+" ")]),e("chevron-down",{attrs:{size:"16px",rotate:t.expanded?180:0}})],1),e("div",{staticStyle:{transition:"height .3s",overflow:"hidden"},style:{height:`${t.containerHeight}px`}},[e("div",{ref:"slot",staticStyle:{overflow:"hidden"}},[t._t("default")],2)])])};ws._withStripped=!0;const Ss={components:{ChevronDown:er.A},props:{title:{type:String,required:!0}},data:()=>({expanded:!1,containerHeight:0}),methods:{async onClick(){if(this.expanded=!this.expanded,this.$emit("toggleConditions"),this.expanded){const t=this.$refs.slot;await this.$nextTick(),this.containerHeight=t?.clientHeight??0}else this.containerHeight=0}}};const Ts=(0,Y.A)(Ss,ws,[],!1,null,null,null).exports,$s={components:{ConditionsDropdown:Ts},props:{conditions:{type:Object,required:!0},reportingMessage:{type:String,required:!0}},methods:{sanitizedMessage:t=>(0,Pe.p)(t)}};const Ms=(0,Y.A)($s,As,[],!1,null,null,null).exports;var Ls=function(){var t=this,e=t._self._c;return t.tiers.length?e("conditions-dropdown",{attrs:{title:"Cash Back Categories"},on:{toggleConditions:function(e){return t.$emit("toggleConditions")}}},t._l(t.tiers,(function(r){return e("div",{key:r.id,staticClass:"rr-flex rr-pt-8"},[r.rewardAmount?[e("div",{staticClass:"rr-text-cashback rr-t-tag-small rr-mr-8",staticStyle:{"min-width":"28px"}},[t._v(" "+t._s(r.rewardAmount)+" ")]),e("div",{staticClass:"rr-t-fine-print"},[t._v(" "+t._s(r.names)+" ")])]:r.cashBack?e("div",{staticClass:"rr-t-fine-print"},[e("span",{staticClass:"rr-text-cashback rr-font-semibold"},[t._v(t._s(r.cashBack))]),t._v(" "+t._s(r.description)+" ")]):t._e()],2)})),0):t._e()};Ls._withStripped=!0;const Ps={components:{ConditionsDropdown:Ts},props:{tiers:{type:Array,required:!0}}};const Is=(0,Y.A)(Ps,Ls,[],!1,null,null,null).exports,Bs={components:{RButton:X.A,RCashback:_r.A,RIconButton:st.A,RForm:F.A,RCloseButton:te.A,RHeadingLogo:q.A,IconSettings:us.A,CheckIcon:ct.A,RLoader:ds.A,RabProductDetails:xs,RabCategories:Is,RabExclusions:Ms,NotificationBoost:ye},props:{merchant:{type:Object,required:!0},product:{type:Object,default:null},couponsCount:{type:Number,default:0},cashbackAmount:{type:String,default:""},tiers:{type:Array,required:!0},storeContent:{type:Object,default:null},boost:{type:Object,default:null}},data(){return{tiersExpanded:!1,exclusionsExpanded:!1,showMenu:!1,top:10,initialTop:10,endDate:Date.now()+864e5+5e3,isBTN216:!1,menuItems:[{title:"Hide for 30 minutes",action:()=>{this.$emit("timeoutSnooze")},isBTN216:!1},{title:"Hide for this shopping session",action:()=>{this.$emit("sessionSnooze")},isBTN216:!1},{title:"Hide on this site for 1 hour",action:()=>{this.$emit("hideRABUntil")},isBTN216:!0},{title:"Always hide on this site",action:()=>{this.$emit("hideRABForMerchant")},isBTN216:!0},{title:"See all Extension Settings",action:()=>{this.$emit("openSettingsPage"),this.showMenu=!1},isBTN216:!0}],merchantLogoUrl:"",resizeObserver:null,dragging:!1,startedPageY:0,dy:0,startedContentTop:0,moved:!1}},computed:{merchantLogo(){return this.merchant.images.squareLogo||this.merchant.images.largeLogo},isSquareLogo(){return!!this.merchant.images.squareLogo},groupedTiers(){return(0,ns.w)(this.tiers).filter((t=>t.rewardAmount))},isLoading(){return!this.tiers||!this.storeContent},expanded(){return this.tiersExpanded||this.exclusionsExpanded},reportingMessage(){return(0,qr.n)({...this.merchant,storeContent:this.storeContent})},position(){return{top:`${this.top}px`,right:"10px"}},ctaText(){return this.product||this.expanded?`Activate ${this.cashbackAmount} Cash Back`:"Activate"},reward(){return this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.rewardsExpired?null:this.merchant.reward},rakPlus(){return this.merchant.reward.rakplusTargeted},maxYOffset(){return window.innerHeight-this.$el.offsetHeight},menuItemsByTest(){return this.menuItems.filter((t=>t.isBTN216===this.isBTN216))}},watch:{async isLoading(t){t||(await this.$nextTick(),this.setInitTop())}},async mounted(){this.setInitTop(),this.automaticallyAdjustScroll(),this.merchantLogoUrl=await(0,dr.a)(this.merchantLogo.url),window.addEventListener("resize",this.handleResize),"A"===await c.r.activate(D.mp.RAB_IMPROVEMENT_TEST,{storeId:this.merchant.storeId})&&(document.addEventListener("mouseup",this.documentMouseUp),document.addEventListener("mousemove",this.documentMouseMove))},beforeDestroy(){this.resizeObserver?.disconnect(),window.removeEventListener("resize",this.handleResize),document.removeEventListener("mouseup",this.documentMouseUp),document.removeEventListener("mousemove",this.documentMouseMove)},methods:{toggleTiers(){this.$emit("toggleTiers"),this.tiersExpanded=!this.tiersExpanded},toggleExclusions(){this.$emit("toggleExclusions"),this.exclusionsExpanded=!this.exclusionsExpanded},adjustTop(){this.top=Math.min(this.initialTop,window.innerHeight-this.$el.offsetHeight)},setInitTop(){const t=parseInt(localStorage.getItem("rr-rab-position-top")??"10",10)-56,e=this.$el.offsetHeight;window.innerHeight-t<e?this.top=t+56-e+56:this.top=t<0?0:t,this.initialTop=this.top},formClick(){this.showMenu=!1},automaticallyAdjustScroll(){const t=this.$refs.scrollContainer,e=new ls.A(t);this.resizeObserver=new ResizeObserver((()=>{e.update(),this.adjustTop()})),this.resizeObserver.observe(t)},onMouseDown(t){t.preventDefault(),this.dragging=!0,this.moved=!1,this.startedPageY=t.pageY,this.startedContentTop=this.$el.offsetTop},onMouseUp(){this.dragging=!1,this.moved&&this.trackMoveEvent()},documentMouseUp(){this.dragging&&this.$el&&(this.dragging=!1,this.trackMoveEvent())},documentMouseMove(t){if(this.dragging&&(t.preventDefault(),this.dy=t.pageY-this.startedPageY,Math.abs(this.dy)>8)){const t=this.startedContentTop+this.dy;this.top=Math.min(Math.max(t,0),this.maxYOffset),localStorage.setItem("rr-rab-position-top",`${this.top}px`),this.moved=!0}},handleResize(){const t=this.$el.offsetHeight;this.top+t>window.innerHeight?this.top=window.innerHeight-t+10:this.top<0&&(this.top=10),localStorage.setItem("rr-rab-position-top",`${this.top}px`)},trackMoveEvent(){this.$emit("track","View Module",{entity_name:"Moved RAB Quick View",original_position:this.startedContentTop,new_position:this.top})},async onMenuIconClick(){this.isBTN216="A"===await c.r.activate(D.mp.RAB_IMPROVEMENT_TEST,{storeId:this.merchant.storeId}),this.showMenu=!this.showMenu}}};const Es=(0,Y.A)(Bs,cs,[],!1,null,null,null).exports,Rs=a().extend({components:{RabQuickViewForm:Es},props:{merchant:{type:Object,required:!0},product:{type:Object,required:!0},couponsCount:{type:Number,default:0},cashbackAmount:{type:String,default:""}},data:()=>({tiers:[],storeContent:null,isBoostExperiment:!1}),computed:{...(0,n.aH)(["boost"]),entity_name(){return`${this.merchant.activated?"Active":"Inactive"} ${this.product?"PDP":"RAB Quickview"}`}},async mounted(){if(this.boost){(l.o.variation("signupButtonMilestones",{ids:[]}).ids??[]).includes(this.boost.incentive_id)?this.isBoostExperiment="A"===await c.r.activate(D.mp.NOTIFICATION_BOOST,{storeId:this.merchant.storeId,placement:"RAB_Quickview"}):this.isBoostExperiment=!0}this.$emit("track","View Module",{entity_name:this.entity_name,...!this.product&&this.isBoostExperiment&&{boost_reminder:!0}});const t=this.merchant.storeId,e=await(0,f.r)("getTiers",{storeId:t});this.tiers=(0,ns.w)(e),this.storeContent=await(0,f.r)("getStoreContent",{storeId:t})}});const Ns=(0,Y.A)(Rs,as,[],!1,null,null,null).exports;var Os=function(){var t=this,e=t._self._c;return e("r-popover",{ref:"popover",staticClass:"rr-bg-dark",attrs:{backgroundColor:"#292A6B",width:"300",anchor:t.anchor,options:t.options},on:{show:t.onShow}},[e("div",{staticClass:"rr-flex rr-flex-col rr-items-center rr-text-center"},[e("div",{staticClass:"rr-t-descriptor-l rr-mb-16 rr-text-inverse"},[t._v(" "+t._s(t.title)+" ")]),e("div",{staticClass:"rr-t-descriptor-s rr-text-inverse"},[t._v(" "+t._s(t.text)+" ")]),t.content.length>1?e("div",{staticClass:"rr-flex rr-items-center rr-mt-8",staticStyle:{"margin-bottom":"-16px"}},[e("r-icon-button",{class:0===t.currentPage?"rr-text-disabled":"rr-text-inverse",attrs:{size:"48px",flat:"",rounded:!1},on:{click:t.scrollPrev}},[e("chevron-icon",{attrs:{rotate:90}})],1),e("div",{staticClass:"rr-t-body rr-text-inverse"},[t._v(" "+t._s(t.currentPage+1)+" / "+t._s(t.content.length)+" ")]),e("r-icon-button",{class:t.currentPage+1===t.content.length?"rr-text-disabled":"rr-text-inverse",attrs:{size:"48px",flat:"",rounded:!1},on:{click:t.scrollNext}},[e("chevron-icon",{attrs:{rotate:-90}})],1)],1):t._e()]),e("r-close-button",{attrs:{label:"Dismiss Rakuten Action Button Education Popover",title:"Close Rakuten dialog",color:"#ffffff"},on:{click:function(e){return t.$emit("clickClose")}}})],1)};Os._withStripped=!0;const Hs={components:{RIconButton:st.A,ChevronIcon:er.A,RPopover:Xe.A,RCloseButton:te.A},mixins:[Qe.A],props:{anchor:{type:Object,default:null},content:{type:Array,required:!0},type:{type:String,required:!0}},data:()=>({entityName:"RAB",moduleType:"tooltip",currentPage:0,options:{placement:"left-start"}}),computed:{title(){return this.content[this.currentPage].title},text(){return this.content[this.currentPage].text}},async mounted(){await this.$nextTick(),this.anchor&&this.$refs.popover.popperInstance&&(this.resizeObserver=new ResizeObserver((()=>{this.$refs.popover.popperInstance.update()})),this.resizeObserver.observe(this.anchor),this.mutationObserver=new MutationObserver((()=>{this.$refs.popover.popperInstance.update()})),this.mutationObserver.observe(this.anchor,{attributes:!0,childList:!1,subtree:!1}))},beforeDestroy(){this.resizeObserver?.disconnect(),this.mutationObserver?.disconnect()},methods:{scrollPrev(){this.currentPage=Math.max(this.currentPage-1,0)},scrollNext(){this.currentPage=Math.min(this.currentPage+1,this.content.length-1)}}};const Ds=(0,Y.A)(Hs,Os,[],!1,null,null,null).exports;var Vs=function(){var t=this,e=t._self._c;return e("r-form",{attrs:{headerLogo:"none",width:"400px"},on:{close:function(e){return t.$emit("close")}}},[e("div",{staticClass:"rr-flex",style:{marginLeft:t.icon?"-12px":"",marginTop:"-20px",marginBottom:"-24px",marginRight:"12px"}},[t.hideStatusBar?t._e():e("div",{style:{position:"absolute",top:"0px",bottom:"0px",left:"0px",borderTopLeftRadius:"var(--radii-ui)",borderBottomLeftRadius:"var(--radii-ui)",minWidth:"8px",background:t.customStatusColor?t.customStatusColor:"var(--colors-state-info)"}}),t.icon?e(t.icon,{tag:"component",staticClass:"rr-mr-12 rr-flex-shrink-0",attrs:{size:"18px",color:"#33823F"}}):t._e(),e("div",[e("div",{staticClass:"rr-t-descriptor-m"},[t._v(" "+t._s(t.title)+" ")]),e("div",{staticClass:"rr-t-body"},[t._v(" "+t._s(t.body)+" ")]),t.actions.length?e("div",{staticStyle:{"margin-bottom":"-8px","margin-left":"-16px"}},t._l(t.actions,(function(r,i){return e("r-button",{key:i,attrs:{variant:"tertiary"},on:{click:r.onClick}},[t._v(" "+t._s(r.title)+" ")])})),1):t._e()])],1)])};Vs._withStripped=!0;const Fs={components:{RForm:F.A,RButton:X.A},props:{title:{type:String,default:""},body:{type:String,default:""},hideStatusBar:{type:Boolean,default:!1},actions:{type:Array,default:()=>[]},customStatusColor:{type:String,default:""},icon:{type:Object,default:null}},data:()=>({}),methods:{}};const Ws=(0,Y.A)(Fs,Vs,[],!1,null,null,null).exports,zs=36e5,js={components:{RabQuickView:Ns,ActionButtonForm:os,EducationPopover:Ds,RNotificationCard:Ws},data(){return{module_type:"RAB",state:"rab",educationPopperVisible:!1,events:{},product:null,coupons:null,loading:!1,educationPopoverContentActivated:[{title:this.$t("rab.popover.main.title"),text:this.$t("rab.popover.main.body")},{title:this.$t("rab.popover.move.title"),text:this.$t("rab.popover.move.body")}],educationPopoverContentInactive:[{title:this.$t("rab.popover.inactive.title"),text:this.$t("rab.popover.inactive.body")}],oneClickActivation:!1,showNotification:!0,CheckIcon:ct.A}},computed:{...(0,n.aH)({productDetails:"product",merchant:"merchant",settings:"settings",boost:"boost"}),educationPopoverContent(){return this.merchant.activated?this.educationPopoverContentActivated:this.educationPopoverContentInactive},couponsCount(){return this.coupons?.length??0},entityNameSavingsFound(){return`Savings found ${this.activeState} PDP`},activeState(){return this.merchant.activated?"Active":"Inactive"},entityName(){return this.product?"quick-view"===this.state?`${this.activeState} PDP`:this.entityNameSavingsFound:"quick-view"===this.state?`${this.activeState} RAB Quickview`:`${this.activeState} RAB`},reward(){return this.merchant.activated?this.merchant.shoppingTrip.reward:this.merchant.rewardsExpired?null:this.merchant.reward},cashbackAmount(){return(0,tt.a)(this.reward)},label(){return this.oneClickActivation?this.$t("rab.activateAmountCashBack",{amount:this.cashbackAmount}):this.product?this.$t("rab.savingsFound"):this.cashbackAmount},progressiveEducation(){return this.settings.progressiveEducation},activationInterval(){return this.merchant.activationInterval||this.settings.activationInterval||1e4}},watch:{showQuickView(t){this.educationPopperVisible&&t&&(this.educationPopperVisible=!1)},productDetails(t){t?this.handleProduct(t):this.product=null},async product(){null===this.coupons&&(this.coupons=await(0,f.r)("getCoupons",{storeId:this.merchant.storeId})),this.product||(this.state="rab")},async merchant(t){t.activated&&(await this.$nextTick(),this.loading=!1,this.renderPopover())}},beforeMount(){this.events=this.merchant.rabEvents||{}},async mounted(){this.renderPopover(),this.merchant.activated||(this.oneClickActivation="A"===await c.r.get(D.mp.ACTIVATE_RAB_ONE_CLICK))},created(){this.productDetails&&this.handleProduct(this.productDetails),window.addEventListener("addressbar.urlchange",(()=>{this.product=null}),!1),this.$store.dispatch("getActiveBoost",{storeId:this.merchant.storeId})},methods:{async handleProduct(t){const e=l.o.get("rabPDP"),r=l.o.get("rabPDPTreshold",{stackedSaving:15,cashbackSaving:1,cashbackAmount:3}),i=l.o.get("rabPDPMerchants",{storeIds:[]}).storeIds,s=r.stackedSaving,o=r.cashbackSaving,a=r.cashbackAmount;if(!e||!i.includes(this.merchant.storeId)||this.merchant.reward.range||this.merchant.reward.amount<a)return;if(t.price.length>1)return this.product=null,void this.track("Suppress Module",{entity_name:this.entityNameSavingsFound,suppress_reason_code:"5"});const n=Math.round(parseFloat(t.price[0]?.amount)),c=new Jr.bf(document).extract(),d=await(0,f.r)("getProductCatalogDetails",{merchant:this.merchant,detail:t,common:c});if(this.product=null,!d)return;const u=!!this.merchant.excludedCategories?.find((t=>d.categoryIds.includes(String(t))));d.saleSaving=d.listPrice-d.salePrice,d.cashbackSaving=(0,$r.j)(this.merchant.reward,d.salePrice),d.stackedSaving=d.saleSaving+d.cashbackSaving;const h=[Boolean(d.stackedSaving/d.listPrice*100<s),Boolean(d.cashbackSaving<o),Boolean(!d.eligible_for_cash_back),Boolean(n!==Math.round(d.salePrice)),Boolean(u)];if(h.includes(!0)){const t=h.map(((t,e)=>t&&e)).filter(Number.isInteger).toString();this.track("Suppress Module",{suppress_reason_code:t,...this.productMessageInfo(d)})}else this.product=d},timeoutSnooze(){this.track("Hide",{hide_type:"temporary"}),this.$store.dispatch("updateMerchant",{rabSnoozeTimestamp:Date.now()+zs,rab:!1,notificationHover:!1}),this.close()},sessionSnooze(){this.track("Hide",{hide_type:"whole session"}),this.$store.dispatch("updateMerchant",{rab:!1,notificationHover:!1}),this.close()},hideRABUntil(){this.$store.dispatch("updateMerchant",{rabSnoozeTimestamp:Date.now()+zs,rab:!1}),this.track(g.m.CLICK_MODULE,{cta_type:"hide_one_hour"}),this.close()},hideRABForMerchant(){const t=this.merchant.storeId;(0,f.r)("blacklist-update",{storeId:t,property:"rabExcludedStores",exclude:!0}),this.state="notification",this.track(g.m.CLICK_MODULE,{cta_type:"always_hide"})},onUndoClick(){const t=this.merchant.storeId;(0,f.r)("blacklist-update",{storeId:t,property:"rabExcludedStores",exclude:!1}),this.state="rab"},async openSettingsPage(){await(0,f.r)("openOptionsPage"),this.track(g.m.CLICK_MODULE,{cta_type:"see_all_settings"})},close(){this.$store.dispatch("updateComponents",{notification:!1}),this.$store.dispatch("updateSettings",{rabExcludedStores:[...this.settings.rabExcludedStores,this.merchant.storeId]}),this.$emit("onClose"),this.state="rab"},async onButtonMouseEnter(){const t="View Module Inactive RAB Expanded";this.merchant.activated||this.events[t]||(this.events[t]=!0,this.$store.dispatch("updateMerchant",{rabEvents:this.events}),c.r.activate(D.mp.ACTIVATE_RAB_ONE_CLICK,{storeId:this.merchant.storeId}))},onRabClick(){this.oneClickActivation&&!this.merchant.activated?this.activate():this.state="quick-view"},notificationClose(){this.close()},track(t,e={}){if(!(e.new_position||e.hide_type||e.cta_type||this.product||e.suppress_reason_code)){const r=t+(e.entity_name??this.entityName);if(this.events[r])return;this.events[r]=!0,this.$store.dispatch("updateMerchant",{rabEvents:this.events})}g.m.track(t,{module_type:this.module_type,entity_name:this.entityName,domain:location.host,...this.merchant&&{tracking_ticket:this.merchant.shoppingTrip.ttn,source_of_activation:this.merchant.shoppingTrip.source,store_id:this.merchant.storeId,store_name:this.merchant.storeName,store_domain:this.merchant.domainName,was_cash_back:this.merchant.reward.previous,...(0,E.D)(this.reward)},...this.productMessageInfo(),...e})},productMessageInfo(t=this.product){return t?{stacked_saving:t.stackedSaving,stacked_saving_percentage:Math.floor(t.stackedSaving/t.listPrice*100),sale_discount:t.saleSaving,no_of_coupons:this.couponsCount,is_freeshipping:0===t.shippingCost,cash_back_amount:t.cashbackSaving}:{}},toggleTiers(){this.track(g.m.VIEW_MODULE,{entity_name:`${this.activeState} RAB Quickview Category`})},toggleExclusions(){this.track(g.m.VIEW_MODULE,{entity_name:`${this.activeState} RAB Quickview Terms`})},renderPopover(){const t=this.merchant.activated?"RAB":"RABinactive";this.progressiveEducation?.[t]&&this.$el&&setTimeout((()=>{"quick-view"===this.state?(0,f.r)("updateProgressiveEducation",{[t]:!1}):this.educationPopperVisible=!0}),3e3)},activate(){this.loading=!0,this.state="rab";const t=this.oneClickActivation?"Expanded RAB":"RAB";this.merchant.loggedIn?(0,bt.Y)(this.merchant.storeId,{...this.boost&&{type:`CB boost ${this.boost.incentive_id}`},rabActivation:!0,store_url:document.location.href,sessionAttributes:{source:t}}):(0,f.r)("login",{merchant:this.merchant,type:this.module_type,source:t}),setTimeout((()=>{this.loading&&!this.merchant.activated&&(this.loading=!1)}),this.activationInterval)}}};const qs=(0,Y.A)(js,Gi,[],!1,null,null,null).exports;var Us=r(85323);async function Ys(t){let e;l.o.get("merchantReclaim")&&(e=t.breakageData||await async function(){return(await(0,Us.LI)({plugins:Us.fJ.EXTENSION})).getAllPluginStates()}());const r=(i=e)&&0!==Object.keys(i).length?{origin:{...i.firstPartyCookies?{is_first_party_cookies_enabled:i.firstPartyCookies.enabled}:{},...i.thirdPartyCookies?{is_third_party_cookies_enabled:i.thirdPartyCookies.enabled}:{},...i.adBlockerDetection?{is_ad_blocker_enabled:i.adBlockerDetection.enabled}:{}}}:null;var i;const s=[],o=[];l.o.get("holisticMerchantPageViewedStoreIds",{storeIds:[]}).storeIds.includes(t.storeId)&&o.push(async function({merchant:t,clientContext:e,installedExtensions:r,type:i="unknown"}){return await(0,y.l)(C.s.MerchantPageViewed,{data:{store:{id:t.storeId,name:t.storeName},tracking_ticket:t.shoppingTrip.ttn,type:i,installed_extensions:r},clientContext:e})}({merchant:t,clientContext:r,installedExtensions:s})),t.breakageData||o.unshift(async function(t,e){if(!t.breakageData)return await(0,y.l)(C.s.MerchantTripStarted,{data:{store:{id:t.storeId,name:t.storeName},tracking_ticket:t.shoppingTrip.ttn},clientContext:e})}(t,r)),await Promise.allSettled(o),(0,b.a)(t.storeId,{breakageData:e})}let Zs=null;const Gs=a().extend({name:"MerchantView",components:{ActionButtonView:qs,NotificationView:cr,RecommendedStoresView:wr,TakeoverPreventionView:Wr,CartReminderView:Gr,CouponsMagic:Zi,PostPurchase:Ut},data:()=>({isEligibleForCartReminder:!1,recommendedStoresPromo:null,renderNotification:!1,CAAshowedResultsCBCTA:!1}),computed:{...(0,n.aH)(["merchant","settings","cart","product","components"]),cartReminder(){return this.cart&&!this.merchant.suppressed&&!this.merchant.activated&&this.isEligibleForCartReminder&&(null===this.components.notification&&!this.merchant.notificationHover||this.components.notification&&this.isRABVisible)&&null===this.components.couponMagic&&!this.CAAshowedResultsCBCTA},isRABVisible(){const t=this.merchant;return!!t.rab&&t.settings_rab&&!t.suppressed&&!(t.activated&&t.notificationHover)&&!this.components.couponMagic&&!this.settings.rabExcludedStores.includes(t.storeId)},isRakPlus(){return this.merchant.reward.rakplusTargeted??!1},hover(){const t=this.merchant;return!t.recommendedStoresPromo&&!t.suppressed&&(!t.activated&&t.settings_notification||t.activated&&t.settings_confirmation)&&!this.components.couponMagic&&(t.notificationHover||this.isRABVisible)}},watch:{async cart(t){if(t){const t=this.merchant.storeId,e=l.o.get("cartScraperBlockList"),r=e&&Array.isArray(e.storeIds)&&e.storeIds.includes(t);this.isEligibleForCartReminder=this.merchant.settings_checkout&&this.merchant.notificationReminder&&this.settings.checkoutNotifications.activation&&l.o.get("cartReminder")&&!r&&(this.merchant.affiliatizerEnabled||l.o.get("checkoutReminderForBgActivation")&&await(0,f.r)("isEligibleForBackgroundActivation",{storeId:t}))&&"X"!==this.merchant.incrementalityTest}},cartReminder(t){this.$store.dispatch("updateComponents",{cartReminder:t})},merchant(t,e){if("X"===this.merchant.incrementalityTest||this.merchant.recommendedStoresPromo)return;const r=e.notificationHover&&!t.notificationHover&&2!==t.activationCode,i=!e.notificationHover&&t.notificationHover;r&&this.merchant.backgroundActivated&&this.toggleRab("CloseHover"),i&&this.hover&&this.$store.dispatch("updateComponents",{notification:!0}),(t.suppressed||!t.settings_notification||r)&&this.$store.dispatch("updateComponents",{notification:!1})},hover(t){if(t){if("X"===this.merchant.incrementalityTest)return;this.$store.dispatch("updateComponents",{notification:!0})}}},beforeMount(){(0,x.d)({name:"content/merchant",node:(0,A.jG)()})},created(){const t=this.merchant,e=this.settings,r=t.hoverShownCount??0,i=new k({merchant:t,settings:e});i.on("cart:detected",(t=>{this.$store.dispatch("updateCart",t)})),i.on("product:data:scraped",(t=>{this.$store.dispatch("updateProduct",t)})),i.initCartScraper(),i.initProductPageScraper(),(0,w.Q)("takeover",(()=>{this.$store.dispatch("updateComponents",{takeover:!0})})),!t.rab&&t.notificationHover&&(t.activated||r>=2?this.toggleRab("ShownCount"):t.activated||(Zs=(0,s.throttle)((()=>{window.scrollY>900&&(document.removeEventListener("scroll",Zs),Zs=null,this.toggleRab("Scroll"))}),100),setTimeout((()=>document.addEventListener("scroll",Zs)),r?0:5e3))),this.recommendedStoresPromo=!t.notificationHover||t.offers_cb&&"X"!==t.incrementalityTest||t.suppressed||!t.recommendedStoresPromo||t.recommendedStoresPromo.interruptShown?null:t.recommendedStoresPromo,this.recommendedStoresPromo||this.$store.dispatch("updateComponents",{recommended:!1}),!this.merchant.incrementalityTest||this.recommendedStoresPromo||this.merchant.suppressed||this.merchant.activated||!("X"===this.merchant.incrementalityTest||"A"===this.merchant.incrementalityTest&&this.merchant.notificationHover)||c.r.activate("IE-Test-Expedia",{storeId:this.merchant.storeId,placement:"Hover"}),this.renderNotification=!0,Ys(t)},methods:{onNotificationClose(){this.toggleRab("CloseHover")},onRabClose(){Zs&&(document.removeEventListener("scroll",Zs),Zs=null)},toggleRab(t){const e=this.merchant;!e.rab&&e.loggedIn&&e.settings_rab&&("Scroll"!==t||e.notificationHover)&&(e.activated&&l.o.get("rabActive")||!e.activated&&l.o.get("rabInactive")&&l.o.get("hoverRAB")&&e.affiliatizerEnabled)&&this.$store.dispatch("updateMerchant",{rab:!0})}}}),Xs=Gs;const Qs=(0,Y.A)(Xs,i,[],!1,null,null,null).exports}}]);