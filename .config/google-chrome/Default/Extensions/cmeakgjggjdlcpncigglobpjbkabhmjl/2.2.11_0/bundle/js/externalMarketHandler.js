(()=>{var t,e={BACKGROUND_GET_PRICES_FOR_EXTERNAL:1,GetRates:1,BACKGROUND_GET_SIH_ID:1,BACKGROUND_GET_EXTERNAL_TOKEN:1},n="",o={},a={},i={},c="";function s(e,n,a){chrome.runtime.sendMessage(chrome.runtime.id,{type:e,data:n||{}},(function(n){"BACKGROUND_GET_EXTERNAL_TOKEN"===e&&(t=n),a&&(o[a]=n),window.dispatchEvent(new CustomEvent("PassToSiteExt",{detail:n}))}))}window.addEventListener("PassToContentScript",(function(a){var r,E,d=a.detail;E=window.location.href,c!==E&&(i[E]={count:0,timestamp:Date.now()},c=E);var l=Date.now(),u=i[window.location.href];switch(l-u.timestamp>6e4&&(u.count=0,u.timestamp=l),d.type){case"GetRates":r="rates";break;case"BACKGROUND_GET_SIH_ID":r="SIHID";break;case"BACKGROUND_GET_PRICES_FOR_EXTERNAL":r=d.data.items[0]}n!==window.location.href&&(n=window.location.href,Object.keys(e).forEach((function(t){e[t]=1})));if(e[d.type])e[d.type]=e[d.type]-1,s(d.type,d.data,r);else if(d.token&&d.token===t&&"BACKGROUND_GET_PRICES_FOR_EXTERNAL"===d.type&&u.count<20&&function(){try{return["dmarket.com","cs.money","tradeit.gg","skinbaron.de"].some((function(t){return window.location.hostname===t}))}catch(t){return!1}}())u.count++,s(d.type,d.data,r);else if(t&&d.token===t&&u.count>=20){t=null;var w=r?o[r]:null;window.dispatchEvent(new CustomEvent("PassToSiteExt",{detail:w}))}else{var _=r?o[r]:null;window.dispatchEvent(new CustomEvent("PassToSiteExt",{detail:_}))}}),!1),["en","ru","zh_CN"].forEach((function(t){var e;e=t,fetch("chrome-extension://".concat(chrome.runtime.id,"/_locales/").concat(e,"/controls.json")).then((function(t){if(t.ok)return t.json();throw Error("Failed to load localization file: ".concat(t.statusText))})).then((function(t){a[e]=t})).catch((function(t){console.error("Error loading localization file:",t)}))})),window.addEventListener("GetLocalesFromContentScript",(function(t){window.dispatchEvent(new CustomEvent("PassLocalesToSiteExt",{detail:a}))}),!1)})();